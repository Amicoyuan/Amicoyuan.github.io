{
    "version": "https://jsonfeed.org/version/1",
    "title": "Amicoyuan",
    "description": "",
    "home_page_url": "https://xingyuanjie.top",
    "items": [
        {
            "id": "https://xingyuanjie.top/2023/03/13/CMU15-213001/",
            "url": "https://xingyuanjie.top/2023/03/13/CMU15-213001/",
            "title": "",
            "date_published": "2023-03-13T12:09:44.000Z",
            "content_html": "<h2 id=\"2015-CMU-15-213-CSAPP-æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ-Lecture-01-Course-Overview\"><a href=\"#2015-CMU-15-213-CSAPP-æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ-Lecture-01-Course-Overview\" class=\"headerlink\" title=\"2015 CMU 15-213 CSAPP æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ Lecture 01: Course Overview\"></a>2015 CMU 15-213 CSAPP æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ Lecture 01: Course Overview</h2><h3 id=\"ä¾‹å­ä¸€ï¼š\"><a href=\"#ä¾‹å­ä¸€ï¼š\" class=\"headerlink\" title=\"ä¾‹å­ä¸€ï¼š\"></a>ä¾‹å­ä¸€ï¼š</h3><figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-keyword\">typedef</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span>&#123;</span><br>    <span class=\"hljs-keyword\">int</span> a[<span class=\"hljs-number\">2</span>];<br>    <span class=\"hljs-keyword\">double</span> d;<br>&#125;<span class=\"hljs-keyword\">struct_t</span>;<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">fun</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> i)</span></span>&#123;<br>    <span class=\"hljs-keyword\">volatile</span> <span class=\"hljs-keyword\">struct_t</span> s;   <span class=\"hljs-comment\">//volatileå…³é”®å­—</span><br>    s.d = <span class=\"hljs-number\">3.14</span>;<br>    s.a[i] = <span class=\"hljs-number\">1073741824</span>;   <span class=\"hljs-comment\">/*Possibly out of bounds*/</span><br>    <span class=\"hljs-keyword\">return</span> s.d;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">fun(0)   -&gt;   3.14<br>fun(1)   -&gt;   3.14<br>fun(2)   -&gt;   3.1399998664856<br>fun(3)   -&gt;   2.00000061035156<br>fun(4)   -&gt;   3.14<br>fun(6)   -&gt;   Segmentation falut<br></code></pre></div></td></tr></table></figure>\n\n<p><img src=\"/2023/03/13/CMU15-213001/image-20230313201550219.png\" alt=\"image-20230313201550219\"></p>\n<p>ã€å›¾ä¸­å‡è®¾memory lineå¤§å°ä¸º4Bã€‘æ ¹æ®ç»“æ„ä½“å¯çŸ¥æˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªintå‹çš„æ•°ç»„å¤§å°ä¸º2ï¼Œä¸€ä¸ªdoubleå‹çš„å˜é‡ã€‚å› ä¸ºintæ•°ç»„çš„å¤§å°ä¸º2ï¼Œå½“fun(0),fun(1)æ—¶ï¼Œs.a[i]è®¿é—®æ˜¯æ­£ç¡®çš„ï¼Œæ‰€ä»¥fun(0),fun(1)è¿”å›æ­£ç¡®å€¼s.dåŠ3.14ã€‚è€Œå½“fun(i):i&gt;1æ—¶ï¼Œå°±ä¼šè¿”å›å¥‡æ€ªçš„ç»“æœï¼Œè¿™æ˜¯å› ä¸ºæ•°ç»„å¤§å°ä¸º2ï¼Œæˆ‘ä»¬è¶Šç•Œäº†ï¼Œå®é™…ä¸Šs.a[i]å†™çš„æ˜¯doubleçš„å†…å­˜ç©ºé—´ï¼Œå¦‚å›¾ä¸­çš„2ï¼Œ3ã€‚è€Œ6ä»£è¡¨ç¨‹åºçŠ¶æ€ï¼Œæˆ‘ä»¬å»ä¿®æ”¹å®ƒå°±ä¼šé€ æˆç¨‹åºçŠ¶æ€çš„æ”¹å˜ï¼Œå¯¼è‡´Segmentation faultã€‚è¿™é‡Œæé†’æˆ‘ä»¬åœ¨å†™Cä»£ç çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„è¾¹ç•Œå¤„ç†ã€‚ã€è¿™é‡Œéœ€è¦æ¸…æ¥šCè¯­è¨€ä¸­å †åŒºå’Œæ ˆåŒºå­˜çš„æ˜¯ä»€ä¹ˆã€‘</p>\n<h3 id=\"ä¾‹å­äºŒï¼š\"><a href=\"#ä¾‹å­äºŒï¼š\" class=\"headerlink\" title=\"ä¾‹å­äºŒï¼š\"></a>ä¾‹å­äºŒï¼š</h3><p><img src=\"/2023/03/13/CMU15-213001/image-20230313202535864.png\" alt=\"image-20230313202535864\"></p>\n<p>ã€srcå’Œdstæ˜¯å¤§å°2048*2048çš„äºŒç»´æ•°ç»„ã€‘ä¸Šé¢çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥ååˆ†æ¸…æ¥šä»£ç çš„é€»è¾‘ã€‚ä»–æƒ³æŠŠsrcæ•°ç»„çš„å€¼æ‹·è´åˆ°dstã€‚è€Œå·¦å³ä»£ç çš„åŠŸèƒ½å®Œå…¨ä¸€æ ·ï¼Œä»…ä»…æ˜¯forå¾ªç¯é¡ºåºä¸ä¸€æ ·ï¼Œä½†æ˜¯å´ä¼šæœ‰è¿™ä¹ˆå¤§çš„æ€§èƒ½å·®è·ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿæ€»çš„æ¥è¯´å°±æ˜¯å·¦è¾¹ä»£ç cacheå‘½ä¸­ç‡é«˜ï¼Œå³è¾¹cacheå‘½ä¸­ç‡çš„ã€‚cacheå‘½ä¸­å’Œcache missçš„é€Ÿåº¦å·®è·å¾ˆå¤§ç”šè‡³æ˜¯æ•°é‡çº§åˆ«çš„å·®è·ï¼Œè¿™æ˜¯å¯¼è‡´ä¸¤è€…å·®è·å·¨å¤§çš„åŸå› ã€‚ã€æ³¨æ„è¿™é‡Œè¿˜å¯ä»¥æ›´ç»†è‡´çš„åˆ†æï¼Œä½†æ˜¯ä¼šæœ‰å¾ˆå¤šå…¶ä»–å› ç´ ä¼šå½±å“ã€‘</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p><a href=\"http://www.cs.cmu.edu/afs/cs/academic/class/15213-f15/www/index.html\">15-213: Introduction to Computer Systems (cmu.edu)</a></p>\n",
            "tags": [
                "CMU",
                "CSAPP"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/13/CMU15-213/",
            "url": "https://xingyuanjie.top/2023/03/13/CMU15-213/",
            "title": "2015 CMU 15-213 CSAPP æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ",
            "date_published": "2023-03-13T10:29:35.000Z",
            "content_html": "<h1 id=\"2015-CMU-15-213-CSAPP-æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ\"><a href=\"#2015-CMU-15-213-CSAPP-æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ\" class=\"headerlink\" title=\"2015 CMU 15-213 CSAPP æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ\"></a>2015 CMU 15-213 CSAPP æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ</h1><p><strong>é¡¹ç›®åœ°å€ï¼š</strong><a href=\"https://github.com/EugeneLiu/translationCSAPP\">EugeneLiu&#x2F;translationCSAPP: ä¸º CSAPP è§†é¢‘è¯¾ç¨‹æä¾›å­—å¹•ï¼Œç¿»è¯‘ PPTï¼ŒLabã€‚ (github.com)</a></p>\n<p><strong>bilibiliç¿»è¯‘ï¼š</strong><a href=\"https://www.bilibili.com/video/av31289365/\">ã€ç²¾æ ¡ä¸­è‹±å­—å¹•ã€‘2015 CMU 15-213 CSAPP æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ è¯¾ç¨‹è§†é¢‘_å“”å“©å“”å“©_bilibili</a></p>\n<h2 id=\"CSAPP-3e-å®˜æ–¹é“¾æ¥\"><a href=\"#CSAPP-3e-å®˜æ–¹é“¾æ¥\" class=\"headerlink\" title=\"CSAPP:3e å®˜æ–¹é“¾æ¥\"></a>CSAPP:3e å®˜æ–¹é“¾æ¥</h2><ul>\n<li><a href=\"http://csapp.cs.cmu.edu/\">è¯¾ç¨‹ä¸»é¡µ</a></li>\n<li><a href=\"http://www.cs.cmu.edu/afs/cs/academic/class/15213-f15/www/schedule.html\">è¯¾ä»¶ä¸‹è½½é“¾æ¥</a></li>\n<li><a href=\"http://csapp.cs.cmu.edu/3e/labs.html\">è¯¾ç¨‹ Lab é¡µé¢</a></li>\n<li><a href=\"https://scs.hosted.panopto.com/Panopto/Pages/Sessions/List.aspx#folderID=%22b96d90ae-9871-4fae-91e2-b1627b43e25e%22&sortColumn=0&sortAscending=true\">è¯¾ç¨‹è§†é¢‘åœ°å€</a></li>\n</ul>\n",
            "tags": [
                "CMU",
                "CSAPP"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/13/ML003/",
            "url": "https://xingyuanjie.top/2023/03/13/ML003/",
            "title": "çº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™",
            "date_published": "2023-03-13T06:37:12.000Z",
            "content_html": "<h2 id=\"çº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™\"><a href=\"#çº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™\" class=\"headerlink\" title=\"çº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™\"></a>çº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™</h2><p><img src=\"/2023/03/13/ML003/image-20230313145346118.png\" alt=\"image-20230313145346118\"></p>\n<h2 id=\"Goals\"><a href=\"#Goals\" class=\"headerlink\" title=\"Goals\"></a>Goals</h2><p>åœ¨æœ¬å®éªŒä¸­ï¼Œæ‚¨å°†:</p>\n<ul>\n<li>ä½¿ç”¨æ¢¯åº¦ä¸‹é™è‡ªåŠ¨ä¼˜åŒ–wå’Œbçš„è¿‡ç¨‹</li>\n</ul>\n<h2 id=\"Tools\"><a href=\"#Tools\" class=\"headerlink\" title=\"Tools\"></a>Tools</h2><p>åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨:</p>\n<ul>\n<li>NumPyï¼Œä¸€ä¸ªç”¨äºç§‘å­¦è®¡ç®—çš„æµè¡Œåº“</li>\n<li>Matplotlibï¼Œç”¨äºç»˜åˆ¶æ•°æ®çš„æµè¡Œåº“</li>\n<li>åœ¨æœ¬åœ°ç›®å½•çš„lab_utils.pyæ–‡ä»¶ä¸­ç»˜åˆ¶ä¾‹ç¨‹</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> math, copy<br><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br><span class=\"hljs-keyword\">import</span> matplotlib.pyplot <span class=\"hljs-keyword\">as</span> plt<br>plt.style.use(<span class=\"hljs-string\">&#x27;./deeplearning.mplstyle&#x27;</span>)<br><span class=\"hljs-keyword\">from</span> lab_utils_uni <span class=\"hljs-keyword\">import</span> plt_house_x, plt_contour_wgrad, plt_divergence, plt_gradients<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"Problem-Statement\"><a href=\"#Problem-Statement\" class=\"headerlink\" title=\"Problem Statement\"></a>Problem Statement</h2><p>è®©æˆ‘ä»¬ä½¿ç”¨ä¸ä¹‹å‰ç›¸åŒçš„ä¸¤ä¸ªæ•°æ®ç‚¹â€”â€”1000å¹³æ–¹è‹±å°ºçš„æˆ¿å­ä»¥30ä¸‡ç¾å…ƒçš„ä»·æ ¼å‡ºå”®ï¼Œ2000å¹³æ–¹è‹±å°ºçš„æˆ¿å­ä»¥50ä¸‡ç¾å…ƒçš„ä»·æ ¼å‡ºå”®ã€‚</p>\n<table>\n<thead>\n<tr>\n<th>Size(1000 sqft)</th>\n<th>Price(1000s of dollars)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>300</td>\n</tr>\n<tr>\n<td>2</td>\n<td>500</td>\n</tr>\n</tbody></table>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#Load our data set</span><br>x_train = np.array([<span class=\"hljs-number\">1.0</span>, <span class=\"hljs-number\">2.0</span>])\t<span class=\"hljs-comment\">#features</span><br>y_train = np.array([<span class=\"hljs-number\">300.0</span>,<span class=\"hljs-number\">500.0</span>])\t<span class=\"hljs-comment\">#target value</span><br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"Compute-Cost\"><a href=\"#Compute-Cost\" class=\"headerlink\" title=\"Compute_Cost\"></a>Compute_Cost</h2><p>è¿™æ˜¯ä¸Šä¸€ä¸ªå®éªŒå®¤å¼€å‘çš„ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œè¿˜ä¼šç”¨åˆ°å®ƒã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs pyhton\">#Function to calculate the cost<br>def compute_cost(x, y, w, b,):<br>\t<br>\tm = x.shape[0]<br>\tcost = 0<br>\t<br>\tfor i in range(m):<br>\t\tf_wb = w * x[i] + b<br>\t\tcost = cost + (f_wb - y[i])**2<br>\ttotal_cost = 1 / (2 * m)*cost<br>\t<br>\treturn total_cost<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"Gradient-descent-summary\"><a href=\"#Gradient-descent-summary\" class=\"headerlink\" title=\"Gradient descent summary\"></a>Gradient descent summary</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨è¿™é—¨è¯¾ç¨‹ä¸­ï¼Œä½ å·²ç»å»ºç«‹äº†ä¸€ä¸ªçº¿æ€§æ¨¡å‹æ¥é¢„æµ‹f_w,b(x^i):</p>\n<p><img src=\"/2023/03/13/ML003/image-20230313150848463.png\" alt=\"image-20230313150848463\"></p>\n<p>åœ¨çº¿æ€§å›å½’ä¸­ï¼Œæ‚¨ä½¿ç”¨è¾“å…¥è®­ç»ƒæ•°æ®æ¥æ‹Ÿåˆå‚æ•°ğ‘¤,ğ‘;æ¥æœ€å°åŒ–æˆ‘ä»¬çš„é¢„æµ‹ä¹‹é—´çš„è¯¯å·®æµ‹é‡f_ğ‘¤ï¼Œğ‘(ğ‘¥^(ğ‘–))å’Œå®é™…æ•°æ®ğ‘¦(ğ‘–)ã€‚è¿™ç§æµ‹é‡æˆä¸ºä»£ä»·ï¼ŒJï¼ˆw,bï¼‰ã€‚åœ¨è®­ç»ƒä¸­ï¼Œä½ å¯ä»¥è¡¡é‡æˆ‘ä»¬æ‰€æœ‰è®­ç»ƒæ ·æœ¬çš„æˆæœ¬ğ‘¥(ğ‘–)ï¼Œğ‘¦(ğ‘–)ã€‚</p>\n<p><img src=\"/2023/03/13/ML003/image-20230313151251919.png\" alt=\"image-20230313151251919\"></p>\n<p>åœ¨è¯¾å ‚ä¸Šï¼Œæ¢¯åº¦ä¸‹é™è¢«æè¿°ä¸º:</p>\n<p><img src=\"/2023/03/13/ML003/image-20230313151329621.png\" alt=\"image-20230313151329621\"></p>\n<p>å…¶ä¸­å‚æ•°ğ‘¤,ğ‘åŒæ—¶æ›´æ–°ã€‚</p>\n<p><img src=\"/2023/03/13/ML003/image-20230313151450500.png\" alt=\"image-20230313151450500\"></p>\n<p>è¿™é‡ŒåŒæ—¶æ„å‘³ç€åœ¨æ›´æ–°ä»»ä½•å‚æ•°ä¹‹å‰è®¡ç®—æ‰€æœ‰å‚æ•°çš„åå¯¼æ•°ã€‚</p>\n<h2 id=\"Implement-Gradient-Descent\"><a href=\"#Implement-Gradient-Descent\" class=\"headerlink\" title=\"Implement Gradient Descent\"></a>Implement Gradient Descent</h2><p>ä½ å°†ä¸ºä¸€ä¸ªç‰¹å¾å®ç°æ¢¯åº¦ä¸‹é™ç®—æ³•ã€‚ä½ éœ€è¦ä¸‰ä¸ªå‡½æ•°ã€‚</p>\n<ul>\n<li>compute_gradientå®ç°ä¸Šè¿°å¼(4)å’Œ(5)</li>\n<li>ä¸Šé¢çš„compute_costå®ç°æ–¹ç¨‹(2)(ä»£ç æ¥è‡ªä»¥å‰çš„å®éªŒå®¤)</li>\n<li>gradient_descentï¼Œä½¿ç”¨compute_gradientå’Œcompute_cost</li>\n</ul>\n<p>Conventions:</p>\n<p><img src=\"/2023/03/13/ML003/image-20230313151857315.png\" alt=\"image-20230313151857315\"></p>\n<h2 id=\"compute-gradient\"><a href=\"#compute-gradient\" class=\"headerlink\" title=\"compute_gradient\"></a>compute_gradient</h2><p><img src=\"/2023/03/13/ML003/image-20230313151947363.png\" alt=\"image-20230313151947363\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">compute_gradient</span>(<span class=\"hljs-params\">x, y, w, b</span>):</span><br>    <span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">    Computes the gradient for linear regression</span><br><span class=\"hljs-string\">    Args:</span><br><span class=\"hljs-string\">    \tx (ndarray (m,)): Data, m examples</span><br><span class=\"hljs-string\">    \ty (ndarray (m,)): target values</span><br><span class=\"hljs-string\">    \tw,b (scalar)\t: model parameters</span><br><span class=\"hljs-string\">    Returns</span><br><span class=\"hljs-string\">    \tdj_dw (scalar): The gradient of the cost w.r.t. the parameters w</span><br><span class=\"hljs-string\">    \tdj_db (scalar): The gradient of the cost w.r.t. the parameter b </span><br><span class=\"hljs-string\">    &quot;&quot;&quot;</span><br>    <br>    <span class=\"hljs-comment\">#Number of training examples</span><br>    m = x.shape[<span class=\"hljs-number\">0</span>]<br>    dj_de = <span class=\"hljs-number\">0</span><br>    dj_db = <span class=\"hljs-number\">0</span><br>    <br>    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(m):<br>        f_wb = w * x[i] + b;<br>        dj_dw_i = (f_wb - y[i]) * x[i]<br>        dj_db_i = f_wb - y[i]<br>        dj_db += dj_db_i<br>        dj_dw += dj_dw_i<br>    dj_dw = dj_dw / m<br>    dj_db = dj_db / m<br>    <br>    <span class=\"hljs-keyword\">return</span> dj_dw, dj_db<br></code></pre></div></td></tr></table></figure>\n\n<p>è¯¾ç¨‹æè¿°äº†æ¢¯åº¦ä¸‹é™å¦‚ä½•åˆ©ç”¨åœ¨æŸä¸€ç‚¹ä¸Šå¯¹å‚æ•°ä»£ä»·çš„åå¯¼æ•°æ¥æ›´æ–°è¯¥å‚æ•°ã€‚</p>\n<p>è®©æˆ‘ä»¬ä½¿ç”¨compute_gradientå‡½æ•°æ¥æŸ¥æ‰¾å¹¶ç»˜åˆ¶ä»£ä»·å‡½æ•°ç›¸å¯¹äºå…¶ä¸­ä¸€ä¸ªå‚æ•°ğ‘¤0çš„åå¯¼æ•°ã€‚</p>\n<p><img src=\"/2023/03/13/ML003/image-20230313154012173.png\" alt=\"image-20230313154012173\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">plt_gradients(x_train,y_train, compute_cost, compute_gradient)<br>plt.show()<br></code></pre></div></td></tr></table></figure>\n\n<p><img src=\"/2023/03/13/ML003/image-20230313154210478.png\" alt=\"image-20230313154210478\"></p>\n<p><img src=\"/2023/03/13/ML003/image-20230313154333429.png\" alt=\"image-20230313154333429\"></p>\n<h2 id=\"Gradient-Descent\"><a href=\"#Gradient-Descent\" class=\"headerlink\" title=\"Gradient Descent\"></a>Gradient Descent</h2><p>ç°åœ¨å¯ä»¥è®¡ç®—æ¢¯åº¦ï¼Œä¸Šé¢å…¬å¼(3)ä¸­æè¿°çš„æ¢¯åº¦ä¸‹é™å¯ä»¥åœ¨ä¸‹é¢çš„gradient_descentä¸­å®ç°ã€‚æ³¨é‡Šä¸­æè¿°äº†å®ç°çš„ç»†èŠ‚ã€‚ä¸‹é¢ï¼Œæ‚¨å°†åˆ©ç”¨è¿™ä¸ªå‡½æ•°åœ¨è®­ç»ƒæ•°æ®ä¸Šæ‰¾åˆ°wå’Œbçš„æœ€ä½³å€¼ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">gradient_descent</span>(<span class=\"hljs-params\">x, y, w_in, b_in, alpha, num_iters, cost_function, gradient_function</span>):</span> <br>    <span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">    Performs gradient descent to fit w,b. Updates w,b by taking </span><br><span class=\"hljs-string\">    num_iters gradient steps with learning rate alpha</span><br><span class=\"hljs-string\">    </span><br><span class=\"hljs-string\">    Args:</span><br><span class=\"hljs-string\">      x (ndarray (m,))  : Data, m examples </span><br><span class=\"hljs-string\">      y (ndarray (m,))  : target values</span><br><span class=\"hljs-string\">      w_in,b_in (scalar): initial values of model parameters  </span><br><span class=\"hljs-string\">      alpha (float):     Learning rate</span><br><span class=\"hljs-string\">      num_iters (int):   number of iterations to run gradient descent</span><br><span class=\"hljs-string\">      cost_function:     function to call to produce cost</span><br><span class=\"hljs-string\">      gradient_function: function to call to produce gradient</span><br><span class=\"hljs-string\">      </span><br><span class=\"hljs-string\">    Returns:</span><br><span class=\"hljs-string\">      w (scalar): Updated value of parameter after running gradient descent</span><br><span class=\"hljs-string\">      b (scalar): Updated value of parameter after running gradient descent</span><br><span class=\"hljs-string\">      J_history (List): History of cost values</span><br><span class=\"hljs-string\">      p_history (list): History of parameters [w,b] </span><br><span class=\"hljs-string\">      &quot;&quot;&quot;</span><br>    <br>    w = copy.deepcopy(w_in) <span class=\"hljs-comment\"># avoid modifying global w_in</span><br>    <span class=\"hljs-comment\"># An array to store cost J and w&#x27;s at each iteration primarily for graphing later</span><br>    J_history = []<br>    p_history = []<br>    b = b_in<br>    w = w_in<br>    <br>    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(num_iters):<br>        <span class=\"hljs-comment\"># Calculate the gradient and update the parameters using gradient_function</span><br>        dj_dw, dj_db = gradient_function(x, y, w , b)     <br><br>        <span class=\"hljs-comment\"># Update Parameters using equation (3) above</span><br>        b = b - alpha * dj_db                            <br>        w = w - alpha * dj_dw                            <br><br>        <span class=\"hljs-comment\"># Save cost J at each iteration</span><br>        <span class=\"hljs-keyword\">if</span> i&lt;<span class=\"hljs-number\">100000</span>:      <span class=\"hljs-comment\"># prevent resource exhaustion </span><br>            J_history.append( cost_function(x, y, w , b))<br>            p_history.append([w,b])<br>        <span class=\"hljs-comment\"># Print cost every at intervals 10 times or as many iterations if &lt; 10</span><br>        <span class=\"hljs-keyword\">if</span> i% math.ceil(num_iters/<span class=\"hljs-number\">10</span>) == <span class=\"hljs-number\">0</span>:<br>            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;Iteration <span class=\"hljs-subst\">&#123;i:<span class=\"hljs-number\">4</span>&#125;</span>: Cost <span class=\"hljs-subst\">&#123;J_history[-<span class=\"hljs-number\">1</span>]:<span class=\"hljs-number\">0.2</span>e&#125;</span> &quot;</span>,<br>                  <span class=\"hljs-string\">f&quot;dj_dw: <span class=\"hljs-subst\">&#123;dj_dw: <span class=\"hljs-number\">0.3</span>e&#125;</span>, dj_db: <span class=\"hljs-subst\">&#123;dj_db: <span class=\"hljs-number\">0.3</span>e&#125;</span>  &quot;</span>,<br>                  <span class=\"hljs-string\">f&quot;w: <span class=\"hljs-subst\">&#123;w: <span class=\"hljs-number\">0.3</span>e&#125;</span>, b:<span class=\"hljs-subst\">&#123;b: <span class=\"hljs-number\">0.5</span>e&#125;</span>&quot;</span>)<br> <br>    <span class=\"hljs-keyword\">return</span> w, b, J_history, p_history <span class=\"hljs-comment\">#return w and J,w history for graphing</span><br></code></pre></div></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">Iteration    <span class=\"hljs-number\">0</span>: Cost <span class=\"hljs-number\">7.93e+04</span>  dj_dw: -<span class=\"hljs-number\">6.500e+02</span>, dj_db: -<span class=\"hljs-number\">4.000e+02</span>   w:  <span class=\"hljs-number\">6.500e+00</span>, b: <span class=\"hljs-number\">4.00000e+00</span><br>Iteration <span class=\"hljs-number\">1000</span>: Cost <span class=\"hljs-number\">3.41e+00</span>  dj_dw: -<span class=\"hljs-number\">3.712e-01</span>, dj_db:  <span class=\"hljs-number\">6.007e-01</span>   w:  <span class=\"hljs-number\">1.949e+02</span>, b: <span class=\"hljs-number\">1.08228e+02</span><br>Iteration <span class=\"hljs-number\">2000</span>: Cost <span class=\"hljs-number\">7.93e-01</span>  dj_dw: -<span class=\"hljs-number\">1.789e-01</span>, dj_db:  <span class=\"hljs-number\">2.895e-01</span>   w:  <span class=\"hljs-number\">1.975e+02</span>, b: <span class=\"hljs-number\">1.03966e+02</span><br>Iteration <span class=\"hljs-number\">3000</span>: Cost <span class=\"hljs-number\">1.84e-01</span>  dj_dw: -<span class=\"hljs-number\">8.625e-02</span>, dj_db:  <span class=\"hljs-number\">1.396e-01</span>   w:  <span class=\"hljs-number\">1.988e+02</span>, b: <span class=\"hljs-number\">1.01912e+02</span><br>Iteration <span class=\"hljs-number\">4000</span>: Cost <span class=\"hljs-number\">4.28e-02</span>  dj_dw: -<span class=\"hljs-number\">4.158e-02</span>, dj_db:  <span class=\"hljs-number\">6.727e-02</span>   w:  <span class=\"hljs-number\">1.994e+02</span>, b: <span class=\"hljs-number\">1.00922e+02</span><br>Iteration <span class=\"hljs-number\">5000</span>: Cost <span class=\"hljs-number\">9.95e-03</span>  dj_dw: -<span class=\"hljs-number\">2.004e-02</span>, dj_db:  <span class=\"hljs-number\">3.243e-02</span>   w:  <span class=\"hljs-number\">1.997e+02</span>, b: <span class=\"hljs-number\">1.00444e+02</span><br>Iteration <span class=\"hljs-number\">6000</span>: Cost <span class=\"hljs-number\">2.31e-03</span>  dj_dw: -<span class=\"hljs-number\">9.660e-03</span>, dj_db:  <span class=\"hljs-number\">1.563e-02</span>   w:  <span class=\"hljs-number\">1.999e+02</span>, b: <span class=\"hljs-number\">1.00214e+02</span><br>Iteration <span class=\"hljs-number\">7000</span>: Cost <span class=\"hljs-number\">5.37e-04</span>  dj_dw: -<span class=\"hljs-number\">4.657e-03</span>, dj_db:  <span class=\"hljs-number\">7.535e-03</span>   w:  <span class=\"hljs-number\">1.999e+02</span>, b: <span class=\"hljs-number\">1.00103e+02</span><br>Iteration <span class=\"hljs-number\">8000</span>: Cost <span class=\"hljs-number\">1.25e-04</span>  dj_dw: -<span class=\"hljs-number\">2.245e-03</span>, dj_db:  <span class=\"hljs-number\">3.632e-03</span>   w:  <span class=\"hljs-number\">2.000e+02</span>, b: <span class=\"hljs-number\">1.00050e+02</span><br>Iteration <span class=\"hljs-number\">9000</span>: Cost <span class=\"hljs-number\">2.90e-05</span>  dj_dw: -<span class=\"hljs-number\">1.082e-03</span>, dj_db:  <span class=\"hljs-number\">1.751e-03</span>   w:  <span class=\"hljs-number\">2.000e+02</span>, b: <span class=\"hljs-number\">1.00024e+02</span><br>(w,b) found by gradient descent: (<span class=\"hljs-number\">199.9929</span>,<span class=\"hljs-number\">100.0116</span>)<br></code></pre></div></td></tr></table></figure>\n\n<p>èŠ±ç‚¹æ—¶é—´ï¼Œæ³¨æ„ä¸Šé¢æ‰“å°çš„æ¢¯åº¦ä¸‹é™è¿‡ç¨‹çš„ä¸€äº›ç‰¹å¾ã€‚</p>\n<ul>\n<li>æ­£å¦‚è¯¾å ‚ä¸Šçš„å¹»ç¯ç‰‡æ‰€æè¿°çš„ï¼Œæˆæœ¬å¼€å§‹å¾ˆå¤§ï¼Œç„¶åè¿…é€Ÿä¸‹é™ã€‚</li>\n<li>åå¯¼æ•°dj_dwå’Œdj_dbä¹Ÿå˜å°äº†ï¼Œèµ·åˆå¾ˆå¿«ï¼Œç„¶åå˜æ…¢ã€‚æ­£å¦‚è¯¾å ‚ä¸Šçš„å›¾è¡¨æ‰€ç¤ºï¼Œéšç€è¿‡ç¨‹æ¥è¿‘â€œç¢—åº•â€ï¼Œç”±äºåœ¨è¿™ä¸€ç‚¹ä¸Šçš„å¯¼æ•°å€¼è¾ƒå°ï¼Œè¿›ç¨‹ä¼šå˜æ…¢ã€‚</li>\n<li>å°½ç®¡å­¦ä¹ ç‡alphaä¿æŒä¸å˜ï¼Œä½†è¿›ç¨‹ä¼šå‡æ…¢</li>\n</ul>\n<p><img src=\"/2023/03/13/ML003/image-20230313155614815.png\" alt=\"image-20230313155614815\"></p>\n<h2 id=\"Cost-versus-iterations-of-gradient-descent\"><a href=\"#Cost-versus-iterations-of-gradient-descent\" class=\"headerlink\" title=\"Cost versus iterations of gradient descent\"></a>Cost versus iterations of gradient descent</h2><p>æˆæœ¬ä¸è¿­ä»£çš„å…³ç³»å›¾æ˜¯è¡¡é‡æ¢¯åº¦ä¸‹é™æŠ€æœ¯è¿›å±•çš„æœ‰ç”¨æ–¹æ³•ã€‚åœ¨æˆåŠŸçš„è¿è¡Œä¸­ï¼Œæˆæœ¬æ€»æ˜¯ä¼šé™ä½ã€‚æœ€åˆæˆæœ¬çš„å˜åŒ–å¦‚æ­¤ä¹‹å¿«ï¼Œç”¨ä¸åŒäºæœ€ç»ˆä¸‹é™çš„å°ºåº¦æ¥æç»˜æœ€åˆçš„ä¸Šå‡æ˜¯æœ‰ç”¨çš„ã€‚</p>\n<p>åœ¨ä¸‹é¢çš„å›¾è¡¨ä¸­ï¼Œè¯·æ³¨æ„è½´ä¸Šçš„æˆæœ¬è§„æ¨¡å’Œè¿­ä»£æ­¥éª¤ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># plot cost versus iteration  </span><br>fig, (ax1, ax2) = plt.subplots(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, constrained_layout=<span class=\"hljs-literal\">True</span>, figsize=(<span class=\"hljs-number\">12</span>,<span class=\"hljs-number\">4</span>))<br>ax1.plot(J_hist[:<span class=\"hljs-number\">100</span>])<br>ax2.plot(<span class=\"hljs-number\">1000</span> + np.arange(<span class=\"hljs-built_in\">len</span>(J_hist[<span class=\"hljs-number\">1000</span>:])), J_hist[<span class=\"hljs-number\">1000</span>:])<br>ax1.set_title(<span class=\"hljs-string\">&quot;Cost vs. iteration(start)&quot;</span>);  ax2.set_title(<span class=\"hljs-string\">&quot;Cost vs. iteration (end)&quot;</span>)<br>ax1.set_ylabel(<span class=\"hljs-string\">&#x27;Cost&#x27;</span>)            ;  ax2.set_ylabel(<span class=\"hljs-string\">&#x27;Cost&#x27;</span>) <br>ax1.set_xlabel(<span class=\"hljs-string\">&#x27;iteration step&#x27;</span>)  ;  ax2.set_xlabel(<span class=\"hljs-string\">&#x27;iteration step&#x27;</span>) <br>plt.show()<br></code></pre></div></td></tr></table></figure>\n\n<p><img src=\"/2023/03/13/ML003/image-20230313160112122.png\" alt=\"image-20230313160112122\"></p>\n<h2 id=\"Predictions\"><a href=\"#Predictions\" class=\"headerlink\" title=\"Predictions\"></a>Predictions</h2><p>ç°åœ¨æ‚¨å·²ç»å‘ç°äº†å‚æ•°ğ‘¤çš„æœ€ä½³å€¼å’Œğ‘ï¼Œæ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨è¯¥æ¨¡å‹æ ¹æ®æˆ‘ä»¬å­¦ä¹ çš„å‚æ•°æ¥é¢„æµ‹æˆ¿å±‹ä»·å€¼ã€‚æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œåœ¨ç›¸åŒçš„ä½æˆ¿æ¡ä»¶ä¸‹ï¼Œé¢„æµ‹å€¼ä¸è®­ç»ƒå€¼å‡ ä¹ç›¸åŒã€‚è¿›ä¸€æ­¥ï¼Œä¸åœ¨é¢„æµ‹ä¸­çš„å€¼ä¸æœŸæœ›å€¼ä¸€è‡´ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;1000 sqft house prediction <span class=\"hljs-subst\">&#123;w_final*<span class=\"hljs-number\">1.0</span> + b_final:<span class=\"hljs-number\">0.1</span>f&#125;</span> Thousand dollars&quot;</span>)<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;1200 sqft house prediction <span class=\"hljs-subst\">&#123;w_final*<span class=\"hljs-number\">1.2</span> + b_final:<span class=\"hljs-number\">0.1</span>f&#125;</span> Thousand dollars&quot;</span>)<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;2000 sqft house prediction <span class=\"hljs-subst\">&#123;w_final*<span class=\"hljs-number\">2.0</span> + b_final:<span class=\"hljs-number\">0.1</span>f&#125;</span> Thousand dollars&quot;</span>)<br></code></pre></div></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-number\">1000</span> sqft house prediction <span class=\"hljs-number\">300.0</span> Thousand dollars<br><span class=\"hljs-number\">1200</span> sqft house prediction <span class=\"hljs-number\">340.0</span> Thousand dollars<br><span class=\"hljs-number\">2000</span> sqft house prediction <span class=\"hljs-number\">500.0</span> Thousand dollars<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"Plotting\"><a href=\"#Plotting\" class=\"headerlink\" title=\"Plotting\"></a>Plotting</h2><p>æ‚¨å¯ä»¥é€šè¿‡åœ¨ä»£ä»·(w,b)çš„ç­‰é«˜çº¿å›¾ä¸Šç»˜åˆ¶è¿­ä»£çš„ä»£ä»·æ¥æ˜¾ç¤ºæ¢¯åº¦ä¸‹é™åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¿›åº¦ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">fig, ax = plt.subplots(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>, figsize=(<span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">6</span>))<br>plt_contour_wgrad(x_train, y_train, p_hist, ax)<br></code></pre></div></td></tr></table></figure>\n\n<p><img src=\"/2023/03/13/ML003/image-20230313160446994.png\" alt=\"image-20230313160446994\"></p>\n<p>ä¸Šé¢çš„ç­‰é«˜çº¿å›¾æ˜¾ç¤ºäº†ğ‘¤å’Œğ‘èŒƒå›´å†…çš„ğ‘ğ‘œğ‘ ğ‘¡(ğ‘¤ï¼Œğ‘)ã€‚æˆæœ¬æ°´å¹³ç”±åœ†ç¯è¡¨ç¤ºã€‚ç”¨çº¢è‰²ç®­å¤´è¦†ç›–çš„æ˜¯æ¢¯åº¦ä¸‹é™çš„è·¯å¾„ã€‚è¿™é‡Œæœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„äº‹æƒ…:</p>\n<ul>\n<li>è¿™æ¡è·¯å¾„æœç€å®ƒçš„ç›®æ ‡ç¨³æ­¥(å•è°ƒ)å‰è¿›ã€‚</li>\n<li>æœ€åˆçš„æ­¥éª¤æ¯”æ¥è¿‘ç›®æ ‡çš„æ­¥éª¤è¦å¤§å¾—å¤šã€‚</li>\n</ul>\n<p>æ”¾å¤§ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¢¯åº¦ä¸‹é™çš„æœ€åæ­¥éª¤ã€‚æ³¨æ„ï¼Œé˜¶æ¢¯ä¹‹é—´çš„è·ç¦»éšç€æ¢¯åº¦è¶‹è¿‘äºé›¶è€Œç¼©å°ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">fig, ax = plt.subplots(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>, figsize=(<span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">4</span>))<br>plt_contour_wgrad(x_train, y_train, p_hist, ax, w_range=[<span class=\"hljs-number\">180</span>, <span class=\"hljs-number\">220</span>, <span class=\"hljs-number\">0.5</span>], b_range=[<span class=\"hljs-number\">80</span>, <span class=\"hljs-number\">120</span>, <span class=\"hljs-number\">0.5</span>],<br>            contours=[<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">20</span>],resolution=<span class=\"hljs-number\">0.5</span>)<br></code></pre></div></td></tr></table></figure>\n\n<p><img src=\"/2023/03/13/ML003/image-20230313160944244.png\" alt=\"image-20230313160944244\"></p>\n<h2 id=\"Increased-Learning-Rate\"><a href=\"#Increased-Learning-Rate\" class=\"headerlink\" title=\"Increased Learning Rate\"></a>Increased Learning Rate</h2><p>åœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œåœ¨å¼(3)ä¸­æœ‰ä¸€ä¸ªå…³äºå­¦ä¹ ç‡çš„åˆé€‚å€¼ğ›¼çš„è®¨è®ºã€‚ğ›¼è¶Šå¤§ï¼Œæ¢¯åº¦ä¸‹é™æ”¶æ•›åˆ°è§£çš„é€Ÿåº¦å°±è¶Šå¿«ã€‚ä½†æ˜¯ï¼Œå¦‚æœå®ƒå¤ªå¤§ï¼Œæ¢¯åº¦ä¸‹é™å°±ä¼šå‘æ•£ã€‚ä¸Šé¢æœ‰ä¸€ä¸ªå¾ˆå¥½æ”¶æ•›çš„è§£çš„ä¾‹å­ã€‚è®©æˆ‘ä»¬è¯•ç€å¢åŠ ğ›¼çš„å€¼çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ:</p>\n<p><img src=\"/2023/03/13/ML003/image-20230313161516209.png\" alt=\"image-20230313161516209\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># initialize parameters</span><br>w_init = <span class=\"hljs-number\">0</span><br>b_init = <span class=\"hljs-number\">0</span><br><span class=\"hljs-comment\"># set alpha to a large value</span><br>iterations = <span class=\"hljs-number\">10</span><br>tmp_alpha = <span class=\"hljs-number\">8.0e-1</span><br><span class=\"hljs-comment\"># run gradient descent</span><br>w_final, b_final, J_hist, p_hist = gradient_descent(x_train ,y_train, w_init, b_init, tmp_alpha, <br>                                                    iterations, compute_cost, compute_gradient)<br></code></pre></div></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs pyhton\">Iteration    0: Cost 2.58e+05  dj_dw: -6.500e+02, dj_db: -4.000e+02   w:  5.200e+02, b: 3.20000e+02<br>Iteration    1: Cost 7.82e+05  dj_dw:  1.130e+03, dj_db:  7.000e+02   w: -3.840e+02, b:-2.40000e+02<br>Iteration    2: Cost 2.37e+06  dj_dw: -1.970e+03, dj_db: -1.216e+03   w:  1.192e+03, b: 7.32800e+02<br>Iteration    3: Cost 7.19e+06  dj_dw:  3.429e+03, dj_db:  2.121e+03   w: -1.551e+03, b:-9.63840e+02<br>Iteration    4: Cost 2.18e+07  dj_dw: -5.974e+03, dj_db: -3.691e+03   w:  3.228e+03, b: 1.98886e+03<br>Iteration    5: Cost 6.62e+07  dj_dw:  1.040e+04, dj_db:  6.431e+03   w: -5.095e+03, b:-3.15579e+03<br>Iteration    6: Cost 2.01e+08  dj_dw: -1.812e+04, dj_db: -1.120e+04   w:  9.402e+03, b: 5.80237e+03<br>Iteration    7: Cost 6.09e+08  dj_dw:  3.156e+04, dj_db:  1.950e+04   w: -1.584e+04, b:-9.80139e+03<br>Iteration    8: Cost 1.85e+09  dj_dw: -5.496e+04, dj_db: -3.397e+04   w:  2.813e+04, b: 1.73730e+04<br>Iteration    9: Cost 5.60e+09  dj_dw:  9.572e+04, dj_db:  5.916e+04   w: -4.845e+04, b:-2.99567e+04<br></code></pre></div></td></tr></table></figure>\n\n<p><img src=\"/2023/03/13/ML003/image-20230313161636772.png\" alt=\"image-20230313161636772\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">plt_divergence(p_hist, J_hist,x_train, y_train)<br>plt.show()<br></code></pre></div></td></tr></table></figure>\n\n<p><img src=\"/2023/03/13/ML003/image-20230313161959222.png\" alt=\"image-20230313161959222\"></p>\n<p>ä¸Šå›¾ä¸­ï¼Œå·¦å›¾æ˜¾ç¤ºäº†ğ‘¤åœ¨æ¢¯åº¦ä¸‹é™çš„å‰å‡ ä¸ªæ­¥éª¤ä¸­çš„è¿›å±•ã€‚ğ‘¤ä»æ­£æŒ¯è¡åˆ°è´Ÿï¼Œæˆæœ¬è¿…é€Ÿå¢é•¿ã€‚æ¢¯åº¦ä¸‹é™åŒæ—¶åœ¨ğ‘¤å’Œğ‘ä¸Šè¿è¡Œï¼Œæ‰€ä»¥éœ€è¦å³è¾¹çš„3då›¾æ‰èƒ½çœ‹åˆ°å®Œæ•´çš„å›¾ç‰‡ã€‚</p>\n<h2 id=\"Congratulations\"><a href=\"#Congratulations\" class=\"headerlink\" title=\"Congratulations!\"></a>Congratulations!</h2><p>åœ¨è¿™ä¸ªå®éªŒå®¤é‡Œï¼Œä½ :</p>\n<ul>\n<li>æ·±å…¥ç ”ç©¶å•ä¸ªå˜é‡çš„æ¢¯åº¦ä¸‹é™çš„ç»†èŠ‚ã€‚</li>\n<li>å¼€å‘äº†ä¸€ä¸ªè®¡ç®—æ¢¯åº¦çš„ç¨‹åº</li>\n<li>çœ‹çœ‹æ¢¯åº¦æ˜¯ä»€ä¹ˆ</li>\n<li>å®Œæˆä¸€ä¸ªæ¢¯åº¦ä¸‹é™ç¨‹åº</li>\n<li>åˆ©ç”¨æ¢¯åº¦ä¸‹é™æ³•å¯»æ‰¾å‚æ•°</li>\n<li>æ£€æŸ¥äº†å­¦ä¹ ç‡å¤§å°çš„å½±å“</li>\n</ul>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p><a href=\"https://www.bilibili.com/video/BV1Pa411X76s?p=5&amp;vd_source=3ae32e36058f58c5b85935fca9b77797\">https://www.bilibili.com/video/BV1Pa411X76s?p=5&amp;vd_source=3ae32e36058f58c5b85935fca9b77797</a></p>\n<p><a href=\"https://github.com/kaieye/2022-Machine-Learning-Specialization\">kaieye&#x2F;2022-Machine-Learning-Specialization (github.com)</a></p>\n",
            "tags": [
                "Tensorflow",
                "Machine Learning"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/12/ML002/",
            "url": "https://xingyuanjie.top/2023/03/12/ML002/",
            "title": "ä»£ä»·å‡½æ•°",
            "date_published": "2023-03-12T08:33:17.000Z",
            "content_html": "<h2 id=\"ä»£ä»·å‡½æ•°\"><a href=\"#ä»£ä»·å‡½æ•°\" class=\"headerlink\" title=\"ä»£ä»·å‡½æ•°\"></a>ä»£ä»·å‡½æ•°</h2><p><img src=\"/2023/03/12/ML002/image-20230312164306128.png\" alt=\"image-20230312164306128\"></p>\n<h2 id=\"ç›®æ ‡\"><a href=\"#ç›®æ ‡\" class=\"headerlink\" title=\"ç›®æ ‡\"></a>ç›®æ ‡</h2><p>åœ¨æœ¬å®éªŒä¸­ï¼Œä½ å°†:</p>\n<ul>\n<li>ä½ å°†å®ç°å’Œæ¢ç´¢æˆæœ¬å‡½æ•°çš„çº¿æ€§å›å½’ä¼´éšä¸€ä¸ªå˜é‡ã€‚</li>\n</ul>\n<h2 id=\"å·¥å…·\"><a href=\"#å·¥å…·\" class=\"headerlink\" title=\"å·¥å…·\"></a>å·¥å…·</h2><p>åœ¨æœ¬å®éªŒå®¤ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨:</p>\n<ul>\n<li>NumPyï¼Œä¸€ä¸ªç”¨äºç§‘å­¦è®¡ç®—çš„æµè¡Œåº“</li>\n<li>Matplotlibï¼Œç”¨äºç»˜åˆ¶æ•°æ®çš„æµè¡Œåº“</li>\n<li>æœ¬åœ°ç›®å½•çš„lab_utils_uni.pyæ–‡ä»¶ä¸­çš„æœ¬åœ°ç»˜å›¾ä¾‹ç¨‹</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> nunpy <span class=\"hljs-keyword\">as</span> np<br>%matplotlib widget<br><span class=\"hljs-keyword\">import</span> matplotlib.pyplot <span class=\"hljs-keyword\">as</span> plt<br><span class=\"hljs-keyword\">from</span> lab_utils_uni <span class=\"hljs-keyword\">import</span> plt_intuition, plt_stationary, plt_updata_onclick, soup_bowl<br>plt.style.use(<span class=\"hljs-string\">&#x27;./deeplearning.mplstyle&#x27;</span>)<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"é—®é¢˜æ„å¢ƒ\"><a href=\"#é—®é¢˜æ„å¢ƒ\" class=\"headerlink\" title=\"é—®é¢˜æ„å¢ƒ\"></a>é—®é¢˜æ„å¢ƒ</h2><p>ä½ æƒ³è¦ä¸€ä¸ªæ¨¡å‹ï¼Œå®ƒå¯ä»¥æ ¹æ®æˆ¿å­çš„å¤§å°é¢„æµ‹æˆ¿ä»·ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ä¸ä¸Šä¸€ä¸ªå®éªŒå®¤ä¹‹å‰ç›¸åŒçš„ä¸¤ä¸ªæ•°æ®ç‚¹â€”â€”ä¸€ä¸ª1000å¹³æ–¹è‹±å°ºçš„æˆ¿å­å–äº†30ä¸‡ç¾å…ƒï¼Œä¸€ä¸ª2000å¹³æ–¹è‹±å°ºçš„æˆ¿å­å–äº†50ä¸‡ç¾å…ƒã€‚</p>\n<table>\n<thead>\n<tr>\n<th>Size(1000 sqft)</th>\n<th>Price(1000s of dollars)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>300</td>\n</tr>\n<tr>\n<td>2</td>\n<td>500</td>\n</tr>\n</tbody></table>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">x_train = np.array([<span class=\"hljs-number\">1.0</span>, <span class=\"hljs-number\">2.0</span>])   <span class=\"hljs-comment\">#(size in 1000 square feet)</span><br>y_train = np.zrray([<span class=\"hljs-number\">300.0</span>, <span class=\"hljs-number\">500.0</span>])\t<span class=\"hljs-comment\">#(price in 1000s of dollars)</span><br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"è®¡ç®—ä»£ä»·\"><a href=\"#è®¡ç®—ä»£ä»·\" class=\"headerlink\" title=\"è®¡ç®—ä»£ä»·\"></a>è®¡ç®—ä»£ä»·</h2><p>è¿™ä¸ªä½œä¸šä¸­çš„æœ¯è¯­â€œæˆæœ¬â€å¯èƒ½ä¼šè®©äººæœ‰ç‚¹å›°æƒ‘ï¼Œå› ä¸ºæ•°æ®æ˜¯ä½æˆ¿æˆæœ¬ã€‚åœ¨è¿™é‡Œï¼Œæˆæœ¬æ˜¯è¡¡é‡æˆ‘ä»¬çš„æ¨¡å‹é¢„æµ‹æˆ¿å­ç›®æ ‡ä»·æ ¼çš„å¥½åã€‚â€œä»·æ ¼â€ä¸€è¯æŒ‡çš„æ˜¯ä½æˆ¿æ•°æ®ã€‚</p>\n<p>å«ä¸€ä¸ªå˜é‡çš„æˆæœ¬æ–¹ç¨‹ä¸º:</p>\n<p><img src=\"/2023/03/12/ML002/image-20230312165434160.png\" alt=\"image-20230312165434160\"></p>\n<p>åœ¨è¿™é‡Œ</p>\n<p><img src=\"/2023/03/12/ML002/image-20230312165503613.png\" alt=\"image-20230312165503613\"></p>\n<ul>\n<li>f_w,b(x^i)æ˜¯æˆ‘ä»¬ä½¿ç”¨å‚æ•°w,bæ¥é¢„æµ‹ä¾‹å­iã€‚</li>\n<li>ï¼ˆf_w,b(x^i) - y^iï¼‰^2  æ˜¯ç›®æ ‡å€¼ä¸é¢„æµ‹å€¼ä¹‹é—´çš„å·®çš„å¹³æ–¹</li>\n<li>è¿™äº›å·®å¼‚è¢«åŠ åœ¨æ‰€æœ‰mä¾‹å­ä¸Šï¼Œå†é™¤ä»¥2mï¼Œå¾—åˆ°ä»£ä»·å‡½æ•° <strong>Jï¼ˆw,bï¼‰</strong></li>\n</ul>\n<p>æ³¨æ„ï¼Œåœ¨è®²åº§ä¸­ï¼Œæ€»å’Œçš„èŒƒå›´é€šå¸¸æ˜¯ä»1åˆ°mï¼Œè€Œä»£ç å°†ä»0åˆ°m-1ã€‚</p>\n<p>ä¸‹é¢çš„ä»£ç é€šè¿‡éå†æ¯ä¸ªç¤ºä¾‹æ¥è®¡ç®—æˆæœ¬ã€‚åœ¨æ¯ä¸ªå¾ªç¯ä¸­:</p>\n<ul>\n<li>f_wbï¼Œè®¡ç®—ä¸€ä¸ªé¢„æµ‹</li>\n<li>ç›®æ ‡å’Œé¢„æµ‹ä¹‹é—´çš„å·®å€¼è¢«è®¡ç®—å’Œå¹³æ–¹ã€‚</li>\n<li>è¿™è¢«åŠ åˆ°æ€»æˆæœ¬ä¸­ã€‚</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">compute_cost</span>(<span class=\"hljs-params\">x, y, w, b</span>):</span><br>    <span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">    Computes the cost function for linear regression</span><br><span class=\"hljs-string\">    </span><br><span class=\"hljs-string\">    Args:</span><br><span class=\"hljs-string\">    \tx (ndarray (m,)):Data, m examples</span><br><span class=\"hljs-string\">    \ty (ndarray (m,)):target values</span><br><span class=\"hljs-string\">    \tw,b (scalar)\t:model parameters</span><br><span class=\"hljs-string\">    </span><br><span class=\"hljs-string\">    Returns</span><br><span class=\"hljs-string\">    \ttotal_cost (float):The cost of using w,b as the parameters for linear regression to fit the data points in x and y</span><br><span class=\"hljs-string\">    &quot;&quot;&quot;</span><br>    <span class=\"hljs-comment\">#number of training examples</span><br>    m = x.shape[<span class=\"hljs-number\">0</span>]<br>    <br>    cost_sum = <span class=\"hljs-number\">0</span><br>    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(m):<br>        f_wb = w * x[i] + b<br>        cost = (f_wb - y[i])**<span class=\"hljs-number\">2</span><br>        cost_sum = cost_sum + cost<br>    total_cost = (<span class=\"hljs-number\">1</span>/(<span class=\"hljs-number\">2</span>*m)) * cost_sum<br>    <br>    <span class=\"hljs-keyword\">return</span> total_cost<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"Cost-Function-Intuition\"><a href=\"#Cost-Function-Intuition\" class=\"headerlink\" title=\"Cost Function Intuition\"></a>Cost Function Intuition</h2><p><img src=\"/2023/03/12/ML002/image-20230312172325465.png\" alt=\"image-20230312172325465\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">plt_intuition(x_train, y_train)<br></code></pre></div></td></tr></table></figure>\n\n<p><img src=\"/2023/03/12/ML002/image-20230313144221393.png\" alt=\"image-20230313144221393\"></p>\n<p>æƒ…èŠ‚ä¸­æœ‰å‡ ç‚¹å€¼å¾—ä¸€æã€‚</p>\n<ul>\n<li>å½“ğ‘¤&#x3D;200æ—¶ï¼Œæˆæœ¬æœ€å°åŒ–ï¼Œè¿™ä¸ä¹‹å‰å®éªŒå®¤çš„ç»“æœç›¸å»åˆã€‚</li>\n<li>å› ä¸ºåœ¨æˆæœ¬æ–¹ç¨‹ä¸­ï¼Œç›®æ ‡å’Œé¢„æµ‹ä¹‹é—´çš„å·®å¼‚æ˜¯å¹³æ–¹ï¼Œå½“ğ‘¤æ—¶ï¼Œæˆæœ¬è¿…é€Ÿå¢åŠ ä¸æ˜¯å¤ªå¤§å°±æ˜¯å¤ªå°ã€‚</li>\n<li>ä½¿ç”¨é€šè¿‡æœ€å°åŒ–æˆæœ¬é€‰æ‹©çš„wå’Œbï¼Œå¯ä»¥å¾—åˆ°ä¸æ•°æ®å®Œç¾åŒ¹é…çš„ç›´çº¿ã€‚</li>\n</ul>\n<h2 id=\"Cost-Function-Visualiztion-3D\"><a href=\"#Cost-Function-Visualiztion-3D\" class=\"headerlink\" title=\"Cost Function Visualiztion-3D\"></a>Cost Function Visualiztion-3D</h2><p>ä½ å¯ä»¥é€šè¿‡ä¸‰ç»´ç»˜å›¾æˆ–ç­‰é«˜çº¿å›¾çœ‹åˆ°æˆæœ¬æ˜¯å¦‚ä½•éšwå’Œbå˜åŒ–çš„ã€‚</p>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é—¨è¯¾çš„ä¸€äº›æƒ…èŠ‚ä¼šå˜å¾—ç›¸å½“å¤æ‚ã€‚æœ¬æ–‡æä¾›äº†ç»˜å›¾ä¾‹ç¨‹ï¼Œè™½ç„¶é€šè¯»ä»£ç ä»¥ç†Ÿæ‚‰è¿™äº›æ–¹æ³•æ˜¯æœ‰æŒ‡å¯¼æ„ä¹‰çš„ï¼Œä½†è¦æˆåŠŸå®Œæˆè¯¾ç¨‹å¹¶ä¸éœ€è¦è¿™æ ·åšã€‚ä¾‹ç¨‹åœ¨æœ¬åœ°ç›®å½•lab_utils_uni.pyä¸­ã€‚</p>\n<h2 id=\"Larger-Data-Set\"><a href=\"#Larger-Data-Set\" class=\"headerlink\" title=\"Larger Data Set\"></a>Larger Data Set</h2><p>è¾ƒå¤§çš„æ•°æ®é›†ç”¨æ›´å¤šçš„æ•°æ®ç‚¹æ¥è§‚å¯Ÿä¸€ä¸ªåœºæ™¯æ˜¯å¾ˆæœ‰æŒ‡å¯¼æ„ä¹‰çš„ã€‚è¯¥æ•°æ®é›†åŒ…æ‹¬ä¸åœ¨åŒä¸€çº¿ä¸Šçš„æ•°æ®ç‚¹ã€‚è¿™å¯¹æˆæœ¬æ–¹ç¨‹æ„å‘³ç€ä»€ä¹ˆ?æˆ‘ä»¬èƒ½æ‰¾åˆ°ğ‘¤ã€ğ‘é‚£æ ·ä½¿å¾—ä»£ä»·æ˜¯0?</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">x_train = np.array([<span class=\"hljs-number\">1.0</span>,<span class=\"hljs-number\">1.7</span>,<span class=\"hljs-number\">2.0</span>,<span class=\"hljs-number\">2.5</span>,<span class=\"hljs-number\">3.0</span>,<span class=\"hljs-number\">3.2</span>])<br>y_train = np.array([<span class=\"hljs-number\">250</span>,<span class=\"hljs-number\">300</span>,<span class=\"hljs-number\">480</span>,<span class=\"hljs-number\">430</span>,<span class=\"hljs-number\">630</span>,<span class=\"hljs-number\">730</span>])<br></code></pre></div></td></tr></table></figure>\n\n<p>åœ¨ç­‰é«˜çº¿å›¾ä¸­ï¼Œç‚¹å‡»ä¸€ä¸ªç‚¹ï¼Œé€‰æ‹©wå’Œbï¼Œä»¥è¾¾åˆ°æœ€ä½çš„æˆæœ¬ã€‚ä½¿ç”¨è½®å»“æ¥æŒ‡å¯¼ä½ çš„é€‰æ‹©ã€‚æ³¨æ„ï¼Œæ›´æ–°å›¾å½¢å¯èƒ½éœ€è¦å‡ ç§’é’Ÿçš„æ—¶é—´ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">plt.close(<span class=\"hljs-string\">&#x27;all&#x27;</span>)<br>fig, ax ,dyn_items = plt_stationary(x_train, y_train)<br>updater = plt_update_onclick(fig, ax, x_train,y_train,dyn_items)<br></code></pre></div></td></tr></table></figure>\n\n<p>ä¸Šé¢ï¼Œæ³¨æ„å·¦è¾¹å›¾ä¸­çš„è™šçº¿ã€‚è¿™äº›ä»£è¡¨äº†ä½ çš„è®­ç»ƒé›†ä¸­æ¯ä¸ªä¾‹å­æ‰€è´¡çŒ®çš„ä»£ä»·çš„éƒ¨åˆ†ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå€¼çº¦ä¸ºğ‘¤&#x3D;209å’Œğ‘&#x3D; 2.4æä¾›ä½ä»£ä»·ã€‚è¯·æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬çš„è®­ç»ƒç¤ºä¾‹ä¸åœ¨ä¸€æ¡çº¿ä¸Šï¼Œæ‰€ä»¥æœ€å°ä»£ä»·ä¸ä¸ºé›¶ã€‚</p>\n<h2 id=\"Convex-Cost-surface\"><a href=\"#Convex-Cost-surface\" class=\"headerlink\" title=\"Convex Cost surface\"></a>Convex Cost surface</h2><p>æˆæœ¬å‡½æ•°å¹³æ–¹æŸå¤±çš„äº‹å®ç¡®ä¿äº†â€œè¯¯å·®æ›²é¢â€åƒæ±¤ç¢—ä¸€æ ·å‡¸å‡ºã€‚å®ƒæ€»æ˜¯æœ‰ä¸€ä¸ªæœ€å°å€¼ï¼Œå¯ä»¥é€šè¿‡åœ¨æ‰€æœ‰ç»´åº¦ä¸Šè·Ÿéšæ¢¯åº¦æ¥è¾¾åˆ°ã€‚åœ¨å‰é¢çš„å›¾ä¸­ï¼Œå› ä¸ºğ‘¤å’Œğ‘å°ºå¯¸æ¯”ä¾‹ä¸åŒï¼Œè¿™æ˜¯ä¸å®¹æ˜“è¯†åˆ«çš„ã€‚ä¸‹å›¾ï¼Œå…¶ä¸­ğ‘¤å’Œğ‘éƒ½æ˜¯å¯¹ç§°çš„ï¼Œåœ¨è®²åº§ä¸­å±•ç¤ºè¿‡:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">soup_bowl()<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"Congratulations\"><a href=\"#Congratulations\" class=\"headerlink\" title=\"Congratulations!\"></a>Congratulations!</h2><p>æ‚¨å·²ç»å­¦ä¹ äº†ä»¥ä¸‹å†…å®¹:</p>\n<ul>\n<li>æˆæœ¬æ–¹ç¨‹æä¾›äº†ä¸€ç§è¡¡é‡é¢„æµ‹ä¸è®­ç»ƒæ•°æ®åŒ¹é…ç¨‹åº¦çš„æ–¹æ³•ã€‚</li>\n<li>æœ€å°åŒ–æˆæœ¬å¯ä»¥æä¾›ğ‘¤å’Œbçš„æœ€ä¼˜å€¼ã€‚</li>\n</ul>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p><a href=\"https://www.bilibili.com/video/BV1Pa411X76s?p=5&amp;vd_source=3ae32e36058f58c5b85935fca9b77797\">https://www.bilibili.com/video/BV1Pa411X76s?p=5&amp;vd_source=3ae32e36058f58c5b85935fca9b77797</a></p>\n<p><a href=\"https://github.com/kaieye/2022-Machine-Learning-Specialization\">kaieye&#x2F;2022-Machine-Learning-Specialization (github.com)</a></p>\n",
            "tags": [
                "Tensorflow",
                "Machine Learning"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/10/avx006/",
            "url": "https://xingyuanjie.top/2023/03/10/avx006/",
            "title": "å¦‚ä½•ä½¿ç”¨AVXå’ŒAVX2å¤„ç†æ•°æ®(ä¸ªäººç¿»è¯‘)",
            "date_published": "2023-03-10T06:51:44.000Z",
            "content_html": "<h2 id=\"1-æ–‡ç« æ¥æº\"><a href=\"#1-æ–‡ç« æ¥æº\" class=\"headerlink\" title=\"1.æ–‡ç« æ¥æº\"></a>1.æ–‡ç« æ¥æº</h2><p><strong>Matt Scarpinoï¼ˆUSAï¼‰</strong></p>\n<p><a href=\"https://www.codeproject.com/Articles/874396/Crunching-Numbers-with-AVX-and-AVX\">Crunching Numbers with AVX and AVX2 - CodeProject</a></p>\n<h2 id=\"2-ä»‹ç»\"><a href=\"#2-ä»‹ç»\" class=\"headerlink\" title=\"2.ä»‹ç»\"></a>2.ä»‹ç»</h2><p>åœ¨2003å¹´ï¼Œ<a href=\"https://www.codeproject.com/script/Membership/View.aspx?mid=22834\">Alex Fr</a>å†™äº†ä¸€ç¯‡ä¼˜ç§€çš„<a href=\"https://www.codeproject.com/Articles/4522/Introduction-to-SSE-Programming\">æ–‡ç« </a>[è¯¥æ–‡ç« ç°åœ¨å·²ç»è¢«åŸä½œè€…åˆ é™¤]ï¼Œè§£é‡Šäº†å¦‚ä½•ä½¿ç”¨Intelçš„æµå¼SIMDæ‰©å±•(SSE)æ‰§è¡ŒSIMD(å•æŒ‡ä»¤ï¼Œå¤šæ•°æ®)å¤„ç†ã€‚SSEæ˜¯è‹±ç‰¹å°”å¤„ç†å™¨æ”¯æŒçš„ä¸€ç»„æŒ‡ä»¤ï¼Œå¯å¯¹å¤§é‡æ•°æ®æ‰§è¡Œé«˜é€Ÿè¿ç®—ã€‚</p>\n<p>2008å¹´ï¼Œè‹±ç‰¹å°”æ¨å‡ºäº†ä¸€å¥—æ–°çš„é«˜æ€§èƒ½æŒ‡ä»¤ï¼Œç§°ä¸ºé«˜çº§å‘é‡æ‰©å±•(AVX)ã€‚AVXæ‰§è¡Œè®¸å¤šä¸SSEæŒ‡ä»¤ç›¸åŒçš„æ“ä½œï¼Œä½†ä»¥æ›´å¿«çš„é€Ÿåº¦å¯¹æ›´å¤§çš„æ•°æ®å—è¿›è¡Œæ“ä½œã€‚æœ€è¿‘ï¼Œè‹±ç‰¹å°”åœ¨AVX2å’ŒAVX512ç³»åˆ—ä¸­å‘å¸ƒäº†é¢å¤–çš„æŒ‡ä»¤ã€‚æœ¬æ–‡çš„é‡ç‚¹æ˜¯é€šè¿‡ç§°ä¸ºintrinsic funtionsçš„ç‰¹æ®ŠCå‡½æ•°è®¿é—®AVXå’ŒAVX2æŒ‡ä»¤ã€‚</p>\n<p>æœ¬æ–‡ä¸ä»‹ç»æ•´ä¸ªAVX&#x2F;AVX2 intrinsicsï¼Œè€Œæ˜¯ä¾§é‡äºæ•°å­¦è®¡ç®—ã€‚ç‰¹åˆ«åœ°ï¼Œç›®æ ‡æ˜¯å¤æ•°ç›¸ä¹˜ã€‚è¦ä½¿ç”¨AVX&#x2F;AVX2æ‰§è¡Œæ­¤æ“ä½œï¼Œéœ€è¦ä¸‰ç§ç±»å‹çš„intrinsic:</p>\n<ol>\n<li>Initialization intrinscis</li>\n<li>Arithmetic intrinsics</li>\n<li>Permute&#x2F;shuffle intrinsics</li>\n</ol>\n<p>\t\t</p>\n<p>æœ¬æ–‡è®¨è®ºæ¯ä¸ªç±»åˆ«ä¸­çš„intrinsicsï¼Œå¹¶è§£é‡Šå¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨å®ƒä»¬ã€‚æœ¬æ–‡çš„æœ€åå°†å±•ç¤ºå¦‚ä½•ç”¨è¿™äº›intrinsicè¿›è¡Œä¹˜æ³•å¤æ•°è¿ç®—ã€‚</p>\n<p>ç†è§£å¤„ç†å™¨æŒ‡ä»¤å’Œintrinsic functionä¹‹é—´çš„åŒºåˆ«æ˜¯å¾ˆé‡è¦çš„ã€‚AVXæŒ‡ä»¤æ˜¯æ‰§è¡Œä¸å¯åˆ†å‰²æ“ä½œçš„æ±‡ç¼–å‘½ä»¤ã€‚ä¾‹å¦‚ï¼ŒAVXæŒ‡ä»¤vaddpsæ·»åŠ äº†ä¸¤ä¸ªæ“ä½œæ•°ï¼Œå¹¶å°†ç»“æœæ”¾åœ¨ç¬¬ä¸‰ä¸ªæ“ä½œæ•°ä¸­ã€‚</p>\n<p>è¦åœ¨C&#x2F;C++ä¸­æ‰§è¡Œæ“ä½œï¼Œthe intrinsic funtion _mm256_add_ps()ç›´æ¥æ˜ å°„åˆ°vaddpsï¼Œå°†æ±‡ç¼–çš„æ€§èƒ½ä¸é«˜çº§å‡½æ•°çš„ä¾¿åˆ©æ€§ç»“åˆèµ·æ¥ã€‚An intrinsic funtionä¸ä¸€å®šæ˜ å°„åˆ°å•ä¸ªæŒ‡ä»¤ï¼Œä½†ä¸å…¶ä»–C&#x2F; C++å‡½æ•°ç›¸æ¯”ï¼ŒAVX&#x2F;AVX2 intrinsicsæä¾›äº†å¯é çš„é«˜æ€§èƒ½ã€‚</p>\n<h2 id=\"3-åŸºæœ¬è¦æ±‚\"><a href=\"#3-åŸºæœ¬è¦æ±‚\" class=\"headerlink\" title=\"3.åŸºæœ¬è¦æ±‚\"></a>3.åŸºæœ¬è¦æ±‚</h2><p>è¦ç†è§£æœ¬æ–‡çš„å†…å®¹ï¼Œæ‚¨éœ€è¦åŸºæœ¬ç†Ÿæ‚‰Cè¯­è¨€å’ŒSIMDå¤„ç†ã€‚è¦æ‰§è¡Œä»£ç ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªæ”¯æŒAVXæˆ–AVX&#x2F;AVX2çš„CPUã€‚ä»¥ä¸‹æ˜¯æ”¯æŒAVXçš„cpu:</p>\n<ul>\n<li>Intelâ€™s Sandy Bridge&#x2F;Sandy Bridge E&#x2F;Ivy Bridge&#x2F;Ivy Bridge E</li>\n<li>Intelâ€™s Haswell&#x2F;Haswell E&#x2F;Broadwell&#x2F;Broadwell E</li>\n<li>AMDâ€™s Bulldozer&#x2F;Piledriver&#x2F;Steamroller&#x2F;Excavator</li>\n</ul>\n<p>æ”¯æŒAVX2çš„CPUä¹Ÿæ”¯æŒAVXã€‚ä»¥ä¸‹æ˜¯è¿™äº›è®¾å¤‡:</p>\n<ul>\n<li>Intelâ€™s Haswell&#x2F;Haswell E&#x2F;Broadwell&#x2F;Broadwell E</li>\n<li>AMDâ€™s Excavator</li>\n</ul>\n<p>æœ¬æ–‡ä¸­è®¨è®ºçš„å¤§å¤šæ•°å‡½æ•°éƒ½æ˜¯ç”±AVXæä¾›çš„ã€‚ä½†ä¹Ÿæœ‰ä¸€äº›æ˜¯AVX2ç‰¹æœ‰çš„ã€‚ä¸ºäº†åŒºåˆ†å®ƒä»¬ï¼Œåœ¨æœ¬æ–‡çš„è¡¨ä¸­ï¼Œæˆ‘åœ¨AVX2 intrinsicçš„åç§°å‰é¢åŠ ä¸Š(2)ã€‚</p>\n<p>[ä¸ªäººè¡¥å……]</p>\n<p>åˆ¤æ–­è‡ªå·±ç”µè„‘CPUæ˜¯å¦æ”¯æŒAVXå’ŒAVX2ï¼Œæœ€ç®€å•çš„å°±æ˜¯åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">lscpu<br></code></pre></div></td></tr></table></figure>\n\n<p>ä½ ä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š</p>\n<p><img src=\"/2023/03/10/avx006/image-20230129153048825.png\" alt=\"image-20230129153048825\"></p>\n<p>åœ¨Flagsé‡Œé¢ä½ å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°ä½ çš„ç”µè„‘æ˜¯å¦æ”¯æŒAVXä»¥åŠAVX2ã€‚</p>\n<h2 id=\"4-å‘é‡åŒ–æ¦‚è¿°\"><a href=\"#4-å‘é‡åŒ–æ¦‚è¿°\" class=\"headerlink\" title=\"4.å‘é‡åŒ–æ¦‚è¿°\"></a>4.å‘é‡åŒ–æ¦‚è¿°</h2><p>AVXæŒ‡ä»¤é€šè¿‡åŒæ—¶å¤„ç†å¤§å—å€¼è€Œä¸æ˜¯å•ç‹¬å¤„ç†å€¼æ¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚è¿™äº›å€¼å¤§å—ç§°ä¸ºå‘é‡ï¼ŒAVXå‘é‡æœ€å¤šå¯ä»¥åŒ…å«256ä½æ•°æ®ã€‚</p>\n<p>å¸¸è§çš„AVXå‘é‡åŒ…å«4ä¸ªdouble (4 x 64ä½&#x3D; 256)ï¼Œ8ä¸ªfloat (8 x 32ä½&#x3D; 256)æˆ–8ä¸ªint (8 x 32ä½&#x3D; 256)ã€‚[double 8B, flout 4B, int 4B]</p>\n<p>ä¸€ä¸ªç¤ºä¾‹å°†æ¼”ç¤ºAVX&#x2F;AVX2å¤„ç†çš„å¼ºå¤§åŠŸèƒ½ã€‚å‡è®¾ä¸€ä¸ªå‡½æ•°éœ€è¦å°†ä¸€ä¸ªæ•°ç»„çš„8ä¸ªæµ®ç‚¹æ•°ä¹˜ä»¥ç¬¬äºŒä¸ªæ•°ç»„çš„8ä¸ªæµ®ç‚¹æ•°ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°ç¬¬ä¸‰ä¸ªæ•°ç»„ã€‚å¦‚æœæ²¡æœ‰å‘é‡åŒ–ï¼Œå‡½æ•°å¯èƒ½æ˜¯è¿™æ ·çš„:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-built_in\">multiply_and_add</span>(<span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">float</span>* a, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">float</span>* b, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">float</span>* c, <span class=\"hljs-keyword\">float</span>* d) &#123;  <br><br>  <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i=<span class=\"hljs-number\">0</span>; i&lt;<span class=\"hljs-number\">8</span>; i++) &#123;<br>    d[i] = a[i] * b[i];<br>    d[i] = d[i] + c[i];<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>ä¸‹é¢æ˜¯ä½¿ç”¨AVX2å‡½æ•°çš„ä¾‹å­:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\">__m256 <span class=\"hljs-title\">multiply_and_add</span><span class=\"hljs-params\">(__m256 a, __m256 b, __m256 c)</span> </span>&#123;<br><br>  <span class=\"hljs-keyword\">return</span> _mm256_fmadd_ps(a, b, c);<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>This AVX2 intrinsic funtion <strong>_mm256_fmadd_ps</strong>å¤„ç†24ä¸ªfloatsï¼Œä½†å®ƒä¸æ˜ å°„åˆ°å•ä¸ªæŒ‡ä»¤ã€‚ç›¸åï¼Œå®ƒæ‰§è¡Œä¸‰ä¸ªæŒ‡ä»¤:<strong>vfmadd132ps</strong>ã€<strong>vfmadd213ps</strong>å’Œ<strong>vfmadd231ps</strong>ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒæ‰§è¡Œå¾—å¾ˆå¿«ï¼Œæ¯”éå†å•ä¸ªå…ƒç´ å¿«å¾—å¤šã€‚</p>\n<p>å°½ç®¡è‹±ç‰¹å°”çš„intrinsicsåŠŸèƒ½å¼ºå¤§ï¼Œä½†å®ƒä»¬è¿˜æ˜¯è®©è®¸å¤šç¨‹åºå‘˜æ„Ÿåˆ°ç´§å¼ ã€‚è¿™é€šå¸¸æœ‰ä¸¤ä¸ªåŸå› ã€‚é¦–å…ˆï¼Œæ•°æ®ç±»å‹æœ‰å¥‡æ€ªçš„åå­—ï¼Œæ¯”å¦‚**__m256<strong>ã€‚å…¶æ¬¡ï¼Œå‡½æ•°æœ‰å¥‡æ€ªçš„åç§°ï¼Œå¦‚</strong>_mm256_fmadd_ps**ã€‚å› æ­¤ï¼Œåœ¨è¯¦ç»†è®¨è®ºintrinsic funtionsä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆè®¨è®ºä¸€ä¸‹Intelçš„æ•°æ®ç±»å‹å’Œå‘½åçº¦å®šã€‚</p>\n<h2 id=\"5-AVXç¼–ç¨‹åŸºç¡€\"><a href=\"#5-AVXç¼–ç¨‹åŸºç¡€\" class=\"headerlink\" title=\"5.AVXç¼–ç¨‹åŸºç¡€\"></a>5.AVXç¼–ç¨‹åŸºç¡€</h2><p>æœ¬æ–‡ä¸»è¦å…³æ³¨AVXå’ŒAVX2æä¾›çš„ä¸æ•°å­¦ç›¸å…³çš„intrinsic functionsã€‚ä½†åœ¨çœ‹å‡½æ•°ä¹‹å‰ï¼Œæœ‰ä¸‰ç‚¹å¾ˆé‡è¦:</p>\n<ul>\n<li>Data types</li>\n<li>Function naming conventions</li>\n<li>Compiling AVX applications</li>\n</ul>\n<p>æœ¬èŠ‚æ¶‰åŠè¿™äº›è¦ç‚¹ï¼Œå¹¶æä¾›ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼Œç”¨äºä¸€ä¸ªå‘é‡å‡å»å¦ä¸€ä¸ªå‘é‡ã€‚</p>\n<h3 id=\"5-1æ•°æ®ç±»å‹\"><a href=\"#5-1æ•°æ®ç±»å‹\" class=\"headerlink\" title=\"5.1æ•°æ®ç±»å‹\"></a>5.1æ•°æ®ç±»å‹</h3><p>å°‘æ•°intrinsicæ¥å—ä¼ ç»Ÿçš„æ•°æ®ç±»å‹ï¼Œå¦‚<strong>int</strong>æˆ–<strong>float</strong>ï¼Œä½†å¤§å¤šæ•°intrinsicæ“ä½œæœ‰ç‰¹å®šçš„AVXå’ŒAVX2çš„æ•°æ®ç±»å‹ã€‚æœ‰å…­ç§ä¸»è¦çš„å‘é‡ç±»å‹ï¼Œè¡¨1åˆ—å‡ºäº†å®ƒä»¬ã€‚</p>\n<p><strong>Table 1:AVX&#x2F;AVX2 Data Types</strong></p>\n<table>\n<thead>\n<tr>\n<th>Data Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>__m128</code></td>\n<td>128-bit vector containing 4 <code>float</code>s</td>\n</tr>\n<tr>\n<td><code>__m128d</code></td>\n<td>128-bit vector containing 2 <code>double</code>s</td>\n</tr>\n<tr>\n<td><code>__m128i</code></td>\n<td>128-bit vector containing integers</td>\n</tr>\n<tr>\n<td><code>__m256</code></td>\n<td>256-bit vector containing 8 <code>float</code>s</td>\n</tr>\n<tr>\n<td><code>__m256d</code></td>\n<td>256-bit vector containing 4 <code>double</code>s</td>\n</tr>\n<tr>\n<td><code>__m256i</code></td>\n<td>256-bit vector containing integers</td>\n</tr>\n</tbody></table>\n<p>æ¯ç§ç±»å‹éƒ½ä»¥ä¸¤ä¸ªä¸‹åˆ’çº¿ã€ä¸€ä¸ªmå’Œå‘é‡çš„å®½åº¦(ä»¥ä½ä¸ºå•ä½)å¼€å§‹ã€‚AVX512æ”¯æŒä»¥_m512å¼€å¤´çš„512ä½å‘é‡ç±»å‹ï¼Œä½†AVX&#x2F;AVX2å‘é‡ä¸è¶…è¿‡256ä½ã€‚å¦‚æœå‘é‡ç±»å‹ä»¥dç»“å°¾ï¼Œåˆ™ä»£è¡¨doubleï¼Œå¦‚æœæ²¡æœ‰åç¼€ï¼Œåˆ™ä»£è¡¨floatã€‚çœ‹èµ·æ¥_m128iå’Œ_m256iå‘é‡å¿…é¡»åŒ…å«intå‹ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚æ•´æ•°å‘é‡ç±»å‹å¯ä»¥åŒ…å«ä»»ä½•ç±»å‹çš„æ•´æ•°ï¼Œfrom chars to shorts to unsigned long longs.That is, an _m256i may contain 32 chars, 16 shorts, 8 ints, or 4 longs.  These integers can be signed or unsigned.</p>\n<h3 id=\"5-3å‡½æ•°å‘½åçº¦å®š\"><a href=\"#5-3å‡½æ•°å‘½åçº¦å®š\" class=\"headerlink\" title=\"5.3å‡½æ•°å‘½åçº¦å®š\"></a>5.3å‡½æ•°å‘½åçº¦å®š</h3><p>AVX&#x2F;AVX2 intrinsicsçš„åç§°ä¸€å¼€å§‹å¯èƒ½ä»¤äººå›°æƒ‘ï¼Œä½†å‘½åçº¦å®šç¡®æ˜¯éå¸¸ç›´ç™½çš„ã€‚ä¸€æ—¦ä½ ç†è§£äº†å®ƒï¼Œä½ å°±å¯ä»¥é€šè¿‡çœ‹å®ƒçš„åå­—æ¥å¤§è‡´åˆ¤æ–­ä¸€ä¸ªå‡½æ•°æ˜¯åšä»€ä¹ˆçš„ã€‚AVX&#x2F;AVX2 intrinsicsçš„ä¸€èˆ¬å½¢å¼å¦‚ä¸‹:</p>\n<p>_mm<bit_width>_<name>_<data_type></data_type></name></bit_width></p>\n<p>è¯¥æ ¼å¼çš„å„éƒ¨åˆ†å¦‚ä¸‹æ‰€ç¤º:</p>\n<ol>\n<li><code>&lt;bit_width&gt;</code> identifies the size of the vector returned by the function. For 128-bit vectors, this is empty. For 256-bit vectors, this is set to <code>256</code>.</li>\n<li><code>&lt;name&gt;</code> describes the operation performed by the intrinsic</li>\n<li><code>&lt;data_type&gt;</code> identifies the data type of the functionâ€™s primary arguments</li>\n</ol>\n<p>æœ€åä¸€éƒ¨åˆ†<data_type>æœ‰ç‚¹å¤æ‚ã€‚å®ƒæ ‡è¯†è¾“å…¥å€¼çš„å†…å®¹ï¼Œå¯ä»¥è®¾ç½®ä¸ºä»¥ä¸‹ä»»ä½•å€¼:</data_type></p>\n<ul>\n<li><code>ps</code> - vectors contain <code>float</code>s (<code>ps</code> stands for packed single-precision)</li>\n<li><code>pd</code> - vectors contain <code>double</code>s (<code>pd</code> stands for packed double-precision)</li>\n<li><code>epi8/epi16/epi32/epi64</code> - vectors contain 8-bit&#x2F;16-bit&#x2F;32-bit&#x2F;64-bit signed integers</li>\n<li><code>epu8/epu16/epu32/epu64</code> - vectors contain 8-bit&#x2F;16-bit&#x2F;32-bit&#x2F;64-bit unsigned integers</li>\n<li><code>si128</code>&#x2F;<code>si256</code> - unspecified 128-bit vector or 256-bit vector</li>\n<li><code>m128/m128i/m128d/m256/m256i/m256d</code> - identifies input vector types when theyâ€™re different than the type of the returned vector</li>\n</ul>\n<p>ä¾‹å¦‚ï¼Œè€ƒè™‘_mm256_srlv_epi64ã€‚å³ä½¿æ‚¨ä¸çŸ¥é“srlvæ˜¯ä»€ä¹ˆæ„æ€ï¼Œ_mm256å‰ç¼€å‘Šè¯‰æ‚¨è¯¥å‡½æ•°è¿”å›ä¸€ä¸ª256ä½å‘é‡ï¼Œ_epi64å‘Šè¯‰æ‚¨å‚æ•°åŒ…å«64ä½æœ‰ç¬¦å·æ•´æ•°ã€‚</p>\n<p>ä½œä¸ºç¬¬äºŒä¸ªç¤ºä¾‹ï¼Œè€ƒè™‘_mm_testnzc_psã€‚_mmè¡¨ç¤ºå‡½æ•°è¿”å›ä¸€ä¸ª128ä½çš„å‘é‡ã€‚æœ«å°¾çš„_psè¡¨ç¤ºå‚æ•°å‘é‡åŒ…å«æµ®ç‚¹æ•°ã€‚</p>\n<p>AVXæ•°æ®ç±»å‹ä»¥ä¸¤ä¸ªä¸‹åˆ’çº¿å’Œä¸€ä¸ªmå¼€å¤´ã€‚å‡½æ•°ä»¥ä¸€ä¸ªä¸‹åˆ’çº¿å’Œä¸¤ä¸ªmå¼€å¤´ã€‚æˆ‘å¾ˆå®¹æ˜“ææ··è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥æˆ‘æƒ³å‡ºäº†ä¸€ç§æ–¹æ³•æ¥è®°ä½å®ƒä»¬çš„åŒºåˆ«:æ•°æ®ç±»å‹ä»£è¡¨å†…å­˜ï¼ˆ<strong>m</strong>emoryï¼‰ï¼Œå‡½æ•°ä»£è¡¨å¤šåª’ä½“æ“ä½œï¼ˆ<strong>m</strong>ulti<strong>m</strong>ediaï¼‰ã€‚è¿™æ˜¯æˆ‘èƒ½åšçš„æœ€å¥½çš„äº†ã€‚</p>\n<h3 id=\"5-4æ„å»ºAVXåº”ç”¨ç¨‹åº\"><a href=\"#5-4æ„å»ºAVXåº”ç”¨ç¨‹åº\" class=\"headerlink\" title=\"5.4æ„å»ºAVXåº”ç”¨ç¨‹åº\"></a>5.4æ„å»ºAVXåº”ç”¨ç¨‹åº</h3><p>è¦æ„å»ºä½¿ç”¨AVX intrinsicçš„åº”ç”¨ç¨‹åºï¼Œä¸éœ€è¦é“¾æ¥ä»»ä½•åº“ã€‚ä½†æ˜¯æ‚¨éœ€è¦åŒ…å«<strong>imminrin .h</strong>å¤´æ–‡ä»¶ã€‚æ­¤å¤´æ–‡ä»¶åŒ…æ‹¬å°†AVX&#x2F;AVX2å‡½æ•°æ˜ å°„åˆ°æŒ‡ä»¤çš„å…¶ä»–å¤´æ–‡ä»¶ã€‚</p>\n<p>hello_avx.cä¸­çš„ä»£ç æ˜¾ç¤ºäº†ä¸€ä¸ªåŸºæœ¬çš„AVXåº”ç”¨ç¨‹åºçš„æ ·å­:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;immintrin.h&gt;</span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;stdio.h&gt;</span></span><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span> </span>&#123;<br><br>  <span class=\"hljs-comment\">/* Initialize the two argument vectors */</span>\t\t\t<span class=\"hljs-comment\">//åˆå§‹åŒ–</span><br>  __m256 evens = _mm256_set_ps(<span class=\"hljs-number\">2.0</span>, <span class=\"hljs-number\">4.0</span>, <span class=\"hljs-number\">6.0</span>, <span class=\"hljs-number\">8.0</span>, <span class=\"hljs-number\">10.0</span>, <span class=\"hljs-number\">12.0</span>, <span class=\"hljs-number\">14.0</span>, <span class=\"hljs-number\">16.0</span>);<br>  __m256 odds = _mm256_set_ps(<span class=\"hljs-number\">1.0</span>, <span class=\"hljs-number\">3.0</span>, <span class=\"hljs-number\">5.0</span>, <span class=\"hljs-number\">7.0</span>, <span class=\"hljs-number\">9.0</span>, <span class=\"hljs-number\">11.0</span>, <span class=\"hljs-number\">13.0</span>, <span class=\"hljs-number\">15.0</span>);<br><br>  <span class=\"hljs-comment\">/* Compute the difference between the two vectors */</span><br>  __m256 result = _mm256_sub_ps(evens, odds);\t\t\t<span class=\"hljs-comment\">//å‡æ³•</span><br><br>  <span class=\"hljs-comment\">/* Display the elements of the result vector */</span><br>  <span class=\"hljs-keyword\">float</span>* f = (<span class=\"hljs-keyword\">float</span>*)&amp;result;\t\t\t\t\t<span class=\"hljs-comment\">//ç±»å‹è½¬æ¢</span><br>  <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;%f %f %f %f %f %f %f %f\\n&quot;</span>,<br>    f[<span class=\"hljs-number\">0</span>], f[<span class=\"hljs-number\">1</span>], f[<span class=\"hljs-number\">2</span>], f[<span class=\"hljs-number\">3</span>], f[<span class=\"hljs-number\">4</span>], f[<span class=\"hljs-number\">5</span>], f[<span class=\"hljs-number\">6</span>], f[<span class=\"hljs-number\">7</span>]);<br><br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>è¦æ„å»ºåº”ç”¨ç¨‹åºï¼Œéœ€è¦å‘Šè¯‰ç¼–è¯‘å™¨è¯¥ä½“ç³»ç»“æ„æ”¯æŒAVXã€‚è¿™ä¸ªæ ‡å¿—å–å†³äºç¼–è¯‘å™¨ï¼Œgccéœ€è¦-mavxæ ‡å¿—ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘hello_avx.cæºæ–‡ä»¶:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">gcc -mavx -o hello_avx hello_avx.c<br></code></pre></div></td></tr></table></figure>\n\n<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæ‰€æœ‰å‡½æ•°éƒ½ä»¥_mm256å¼€å§‹ï¼Œä»¥_psç»“æŸï¼Œå› æ­¤æˆ‘å¸Œæœ›æ‰€æœ‰æ“ä½œéƒ½æ¸…æ¥šåœ°æ¶‰åŠåŒ…å«floatsçš„256ä½å‘é‡ã€‚æˆ‘è¿˜å¸Œæœ›ç»“æœå‘é‡ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ç­‰äº1.0ã€‚å¦‚æœè¿è¡Œåº”ç”¨ç¨‹åºï¼Œæ‚¨å°†çœ‹åˆ°æƒ…å†µå°±æ˜¯è¿™æ ·ã€‚</p>\n<p>[è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„å‘é‡å‡æ³•ä¾‹å­ï¼Œå¤§å®¶å¯ä»¥å¯¹åº”æ•°æ®çœ‹ä¸€ä¸‹]</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000<br></code></pre></div></td></tr></table></figure>\n\n<h3 id=\"5-5åˆå§‹åŒ–intrinsics\"><a href=\"#5-5åˆå§‹åŒ–intrinsics\" class=\"headerlink\" title=\"5.5åˆå§‹åŒ–intrinsics\"></a>5.5åˆå§‹åŒ–intrinsics</h3><p>åœ¨å¯¹AVXå‘é‡è¿›è¡Œæ“ä½œä¹‹å‰ï¼Œéœ€è¦ç”¨æ•°æ®å¡«å……å‘é‡ã€‚å› æ­¤ï¼Œæœ¬æ–‡è®¨è®ºçš„ç¬¬ä¸€ç»„intrinsicsç”¨æ•°æ®åˆå§‹åŒ–å‘é‡ã€‚æœ‰ä¸¤ç§æ–¹æ³•:ç”¨æ ‡é‡å€¼åˆå§‹åŒ–å‘é‡å’Œç”¨ä»å†…å­˜åŠ è½½çš„æ•°æ®åˆå§‹åŒ–å‘é‡ã€‚</p>\n<h4 id=\"5-5-1ä½¿ç”¨æ ‡é‡å€¼åˆå§‹åŒ–\"><a href=\"#5-5-1ä½¿ç”¨æ ‡é‡å€¼åˆå§‹åŒ–\" class=\"headerlink\" title=\"5.5.1ä½¿ç”¨æ ‡é‡å€¼åˆå§‹åŒ–\"></a>5.5.1ä½¿ç”¨æ ‡é‡å€¼åˆå§‹åŒ–</h4><p>AVXæä¾›äº†å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ç»„åˆæˆ256ä½å‘é‡çš„intrinsics funtionsã€‚è¡¨2åˆ—å‡ºäº†å®ƒä»¬çš„åç§°ï¼Œå¹¶æä¾›äº†æ¯ä¸ªåç§°çš„æè¿°ã€‚ä¹Ÿæœ‰ç±»ä¼¼çš„intrinsicsåˆå§‹åŒ–128ä½å‘é‡ï¼Œä½†å®ƒä»¬æ˜¯ç”±SSEæä¾›çš„ï¼Œè€Œä¸æ˜¯AVXã€‚å‡½æ•°åçš„å”¯ä¸€åŒºåˆ«æ˜¯_mm256_è¢«æ›¿æ¢ä¸º_mm_ã€‚</p>\n<p><strong>Table 2: Initialization Intrinsics</strong></p>\n<table>\n<thead>\n<tr>\n<th>Function</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>_mm256_setzero_ps/pd</code></td>\n<td>Returns a floating-point vector filled with zeros</td>\n</tr>\n<tr>\n<td><code>_mm256_setzero_si256</code></td>\n<td>Returns an integer vector whose bytes are set to zero</td>\n</tr>\n<tr>\n<td><code>_mm256_set1_ps/pd</code></td>\n<td>Fill a vector with a floating-point value</td>\n</tr>\n<tr>\n<td><code>_mm256_set1_epi8/epi16</code> <code>_mm256_set1_epi32/epi64</code></td>\n<td>Fill a vector with an integer</td>\n</tr>\n<tr>\n<td><code>_mm256_set_ps/pd</code></td>\n<td>Initialize a vector with eight floats (ps) or four doubles (pd)</td>\n</tr>\n<tr>\n<td><code>_mm256_set_epi8/epi16</code> <code>_mm256_set_epi32/epi64</code></td>\n<td>Initialize a vector with integers</td>\n</tr>\n<tr>\n<td><code>_mm256_set_m128/m128d/</code> <code>_mm256_set_m128i</code></td>\n<td>Initialize a 256-bit vector with two 128-bit vectors</td>\n</tr>\n<tr>\n<td><code>_mm256_setr_ps/pd</code></td>\n<td>Initialize a vector with eight floats (ps) or four doubles (pd) in reverse order</td>\n</tr>\n<tr>\n<td><code>_mm256_setr_epi8/epi16</code> <code>_mm256_setr_epi32/epi64</code></td>\n<td>Initialize a vector with integers in reverse order</td>\n</tr>\n</tbody></table>\n<p>è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯æœ€å®¹æ˜“ç†è§£çš„ã€‚_m256_setzero_psè¿”å›ä¸€ä¸ª__m256å‘é‡ï¼ŒåŒ…å«8ä¸ªè®¾ç½®ä¸º0çš„æµ®ç‚¹æ•°ã€‚ç±»ä¼¼åœ°ï¼Œ_m256_setzero_si256è¿”å›ä¸€ä¸ª__m256iå‘é‡ï¼Œå…¶å­—èŠ‚è¢«è®¾ç½®ä¸º0ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢è¿™è¡Œä»£ç åˆ›å»ºäº†ä¸€ä¸ª256ä½çš„å‘é‡ï¼Œå…¶ä¸­åŒ…å«4ä¸ªè®¾ä¸º0çš„double:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">_m256d dbl_vector = _m256_setzero_pd();<br></code></pre></div></td></tr></table></figure>\n\n<p>åç§°ä¸­åŒ…å«set1çš„å‡½æ•°æ¥å—ä¸€ä¸ªå€¼ï¼Œå¹¶åœ¨æ•´ä¸ªå‘é‡ä¸­é‡å¤è¯¥å€¼ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢è¿™è¡Œä»£ç åˆ›å»ºäº†ä¸€ä¸ª__m256iï¼Œå®ƒçš„16ä¸ªshort valueè¢«è®¾ç½®ä¸º47:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">_m256i short_vector = _m256_set1_pd();<br></code></pre></div></td></tr></table></figure>\n\n<p>è¡¨2ä¸­çš„å…¶ä»–å‡½æ•°åŒ…å«_set_æˆ–_setr_ã€‚è¿™äº›å‡½æ•°æ¥å—ä¸€ç³»åˆ—å€¼ï¼Œæ¯ä¸ªå‘é‡çš„å…ƒç´ å¯¹åº”ä¸€ä¸ªå€¼ã€‚è¿™äº›å€¼è¢«æ”¾ç½®åœ¨è¿”å›çš„å‘é‡ä¸­ï¼Œç†è§£é¡ºåºå¾ˆé‡è¦ã€‚ä¸‹é¢çš„å‡½æ•°è°ƒç”¨è¿”å›ä¸€ä¸ªåŒ…å«8ä¸ªæ•´æ•°çš„å‘é‡ï¼Œå…¶å€¼èŒƒå›´ä¸º1åˆ°8:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">_m256i int_vector = _m256_set_epi32(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">8</span>);<br></code></pre></div></td></tr></table></figure>\n\n<p>æ‚¨å¯èƒ½å¸Œæœ›å€¼æŒ‰ç…§ç»™å®šçš„é¡ºåºå­˜å‚¨ã€‚ä½†è‹±ç‰¹å°”çš„æ¶æ„æ˜¯<strong>å°ç«¯</strong>å­˜å‚¨ç±»å‹çš„[è¿™é‡Œå¾ˆé‡è¦]ï¼Œæ‰€ä»¥æœ€ä½æœ‰æ•ˆå€¼(8)å…ˆå­˜å‚¨ï¼Œæœ€é«˜æœ‰æ•ˆå€¼(1)æœ€åå­˜å‚¨ã€‚æ‚¨å¯ä»¥é€šè¿‡å°†int_vectorè½¬æ¢ä¸ºintæŒ‡é’ˆå¹¶æ‰“å°å­˜å‚¨çš„å€¼æ¥éªŒè¯è¿™ä¸€ç‚¹ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤º:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">__m256i int_vector = _mm256_set_epi32(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">8</span>);<br><span class=\"hljs-keyword\">int</span> *ptr = (<span class=\"hljs-keyword\">int</span>*)&amp;int_vector;<br><span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;%d %d %d %d %d %d %d %d\\n&quot;</span>, ptr[<span class=\"hljs-number\">0</span>], ptr[<span class=\"hljs-number\">1</span>], ptr[<span class=\"hljs-number\">2</span>], ptr[<span class=\"hljs-number\">3</span>], ptr[<span class=\"hljs-number\">4</span>], ptr[<span class=\"hljs-number\">5</span>], ptr[<span class=\"hljs-number\">6</span>], ptr[<span class=\"hljs-number\">7</span>]);<br>--&gt; <span class=\"hljs-number\">8</span> <span class=\"hljs-number\">7</span> <span class=\"hljs-number\">6</span> <span class=\"hljs-number\">5</span> <span class=\"hljs-number\">4</span> <span class=\"hljs-number\">3</span> <span class=\"hljs-number\">2</span> <span class=\"hljs-number\">1</span><br></code></pre></div></td></tr></table></figure>\n\n<p>å¦‚æœå¸Œæœ›å€¼æŒ‰ç»™å®šé¡ºåºå­˜å‚¨ï¼Œå¯ä»¥ä½¿ç”¨_setr_å‡½æ•°ä¹‹ä¸€åˆ›å»ºå‘é‡ï¼Œå…¶ä¸­rå¯èƒ½ä»£è¡¨reverseã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">__m256i int_vector = _mm256_setr_epi32(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">8</span>);<br><span class=\"hljs-keyword\">int</span> *ptr = (<span class=\"hljs-keyword\">int</span>*)&amp;int_vector;<br><span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;%d %d %d %d %d %d %d %d\\n&quot;</span>, ptr[<span class=\"hljs-number\">0</span>], ptr[<span class=\"hljs-number\">1</span>], ptr[<span class=\"hljs-number\">2</span>], ptr[<span class=\"hljs-number\">3</span>], ptr[<span class=\"hljs-number\">4</span>], ptr[<span class=\"hljs-number\">5</span>], ptr[<span class=\"hljs-number\">6</span>], ptr[<span class=\"hljs-number\">7</span>]);<br>--&gt; <span class=\"hljs-number\">1</span> <span class=\"hljs-number\">2</span> <span class=\"hljs-number\">3</span> <span class=\"hljs-number\">4</span> <span class=\"hljs-number\">5</span> <span class=\"hljs-number\">6</span> <span class=\"hljs-number\">7</span> <span class=\"hljs-number\">8</span><br></code></pre></div></td></tr></table></figure>\n\n<p>æœ‰è¶£çš„æ˜¯ï¼ŒAVXå’ŒAVX2éƒ½æ²¡æœ‰æä¾›ç”¨æ— ç¬¦å·æ•´æ•°åˆå§‹åŒ–å‘é‡çš„intrinsicã€‚ä½†æ˜¯ï¼Œå®ƒä»¬æä¾›äº†å¯¹å¸¦æ— ç¬¦å·æ•´æ•°çš„å‘é‡è¿›è¡Œæ“ä½œçš„å‡½æ•°ã€‚</p>\n<h4 id=\"5-5-2ä»å†…å­˜åŠ è½½æ•°æ®\"><a href=\"#5-5-2ä»å†…å­˜åŠ è½½æ•°æ®\" class=\"headerlink\" title=\"5.5.2ä»å†…å­˜åŠ è½½æ•°æ®\"></a>5.5.2ä»å†…å­˜åŠ è½½æ•°æ®</h4><p>AVX&#x2F;AVX2çš„ä¸€ä¸ªå¸¸è§ç”¨æ³•æ˜¯å°†æ•°æ®ä»å†…å­˜åŠ è½½åˆ°å‘é‡ä¸­ï¼Œå¯¹å‘é‡è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†ç»“æœå­˜å‚¨å›å†…å­˜ã€‚ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨è¡¨3ä¸­åˆ—å‡ºçš„intrinsic funtionså®Œæˆçš„ã€‚æœ€åä¸¤ä¸ªå‡½æ•°å‰é¢æœ‰(2)ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç”±AVX2è€Œä¸æ˜¯AVXæä¾›çš„ã€‚</p>\n<p><strong>Table 3: Vector Load Intrinsics</strong></p>\n<table>\n<thead>\n<tr>\n<th>Data Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>_mm256_load_ps/pd</code></td>\n<td>Loads a floating-point vector from an  aligned memory address</td>\n</tr>\n<tr>\n<td><code>_mm256_load_si256</code></td>\n<td>Loads an integer vector from an aligned memory address</td>\n</tr>\n<tr>\n<td><code>_mm256_loadu_ps/pd</code></td>\n<td>Loads a floating-point vector from an  unaligned memory address</td>\n</tr>\n<tr>\n<td><code>_mm256_loadu_si256</code></td>\n<td>Loads an integer vector from an unaligned memory address</td>\n</tr>\n<tr>\n<td><code>_mm_maskload_ps/pd</code> <code>_mm256_maskload_ps/pd</code></td>\n<td>Load portions of a 128-bit&#x2F;256-bit floating-point vector according to a mask</td>\n</tr>\n<tr>\n<td><code>(2)_mm_maskload_epi32/64</code> <code>(2)_mm256_maskload_epi32/64</code></td>\n<td>Load portions of a 128-bit&#x2F;256-bit integer vector according to a mask</td>\n</tr>\n</tbody></table>\n<p>å½“å°†æ•°æ®åŠ è½½åˆ°å‘é‡ä¸­æ—¶ï¼Œå†…å­˜å¯¹é½å˜å¾—ç‰¹åˆ«é‡è¦ã€‚æ¯ä¸ª<strong>_mm256_load_</strong>* intrinsicæ¥å—ä¸€ä¸ªå¿…é¡»åœ¨32å­—èŠ‚è¾¹ç•Œä¸Šå¯¹é½çš„å†…å­˜åœ°å€ã€‚å³åœ°å€å¿…é¡»èƒ½è¢«32æ•´é™¤ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•åœ¨å®è·µä¸­ä½¿ç”¨å®ƒ:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-keyword\">float</span>* aligned_floats = (<span class=\"hljs-keyword\">float</span>*)<span class=\"hljs-built_in\">aligned_alloc</span>(<span class=\"hljs-number\">32</span>, <span class=\"hljs-number\">64</span> * <span class=\"hljs-built_in\"><span class=\"hljs-keyword\">sizeof</span></span>(<span class=\"hljs-keyword\">float</span>));\t\t<span class=\"hljs-comment\">//è¿™é‡Œä½¿ç”¨äº†å†…å­˜å¯¹é½</span><br>... Initialize data ...<br>__m256 vec = _mm256_load_ps(aligned_floats);<br></code></pre></div></td></tr></table></figure>\n\n<p>ã€ä¸ªäººè¡¥å……ã€‘å…³äºå†…å­˜å¯¹é½ä»¥åŠç›¸å…³å‡½æ•°</p>\n<p><a href=\"https://xingyuanjie.top/2022/06/12/%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/\">å†…å­˜å¯¹é½ - Amicoyuan (xingyuanjie.top)</a></p>\n<p><a href=\"https://xingyuanjie.top/2022/06/12/AVX%E5%90%91%E9%87%8F%E5%8C%96%E5%AD%A6%E4%B9%A0(%E4%BA%8C)-%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90%E7%9A%84%E5%BA%94%E7%94%A8/\">AVXå‘é‡åŒ–å­¦ä¹ (äºŒ)-å†…å­˜å¯¹é½çš„åº”ç”¨ - Amicoyuan (xingyuanjie.top)</a></p>\n<p>ä»»ä½•ä½¿ç”¨_m256_load_*åŠ è½½æœªå¯¹é½æ•°æ®çš„å°è¯•éƒ½ä¼šé€ æˆ<strong>segmentation fault</strong>ã€‚å¦‚æœæ•°æ®ä¸æ˜¯ä»¥32ä½è¾¹ç•Œå¯¹é½ï¼Œåˆ™åº”è¯¥ä½¿ç”¨_m256_loadu_*å‡½æ•°ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤º:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-keyword\">float</span>* unaligned_floats = (<span class=\"hljs-keyword\">float</span>*)<span class=\"hljs-built_in\">malloc</span>(<span class=\"hljs-number\">64</span> * <span class=\"hljs-built_in\"><span class=\"hljs-keyword\">sizeof</span></span>(<span class=\"hljs-keyword\">float</span>));\t\t\t\t<span class=\"hljs-comment\">//æœªä½¿ç”¨å†…å­˜å¯¹é½</span><br>... Initialize data ...<br>__m256 vec = _mm256_loadu_ps(unaligned_floats);<br></code></pre></div></td></tr></table></figure>\n\n<p>å‡è®¾ä½ æƒ³ç”¨AVXå‘é‡å¤„ç†ä¸€ä¸ªæµ®ç‚¹æ•°ç»„(float)ï¼Œä½†æ˜¯æ•°ç»„çš„é•¿åº¦æ˜¯11ï¼Œä¸èƒ½è¢«8æ•´é™¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ª__m256å‘é‡çš„æœ€åäº”ä¸ªæµ®ç‚¹æ•°éœ€è¦è®¾ç½®ä¸º0[æˆ–è€…ä½¿ç”¨éå‘é‡è®¡ç®—æ‰‹æ®µ]ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šå½±å“è®¡ç®—ã€‚è¿™ç§é€‰æ‹©æ€§åŠ è½½å¯ä»¥ç”¨è¡¨3åº•éƒ¨çš„**_maskload_**å‡½æ•°æ¥å®Œæˆã€‚</p>\n<p>æ¯ä¸ª_maskload_å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°:ä¸€ä¸ªå†…å­˜åœ°å€å’Œä¸€ä¸ªä¸è¿”å›å‘é‡å…ƒç´ æ•°é‡ç›¸åŒçš„æ•´æ•°å‘é‡ã€‚å¯¹äºæ•´æ•°å‘é‡ä¸­æœ€é«˜ä½ä¸º1çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†ä»å†…å­˜ä¸­è¯»å–è¿”å›å‘é‡ä¸­ç›¸åº”çš„å…ƒç´ ã€‚å¦‚æœæ•´æ•°å‘é‡ä¸­çš„æœ€é«˜ä½ä¸ºé›¶ï¼Œåˆ™è¿”å›å‘é‡ä¸­çš„ç›¸åº”å…ƒç´ è¢«è®¾ç½®ä¸ºé›¶ã€‚</p>\n<p>ä¸€ä¸ªç¤ºä¾‹å°†è¯´æ˜å¦‚ä½•ä½¿ç”¨è¿™äº›å‡½æ•°ã€‚mask_load.cä¸­çš„ä»£ç å°†8ä¸ªæ•´å‹è¯»å…¥ä¸€ä¸ªå‘é‡ï¼Œæœ€å3ä¸ªåº”è¯¥è®¾ç½®ä¸º0ã€‚è¦ä½¿ç”¨çš„å‡½æ•°æ˜¯_mm256_maskload_epi32ï¼Œå®ƒçš„ç¬¬äºŒä¸ªå‚æ•°åº”è¯¥æ˜¯__m256iæ©ç å‘é‡ã€‚è¿™ä¸ªæ©ç å‘é‡åŒ…å«5ä¸ªæœ€é«˜ä½ä¸º1çš„æ•´æ•°å’Œ3ä¸ªæœ€é«˜ä½ä¸º0çš„æ•´æ•°ã€‚ä¸‹é¢æ˜¯ä»£ç çš„æ ·å­:</p>\n<p>ã€intå‹åœ¨è®¡ç®—æœºçš„å­˜å‚¨æ˜¯è¡¥ç ï¼Œæ­£æ•°çš„è¡¥ç æœ€é«˜ä½ä¸º0ï¼Œæ‰€ä»¥è¿™é‡Œè¿”å›0ï¼Œè´Ÿæ•°çš„è¡¥ç æœ€é«˜ä½ä¸º1ï¼Œæ‰€ä»¥è¿™é‡Œè¿”å›çš„æ˜¯å†…å­˜ä¸­ç›¸åº”çš„å…ƒç´ ã€‘</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;immintrin.h&gt;</span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;stdio.h&gt;</span></span><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span> </span>&#123;<br><br>  <span class=\"hljs-keyword\">int</span> i;<br>  <br>  <span class=\"hljs-keyword\">int</span> int_array[<span class=\"hljs-number\">8</span>] = &#123;<span class=\"hljs-number\">100</span>, <span class=\"hljs-number\">200</span>, <span class=\"hljs-number\">300</span>, <span class=\"hljs-number\">400</span>, <span class=\"hljs-number\">500</span>, <span class=\"hljs-number\">600</span>, <span class=\"hljs-number\">700</span>, <span class=\"hljs-number\">800</span>&#125;;<br>  <br>  <span class=\"hljs-comment\">/* Initialize the mask vector */</span><br>  __m256i mask = _mm256_setr_epi32(<span class=\"hljs-number\">-20</span>, <span class=\"hljs-number\">-72</span>, <span class=\"hljs-number\">-48</span>, <span class=\"hljs-number\">-9</span>, <span class=\"hljs-number\">-100</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">8</span>);\t<span class=\"hljs-comment\">//è¿™é‡Œéœ€è¦å……åˆ†ç†è§£è®¡ç®—æœºç»„æˆåŸç†ä¸­çš„è¡¥ç </span><br><br>  <span class=\"hljs-comment\">/* Selectively load data into the vector */</span><br>  __m256i result = _mm256_maskload_epi32(int_array, mask);<br>  <br>  <span class=\"hljs-comment\">/* Display the elements of the result vector */</span><br>  <span class=\"hljs-keyword\">int</span>* res = (<span class=\"hljs-keyword\">int</span>*)&amp;result;<br>  <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;%d %d %d %d %d %d %d %d\\n&quot;</span>, <br>    res[<span class=\"hljs-number\">0</span>], res[<span class=\"hljs-number\">1</span>], res[<span class=\"hljs-number\">2</span>], res[<span class=\"hljs-number\">3</span>], res[<span class=\"hljs-number\">4</span>], res[<span class=\"hljs-number\">5</span>], res[<span class=\"hljs-number\">6</span>], res[<span class=\"hljs-number\">7</span>]);<br>  <br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>å¦‚æœæ‚¨åœ¨æ”¯æŒAVX2çš„ç³»ç»Ÿä¸Šè¿è¡Œæ­¤åº”ç”¨ç¨‹åºï¼Œå®ƒå°†æ‰“å°ä»¥ä¸‹ç»“æœ:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-number\">100</span> <span class=\"hljs-number\">200</span> <span class=\"hljs-number\">300</span> <span class=\"hljs-number\">400</span> <span class=\"hljs-number\">500</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span><br></code></pre></div></td></tr></table></figure>\n\n<p>æœ‰ä¸‰ç‚¹æ˜¯éœ€è¦æ³¨æ„çš„ï¼š</p>\n<ol>\n<li>ä»£ç ä½¿ç”¨_setr_å‡½æ•°è€Œä¸æ˜¯_set_æ¥è®¾ç½®æ©ç å‘é‡çš„å†…å®¹ï¼Œå› ä¸ºå®ƒåœ¨å°†å‘é‡å…ƒç´ ä¼ é€’ç»™å‡½æ•°æ—¶å¯¹å®ƒä»¬è¿›è¡Œæ’åºã€‚</li>\n<li>è´Ÿæ•´æ•°çš„æœ€é«˜ä½æ€»æ˜¯1ã€‚è¿™å°±æ˜¯æ©ç å‘é‡åŒ…å«äº”ä¸ªè´Ÿæ•°å’Œä¸‰ä¸ªæ­£æ•°çš„åŸå› ã€‚</li>\n<li>_mm256_maskload_epi32å‡½æ•°ç”±AVX2æä¾›ï¼Œè€Œä¸æ˜¯AVXã€‚å› æ­¤ï¼Œè¦ç”¨gccç¼–è¯‘è¿™æ®µä»£ç ï¼Œå¿…é¡»ä½¿ç”¨-mavx2æ ‡å¿—è€Œä¸æ˜¯-mavxã€‚</li>\n</ol>\n<p>é™¤äº†è¡¨3ä¸­åˆ—å‡ºçš„å‡½æ•°ä¹‹å¤–ï¼ŒAVX2è¿˜æä¾›äº†ä»å†…å­˜åŠ è½½ç´¢å¼•æ•°æ®çš„é›†åˆå‡½æ•°ã€‚</p>\n<h2 id=\"6-Arithmetic-Intrinsics\"><a href=\"#6-Arithmetic-Intrinsics\" class=\"headerlink\" title=\"6.Arithmetic Intrinsics\"></a>6.Arithmetic Intrinsics</h2><p>æ•°å­¦æ˜¯AVXå­˜åœ¨çš„ä¸»è¦åŸå› ï¼ŒåŸºæœ¬æ“ä½œæ˜¯åŠ ã€å‡ã€ä¹˜å’Œé™¤ã€‚æœ¬èŠ‚å°†ä»‹ç»æ‰§è¡Œè¿™äº›æ“ä½œçš„intrinsic funtionsï¼Œè¿˜å°†ä»‹ç»AVX2æä¾›çš„æ–°çš„èåˆä¹˜æ³•å’ŒåŠ æ³•å‡½æ•°ã€‚</p>\n<h3 id=\"6-1åŠ æ³•å’Œå‡æ³•\"><a href=\"#6-1åŠ æ³•å’Œå‡æ³•\" class=\"headerlink\" title=\"6.1åŠ æ³•å’Œå‡æ³•\"></a>6.1åŠ æ³•å’Œå‡æ³•</h3><p>è¡¨4åˆ—å‡ºäº†æ‰§è¡ŒåŠ æ³•å’Œå‡æ³•çš„AVX&#x2F;AVX2 intrinsicã€‚ç”±äºè€ƒè™‘åˆ°é¥±å’Œåº¦ï¼Œå®ƒä»¬å¤§å¤šæ•°éƒ½ä½œç”¨äºåŒ…å«æ•´æ•°çš„å‘é‡ã€‚</p>\n<p><strong>Table 4: Addition and Subtraction Intrinsics</strong></p>\n<table>\n<thead>\n<tr>\n<th>Data Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>_mm256_add_ps/pd</code></td>\n<td>Add two floating-point vectors</td>\n</tr>\n<tr>\n<td><code>_mm256_sub_ps/pd</code></td>\n<td>Subtract two floating-point vectors</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_add_epi8/16/32/64 </code></td>\n<td>Add two integer vectors</td>\n</tr>\n<tr>\n<td><code>(2)_mm236_sub_epi8/16/32/64</code></td>\n<td>Subtract two integer vectors</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_adds_epi8/16</code> <code>(2)_mm256_adds_epu8/16 </code></td>\n<td>Add two integer vectors with saturation</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_subs_epi8/16</code> <code>(2)_mm256_subs_epu8/16</code></td>\n<td>Subtract two integer vectors with saturation</td>\n</tr>\n<tr>\n<td><code>_mm256_hadd_ps/pd</code></td>\n<td>Add two floating-point vectors horizontally</td>\n</tr>\n<tr>\n<td><code>_mm256_hsub_ps/pd</code></td>\n<td>Subtract two floating-point vectors horizontally</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_hadd_epi16/32</code></td>\n<td>Add two integer vectors horizontally</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_hsub_epi16/32</code></td>\n<td>Subtract two integer vectors horizontally</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_hadds_epi16</code></td>\n<td>Add two vectors containing shorts horizontally with saturation</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_hsubs_epi16</code></td>\n<td>Subtract two vectors containing shorts horizontally with saturation</td>\n</tr>\n<tr>\n<td><code>_mm256_addsub_ps/pd</code></td>\n<td>Add and subtract two floating-point vectors</td>\n</tr>\n</tbody></table>\n<p>åŠ æ³•å’Œå‡æ³•æ•´æ•°å‘é‡æ—¶ï¼Œé‡è¦çš„æ˜¯è¦æŸ¥çœ‹_add_&#x2F;_sub_å‡½æ•°å’Œ_adds_&#x2F;_subs_å‡½æ•°ä¹‹é—´çš„åŒºåˆ«ã€‚é¢å¤–çš„sä»£è¡¨é¥±å’Œï¼Œå½“ç»“æœéœ€è¦çš„å†…å­˜è¶…è¿‡å‘é‡å¯ä»¥å­˜å‚¨çš„å†…å­˜æ—¶ï¼Œå°±ä¼šäº§ç”Ÿé¥±å’Œã€‚Functions that take saturation into account clamp the result to the minimum&#x2F;maximum value that can be stored.æ²¡æœ‰é¥±å’Œçš„å‡½æ•°åœ¨å‘ç”Ÿé¥±å’Œæ—¶å¿½ç•¥å†…å­˜é—®é¢˜ã€‚</p>\n<p>ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªå‘é‡åŒ…å«æœ‰ç¬¦å·å­—èŠ‚ï¼Œé‚£ä¹ˆæ¯ä¸ªå…ƒç´ çš„æœ€å¤§å€¼æ˜¯127 (0x7F)ã€‚å¦‚æœä¸€ä¸ªè¿ç®—å°†98åŠ åˆ°85ï¼Œæ•°å­¦å’Œæ˜¯183 (0xB7)ã€‚</p>\n<ul>\n<li>å¦‚æœä½¿ç”¨_mm256_add_epi8æ·»åŠ è¿™äº›å€¼ï¼Œé¥±å’Œåº¦å°†è¢«å¿½ç•¥ï¼Œå­˜å‚¨çš„ç»“æœå°†æ˜¯-73 (0xB7)ã€‚</li>\n<li>å¦‚æœä½¿ç”¨_mm256_adds_epi8æ·»åŠ è¿™äº›å€¼ï¼Œç»“æœå°†è¢«å›ºå®šä¸ºæœ€å¤§å€¼127 (0x7F)ã€‚</li>\n</ul>\n<p>ä½œä¸ºå¦ä¸€ä¸ªä¾‹å­ï¼Œè€ƒè™‘ä¸¤ä¸ªåŒ…å«æœ‰ç¬¦å·çŸ­æ•´æ•°çš„å‘é‡ã€‚æœ€å°å€¼ä¸º-32,768ã€‚å¦‚æœè®¡ç®—-18,000 - 19,000ï¼Œæ•°å­¦ç»“æœæ˜¯-37,000 (0xFFFF6F78ä½œä¸º32ä½æ•´æ•°)ã€‚</p>\n<ul>\n<li>å¦‚æœç”¨_mm256_sub_epi16å‡å»è¿™äº›å€¼ï¼Œé¥±å’Œåº¦å°†è¢«å¿½ç•¥ï¼Œå­˜å‚¨çš„ç»“æœå°†æ˜¯28,536 (0x6F78)ã€‚</li>\n<li>å¦‚æœç”¨_mm256_subs_epi16å‡å»è¿™äº›å€¼ï¼Œç»“æœå°†è¢«å‹ç¼©åˆ°æœ€å°å€¼-32,768 (0x8000)ã€‚</li>\n</ul>\n<p>_hadd_&#x2F;_hsub_å‡½æ•°æ°´å¹³æ‰§è¡ŒåŠ æ³•å’Œå‡æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬ä¸æ˜¯æ·»åŠ æˆ–å‡å»ä¸åŒå‘é‡çš„å…ƒç´ ï¼Œè€Œæ˜¯åœ¨æ¯ä¸ªå‘é‡ä¸­æ·»åŠ æˆ–å‡å»<strong>ç›¸é‚»</strong>çš„å…ƒç´ ã€‚ç»“æœä»¥äº¤é”™çš„æ–¹å¼å­˜å‚¨ã€‚å›¾1æ˜¾ç¤ºäº†_mm256_hadd_pdçš„å·¥ä½œåŸç†ï¼Œå®ƒæ°´å¹³åœ°æ·»åŠ äº†ä¸¤ä¸ªå‘é‡Aå’ŒB:</p>\n<p><img src=\"/2023/03/10/avx006/Fig1.jpg\" alt=\"Image 1\"></p>\n<p><strong>Figure 1: Horizontal Addition of Two Vectors</strong></p>\n<p>æ°´å¹³åŠ å‡å…ƒç´ çœ‹èµ·æ¥å¯èƒ½å¾ˆå¥‡æ€ªï¼Œä½†è¿™äº›æ“ä½œåœ¨å¤æ•°ç›¸ä¹˜æ—¶å¾ˆæœ‰ç”¨ã€‚æœ¬æ–‡ç¨åå°†å¯¹æ­¤è¿›è¡Œè§£é‡Šã€‚è¡¨4ä¸­çš„æœ€åä¸€ä¸ªå‡½æ•°_mm256_addsub_ps&#x2F;pdäº¤æ›¿å‡æ³•å’ŒåŠ æ³•ä¸¤ä¸ªæµ®ç‚¹å‘é‡çš„å…ƒç´ ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¶æ•°å…ƒç´ è¢«å‡å»ï¼Œå¥‡æ•°å…ƒç´ è¢«åŠ ä¸Šã€‚ä¾‹å¦‚ï¼Œå¦‚æœvec_aåŒ…å«(0.1,0.2,0.3,0.4)ï¼Œvec_båŒ…å«(0.5,0.6,0.7,0.8)ï¼Œåˆ™_mm256_addsub_pd(vec_a, vec_b)ç­‰äº(-0.4,0.8ï¼Œ-0.4,1.2)ã€éœ€è¦æ³¨æ„æ•°ç»„ä¸‹æ ‡ä»0å¼€å§‹ã€‘ã€‚</p>\n<h3 id=\"6-2ä¹˜æ³•å’Œé™¤æ³•\"><a href=\"#6-2ä¹˜æ³•å’Œé™¤æ³•\" class=\"headerlink\" title=\"6.2ä¹˜æ³•å’Œé™¤æ³•\"></a>6.2ä¹˜æ³•å’Œé™¤æ³•</h3><p>è¡¨5åˆ—å‡ºäº†æ‰§è¡Œä¹˜æ³•å’Œé™¤æ³•çš„AVX&#x2F;AVX2 intrinsicã€‚ä¸åŠ æ³•å’Œå‡æ³•ä¸€æ ·ï¼Œå¯¹æ•´æ•°è¿›è¡Œè¿ç®—ä¹Ÿæœ‰ä¸€äº›ç‰¹æ®Šçš„ç‰¹æ€§ã€‚</p>\n<p><strong>Table 5: Multiplication and Division Intrinsics</strong></p>\n<table>\n<thead>\n<tr>\n<th>Data Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>_mm256_mul_ps/pd</code></td>\n<td>Multiply two floating-point vectors</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_mul_epi32/</code> <code>(2)_mm256_mul_epu32 </code></td>\n<td>Multiply the lowest four elements of vectors containing 32-bit integers</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_mullo_epi16/32</code></td>\n<td>Multiply integers and store low halves</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_mulhi_epi16/</code> <code>(2)_mm256_mulhi_epu16</code></td>\n<td>Multiply integers and store high halves</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_mulhrs_epi16</code></td>\n<td>Multiply 16-bit elements to form 32-bit elements</td>\n</tr>\n<tr>\n<td><code>_mm256_div_ps/pd</code></td>\n<td>Divide two floating-point vectors</td>\n</tr>\n</tbody></table>\n<p>å¦‚æœä¸¤ä¸ªNä½çš„æ•°å­—åœ¨è®¡ç®—æœºä¸Šç›¸ä¹˜ï¼Œç»“æœå¯ä»¥å ç”¨2Nä½ã€è¿™é‡Œä½ éœ€è¦ç†Ÿæ‚‰è®¡ç®—æœºç»„æˆåŸç†ä¸­çš„ä¹˜æ³•åŸç†ï¼ŒåŒæ—¶æ€è€ƒä¼šä¸ä¼šåœ¨æŸäº›å‡½æ•°å‡ºç°ç²¾åº¦æŸå¤±çš„æƒ…å†µã€‘ã€‚å› æ­¤ï¼Œåªæœ‰_mm256_mul_epi32å’Œ_mm256_mul_epu32çš„å››ä¸ªä½å…ƒç´ è¢«ä¹˜åœ¨ä¸€èµ·ï¼Œç»“æœæ˜¯ä¸€ä¸ªåŒ…å«å››ä¸ªé•¿æ•´æ•°çš„å‘é‡ã€‚</p>\n<p><strong>___m256i _mm256_mul_epi32 (m256i a, __m256i b)</strong></p>\n<p><strong>Description</strong></p>\n<p>Multiply the low signed 32-bit integers from each packed 64-bit element in a and b, and store the signed 64-bit results in dst.</p>\n<p><strong>Operation</strong></p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">FOR</span> j := <span class=\"hljs-number\">0</span> to <span class=\"hljs-number\">3</span> <br>\t<span class=\"hljs-attribute\">i</span> := j*<span class=\"hljs-number\">64</span> <br>\t<span class=\"hljs-attribute\">dst</span>[i+<span class=\"hljs-number\">63</span>:i] := SignExtend<span class=\"hljs-number\">64</span>(a[i+<span class=\"hljs-number\">31</span>:i]) * SignExtend<span class=\"hljs-number\">64</span>(b[i+<span class=\"hljs-number\">31</span>:i]) <br><span class=\"hljs-attribute\">ENDFOR</span> <br><span class=\"hljs-attribute\">dst</span>[MAX:<span class=\"hljs-number\">256</span>] := <span class=\"hljs-number\">0</span><br></code></pre></div></td></tr></table></figure>\n\n<p><strong>å›¾2:æ•´æ•°å‘é‡çš„ä½å…ƒç´ ç›¸ä¹˜</strong></p>\n<p>_mullo_å‡½æ•°ç±»ä¼¼äºæ•´æ•°_mul_å‡½æ•°ï¼Œä½†å®ƒä»¬ä¸æ˜¯ä¹˜ä½å…ƒç´ ï¼Œè€Œæ˜¯ä¹˜ä¸¤ä¸ªå‘é‡çš„æ¯ä¸ªå…ƒç´ ï¼Œåªå­˜å‚¨æ¯ä¸ªä¹˜ç§¯çš„ä½ä¸€åŠã€‚</p>\n<p><strong>Synopsis</strong></p>\n<p><strong>m256i _mm256_mullo_epi32 (m256i a, __m256i b)</strong><br>#include &lt;immintrin.h&gt;<br>Instruction: vpmulld ymm, ymm, ymm<br>CPUID Flags: AVX2</p>\n<p><strong>Description</strong></p>\n<p>Multiply the packed signed 32-bit integers in a and b, producing intermediate 64-bit integers, and store the low 32 bits of the intermediate integers in dst.</p>\n<p><strong>Operation</strong></p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">FOR</span> j := <span class=\"hljs-number\">0</span> to <span class=\"hljs-number\">7</span> <br>\t\t<span class=\"hljs-attribute\">i</span> := j*<span class=\"hljs-number\">32</span> <br>\t\t<span class=\"hljs-attribute\">tmp</span>[<span class=\"hljs-number\">63</span>:<span class=\"hljs-number\">0</span>] := a[i+<span class=\"hljs-number\">31</span>:i] * b[i+<span class=\"hljs-number\">31</span>:i] <br>\t\t<span class=\"hljs-attribute\">dst</span>[i+<span class=\"hljs-number\">31</span>:i] := tmp[<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">0</span>] <br><span class=\"hljs-attribute\">ENDFOR</span> <br><span class=\"hljs-attribute\">dst</span>[MAX:<span class=\"hljs-number\">256</span>] := <span class=\"hljs-number\">0</span><br></code></pre></div></td></tr></table></figure>\n\n<p><strong>å›¾3:æ•´æ•°ç›¸ä¹˜å’Œå­˜å‚¨ä½äºŒåˆ†ä¹‹ä¸€</strong></p>\n<p>_mm256_mulhi_epi16å’Œ_mm256_mulhi_epu16 intrinsicsç±»ä¼¼ï¼Œä½†æ˜¯å®ƒä»¬å­˜å‚¨æ•´æ•°ç§¯çš„é«˜ä¸€åŠã€‚</p>\n<p><strong>Synopsis</strong></p>\n<p><strong>m256i _mm256_mulhi_epi16 (m256i a, __m256i b)</strong><br>#include &lt;immintrin.h&gt;<br>Instruction: vpmulhw ymm, ymm, ymm<br>CPUID Flags: AVX2</p>\n<p><strong>Description</strong></p>\n<p>Multiply the packed signed 16-bit integers in a and b, producing intermediate 32-bit integers, and store the high 16 bits of the intermediate integers in dst.</p>\n<p><strong>Operation</strong></p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">FOR</span> j := <span class=\"hljs-number\">0</span> to <span class=\"hljs-number\">15</span> <br>\t<span class=\"hljs-attribute\">i</span> := j*<span class=\"hljs-number\">16</span> <br>\t<span class=\"hljs-attribute\">tmp</span>[<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">0</span>] := SignExtend<span class=\"hljs-number\">32</span>(a[i+<span class=\"hljs-number\">15</span>:i]) * SignExtend<span class=\"hljs-number\">32</span>(b[i+<span class=\"hljs-number\">15</span>:i]) \t\t   \t   dst[i+<span class=\"hljs-number\">15</span>:i] := tmp[<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">16</span>] <br><span class=\"hljs-attribute\">ENDFOR</span> <br><span class=\"hljs-attribute\">dst</span>[MAX:<span class=\"hljs-number\">256</span>] := <span class=\"hljs-number\">0</span><br></code></pre></div></td></tr></table></figure>\n\n\n\n<h3 id=\"6-3Fused-Multiply-and-Add-FMA\"><a href=\"#6-3Fused-Multiply-and-Add-FMA\" class=\"headerlink\" title=\"6.3Fused Multiply and Add (FMA)\"></a>6.3Fused Multiply and Add (FMA)</h3><p>å¦‚å‰æ‰€è¿°ï¼Œä¸¤ä¸ªNä½æ•°å­—ç›¸ä¹˜çš„ç»“æœå¯ä»¥å ç”¨2Nä½ã€‚å› æ­¤ï¼Œå½“æ‚¨å°†ä¸¤ä¸ªæµ®ç‚¹å€¼aå’Œbç›¸ä¹˜æ—¶ï¼Œç»“æœå®é™…ä¸Šæ˜¯å››èˆäº”å…¥(a * b)ï¼Œå…¶ä¸­å››èˆäº”å…¥(x)è¿”å›æœ€æ¥è¿‘xçš„æµ®ç‚¹å€¼ã€‚éšç€è¿›ä¸€æ­¥æ“ä½œçš„æ‰§è¡Œï¼Œè¿™ç§ç²¾åº¦æŸå¤±ä¼šå¢åŠ ã€‚ã€è¿™é‡Œéœ€è¦æ³¨æ„åˆ†éƒ¨ä¹˜åŠ ï¼Œå…ˆä¹˜æ³•ååŠ æ³•å’Œä½¿ç”¨FMAä¸¤è€…çš„è®¡ç®—ç²¾åº¦ã€‘</p>\n<p>AVX2æä¾›äº†å°†ä¹˜æ³•å’ŒåŠ æ³•èåˆåœ¨ä¸€èµ·çš„æŒ‡ä»¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬ä¸æ˜¯è¿”å›æ•´æ•°(æ•´æ•°(a * b) + c)ï¼Œè€Œæ˜¯è¿”å›æ•´æ•°(a * b + c)ã€‚å› æ­¤ï¼Œè¿™äº›æŒ‡ä»¤æ¯”åˆ†åˆ«æ‰§è¡Œä¹˜æ³•å’ŒåŠ æ³•æä¾›äº†æ›´é«˜çš„é€Ÿåº¦å’Œå‡†ç¡®æ€§ã€è¿™é‡Œæ­£æ˜¯FMAçš„ç‰¹ç‚¹ã€‘ã€‚</p>\n<p>è¡¨6åˆ—å‡ºäº†AVX2æä¾›çš„FMA intrinsicï¼Œå¹¶åŒ…æ‹¬å¯¹æ¯ä¸ªå‡½æ•°çš„æè¿°ã€‚è¡¨ä¸­çš„æ¯æ¡æŒ‡ä»¤éƒ½æ¥å—ä¸‰ä¸ªè¾“å…¥å‘é‡ï¼Œæˆ‘æŠŠå®ƒä»¬åˆ†åˆ«ç§°ä¸ºaã€bå’Œcã€‚</p>\n<p><strong>Table 6: FMA Intrinsics</strong></p>\n<table>\n<thead>\n<tr>\n<th>Data Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>(2)_mm_fmadd_ps/pd/</code> <code>(2)_mm256_fmadd_ps/pd</code></td>\n<td>Multiply two vectors and add the product to a third (res &#x3D; a * b + c)</td>\n</tr>\n<tr>\n<td><code>(2)_mm_fmsub_ps/pd/</code> <code>(2)_mm256_fmsub_ps/pd</code></td>\n<td>Multiply two vectors and subtract a vector from the product (res &#x3D; a * b - c)</td>\n</tr>\n<tr>\n<td><code>(2)_mm_fmadd_ss/sd </code></td>\n<td>Multiply and add the lowest element in the vectors (res[0] &#x3D; a[0] * b[0] + c[0])</td>\n</tr>\n<tr>\n<td><code>(2)_mm_fmsub_ss/sd</code></td>\n<td>Multiply and subtract the lowest element in the vectors (res[0] &#x3D; a[0] * b[0] - c[0])</td>\n</tr>\n<tr>\n<td><code>(2)_mm_fnmadd_ps/pd</code> <code>(2)_mm256_fnmadd_ps/pd </code></td>\n<td>Multiply two vectors and add the negated product to a third (res &#x3D; -(a * b) + c)</td>\n</tr>\n<tr>\n<td><code>(2)_mm_fnmsub_ps/pd/</code> <code>(2)_mm256_fnmsub_ps/pd</code></td>\n<td>Multiply two vectors and add the negated product to a third (res &#x3D; -(a * b) - c)</td>\n</tr>\n<tr>\n<td><code>(2)_mm_fnmadd_ss/sd</code></td>\n<td>Multiply the two lowest elements and add the negated product to the lowest element of the third vector (res[0] &#x3D; -(a[0] * b[0]) + c[0])</td>\n</tr>\n<tr>\n<td><code>(2)_mm_fnmsub_ss/sd</code></td>\n<td>Multiply the lowest elements and subtract the lowest element of the third vector from the negated product (res[0] &#x3D; -(a[0] * b[0]) - c[0])</td>\n</tr>\n<tr>\n<td><code>(2)_mm_fmaddsub_ps/pd/</code> <code>(2)_mm256_fmaddsub_ps/pd</code></td>\n<td>Multiply two vectors and alternately add and subtract from the product (res &#x3D; a * b - c)</td>\n</tr>\n<tr>\n<td><code>(2)_mm_fmsubadd_ps/pd/</code> <code>(2)_mmf256_fmsubadd_ps/pd </code></td>\n<td>Multiply two vectors and alternately subtract and add from the product (res &#x3D; a * b - c)</td>\n</tr>\n</tbody></table>\n<p>å¦‚æœä¸€ä¸ªå†…å¾çš„åç§°ä»¥_psæˆ–_pdç»“å°¾ï¼Œåˆ™è¾“å…¥å‘é‡çš„æ¯ä¸ªå…ƒç´ éƒ½åŒ…å«åœ¨è¿ç®—ä¸­ã€‚å¦‚æœintrinsicçš„åç§°ä»¥_ssæˆ–_sdç»“å°¾ï¼Œåˆ™åªåŒ…æ‹¬æœ€ä½çš„å…ƒç´ ã€‚è¾“å‡ºå‘é‡ä¸­çš„å…¶ä½™å…ƒç´ è¢«è®¾ç½®ä¸ºä¸ç¬¬ä¸€ä¸ªè¾“å…¥å‘é‡ä¸­çš„å…ƒç´ ç›¸ç­‰ã€‚ä¾‹å¦‚,å‡è®¾vec_a &#x3D; (1.0, 2.0)ï¼Œ vec_b &#x3D; (5.0, 10.0)ï¼Œ vec_c &#x3D;(7.0, 14.0)ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œ_mm_fmadd_sd(vec_a, vec_b, vec_c)è¿”å›(12.0,2.0)ï¼Œå› ä¸º(1.0 * 5.0)+ 7.0 &#x3D; 12.0,2.0æ˜¯vec_açš„ç¬¬äºŒä¸ªå…ƒç´ ã€‚</p>\n<p>äº†è§£_fmadd_&#x2F;_fmsub_å’Œ_fnmadd_&#x2F;_fnmsub_ intrinsicä¹‹é—´çš„åŒºåˆ«å¾ˆé‡è¦ã€‚åä¸€ç§å‡½æ•°åœ¨åŠ ä¸Šæˆ–å‡å»ç¬¬ä¸‰ä¸ªè¾“å…¥å‘é‡ä¹‹å‰ï¼Œå¯¹å‰ä¸¤ä¸ªè¾“å…¥å‘é‡çš„ä¹˜ç§¯æ±‚åã€‚</p>\n<p><strong>Synopsis</strong></p>\n<p><strong>__m256d _mm256_fnmadd_pd (m256d a, m256d b, m256d c)</strong><br>#include &lt;immintrin.h&gt;<br>Instruction: vfnmadd132pd ymm, ymm, ymm<br>       vfnmadd213pd ymm, ymm, ymm<br>       vfnmadd231pd ymm, ymm, ymm<br>CPUID Flags: FMA</p>\n<p><strong>Description</strong></p>\n<p>Multiply packed double-precision (64-bit) floating-point elements in a and b, add the negated intermediate result to packed elements in c, and store the results in dst.</p>\n<p><strong>Operation</strong></p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">FOR</span> j := <span class=\"hljs-number\">0</span> to <span class=\"hljs-number\">3</span> <br>\t\t<span class=\"hljs-attribute\">i</span> := j*<span class=\"hljs-number\">64</span> <br>\t\t<span class=\"hljs-attribute\">dst</span>[i+<span class=\"hljs-number\">63</span>:i] := -(a[i+<span class=\"hljs-number\">63</span>:i] * b[i+<span class=\"hljs-number\">63</span>:i]) + c[i+<span class=\"hljs-number\">63</span>:i] <br><span class=\"hljs-attribute\">ENDFOR</span>\t <br><span class=\"hljs-attribute\">dst</span>[MAX:<span class=\"hljs-number\">256</span>] := <span class=\"hljs-number\">0</span><br></code></pre></div></td></tr></table></figure>\n\n<p>_fmaddsub_å’Œ_fmsubadd_å†…åœ¨å‡½æ•°åœ¨ç¬¬ä¸‰ä¸ªå‘é‡çš„åŠ æ³•å’Œå‡æ³•å…ƒç´ ä¹‹é—´äº¤æ›¿ä½¿ç”¨ã€‚_fmaddsub_ intrinsicå¥‡æ•°å…ƒç´ åšåŠ æ³•è€Œå¶æ•°å…ƒç´ åšå‡æ³•ã€‚_fmsubadd_ intrinsicå¥‡æ•°å…ƒç´ åšå‡æ³•è€Œå¶æ•°å…ƒç´ åšåŠ æ³•ã€‚fmatest.cä¸­çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•åœ¨å®è·µä¸­ä½¿ç”¨_mm256_fmaddsub_pd intrinsicã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;immintrin.h&gt;</span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;stdio.h&gt;</span></span><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span> </span>&#123;<br>  <br>  __m256d veca = _mm256_setr_pd(<span class=\"hljs-number\">6.0</span>, <span class=\"hljs-number\">6.0</span>, <span class=\"hljs-number\">6.0</span>, <span class=\"hljs-number\">6.0</span>);<br><br>  __m256d vecb = _mm256_setr_pd(<span class=\"hljs-number\">2.0</span>, <span class=\"hljs-number\">2.0</span>, <span class=\"hljs-number\">2.0</span>, <span class=\"hljs-number\">2.0</span>);<br>  <br>  __m256d vecc = _mm256_setr_pd(<span class=\"hljs-number\">7.0</span>, <span class=\"hljs-number\">7.0</span>, <span class=\"hljs-number\">7.0</span>, <span class=\"hljs-number\">7.0</span>);<br>  <br>  <span class=\"hljs-comment\">/* Alternately subtract and add the third vector</span><br><span class=\"hljs-comment\">     from the product of the first and second vectors */</span><br>  __m256d result = _mm256_fmaddsub_pd(veca, vecb, vecc);<br>  <br>  <span class=\"hljs-comment\">/* Display the elements of the result vector */</span><br>  <span class=\"hljs-keyword\">double</span>* res = (<span class=\"hljs-keyword\">double</span>*)&amp;result;<br>  <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;%lf %lf %lf %lf\\n&quot;</span>, res[<span class=\"hljs-number\">0</span>], res[<span class=\"hljs-number\">1</span>], res[<span class=\"hljs-number\">2</span>], res[<span class=\"hljs-number\">3</span>]);<br>  <br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>å½“è¿™æ®µä»£ç åœ¨æ”¯æŒAVX2çš„å¤„ç†å™¨ä¸Šç¼–è¯‘å’Œæ‰§è¡Œæ—¶ï¼Œæ‰“å°çš„ç»“æœå¦‚ä¸‹:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-number\">5.000000</span> <span class=\"hljs-number\">19.000000</span> <span class=\"hljs-number\">5.000000</span> <span class=\"hljs-number\">19.000000</span><br></code></pre></div></td></tr></table></figure>\n\n<p>FMAæŒ‡ä»¤æ˜¯ç”±AVX2æä¾›çš„ï¼Œå› æ­¤æ‚¨å¯èƒ½è®¤ä¸ºä½¿ç”¨gccæ„å»ºåº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨-mavx2æ ‡å¿—ã€‚ä½†æ˜¯æˆ‘å‘ç°-mfmaæ ‡å¿—æ˜¯<strong>å¿…éœ€</strong>çš„ã€‚å¦åˆ™ï¼Œæˆ‘ä¼šå¾—åˆ°å¥‡æ€ªçš„ç¼–è¯‘é”™è¯¯ã€‚</p>\n<h2 id=\"7-Permuting-and-Shuffling\"><a href=\"#7-Permuting-and-Shuffling\" class=\"headerlink\" title=\"7.Permuting and Shuffling\"></a>7.Permuting and Shuffling</h2><p>è®¸å¤šåº”ç”¨ç¨‹åºå¿…é¡»é‡æ–°æ’åˆ—å‘é‡å…ƒç´ ï¼Œä»¥ç¡®ä¿æ­£ç¡®æ‰§è¡Œæ“ä½œã€‚</p>\n<p>AVX&#x2F;AVX2ä¸ºæ­¤ç›®çš„æä¾›äº†è®¸å¤šintrinsic funtionï¼Œå…¶ä¸­ä¸¤å¤§ç±»æ˜¯_permute_å‡½æ•°å’Œ_shuffle_å‡½æ•°ã€‚æœ¬èŠ‚ä»‹ç»è¿™ä¸¤ç§ç±»å‹çš„intrinsicã€‚</p>\n<h3 id=\"7-1Permuting\"><a href=\"#7-1Permuting\" class=\"headerlink\" title=\"7.1Permuting\"></a>7.1Permuting</h3><p>AVXæä¾›äº†è¿”å›ä¸€ä¸ªå‘é‡çš„å‡½æ•°ï¼Œè¯¥å‘é‡åŒ…å«ä¸€ä¸ªå‘é‡çš„é‡æ–°æ’åˆ—çš„å…ƒç´ ã€‚è¡¨7åˆ—å‡ºäº†è¿™äº›æ’åˆ—å‡½æ•°ï¼Œå¹¶æä¾›äº†å¯¹æ¯ä¸ªå‡½æ•°çš„æè¿°ã€‚</p>\n<p><strong>Table 7: Permute Intrinsics</strong></p>\n<table>\n<thead>\n<tr>\n<th>Data Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>_mm_permute_ps/pd/</code> <code>_mm256_permute_ps/pd</code></td>\n<td>Select elements from the input vector based on an 8-bit control value</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_permute4x64_pd/</code> <code>(2)_mm256_permute4x64_epi64</code></td>\n<td>Select 64-bit elements from the input vector based on an 8-bit control value</td>\n</tr>\n<tr>\n<td><code>_mm256_permute2f128_ps/pd</code></td>\n<td>Select 128-bit chunks from two input vectors based on an 8-bit control value</td>\n</tr>\n<tr>\n<td><code>_mm256_permute2f128_si256 </code></td>\n<td>Select 128-bit chunks from two input vectors based on an 8-bit control value</td>\n</tr>\n<tr>\n<td><code>_mm_permutevar_ps/pd</code> <code>_mm256_permutevar_ps/pd </code></td>\n<td>Select elements from the input vector based on bits in an integer vector</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_permutevar8x32_ps</code>&#x2F; <code>(2)_mm256_permutevar8x32_epi32</code></td>\n<td>Select 32-bit elements (<code>float</code>s and <code>int</code>s) using indices in an integer vector</td>\n</tr>\n</tbody></table>\n<p>_permute_ intrinsicæ¥å—ä¸¤ä¸ªå‚æ•°:ä¸€ä¸ªè¾“å…¥å‘é‡å’Œä¸€ä¸ª8ä½æ§åˆ¶å€¼ã€‚æ§åˆ¶å€¼çš„ä½å†³å®šè¾“å…¥å‘é‡çš„å“ªä¸ªå…ƒç´ æ’å…¥åˆ°è¾“å‡ºä¸­ã€‚</p>\n<p>å¯¹äº_mm256_permute_psï¼Œæ¯å¯¹æ§åˆ¶ä½é€šè¿‡é€‰æ‹©è¾“å…¥å‘é‡ä¸­çš„ä¸€ä¸ªä¸Šæˆ–ä¸‹å…ƒç´ æ¥ç¡®å®šä¸€ä¸ªä¸Šæˆ–ä¸‹è¾“å‡ºå…ƒç´ ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;immintrin.h&gt;</span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;bits/stdc++.h&gt;</span></span><br><span class=\"hljs-keyword\">using</span> <span class=\"hljs-keyword\">namespace</span> std;<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span> </span>&#123;<br>  <br>  __m128 v1 = _mm_setr_ps(<span class=\"hljs-number\">2.3</span>, <span class=\"hljs-number\">4.1</span>, <span class=\"hljs-number\">6.2</span>, <span class=\"hljs-number\">8.4</span>);<br>  <span class=\"hljs-keyword\">float</span> * a =(<span class=\"hljs-keyword\">float</span>*)&amp;v1;<br>   <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i&lt; <span class=\"hljs-number\">4</span> ;i++)<br>   &#123;<br>   \t cout&lt;&lt;a[i]&lt;&lt;<span class=\"hljs-string\">&quot; &quot;</span>;<br>   &#125;<br>   cout&lt;&lt;endl;<br>   __m128 v2 = _mm_permute_ps (v1, <span class=\"hljs-number\">3</span>);<br>   <span class=\"hljs-keyword\">float</span> * b =(<span class=\"hljs-keyword\">float</span>*)&amp;v2;<br>   <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i&lt; <span class=\"hljs-number\">4</span> ;i++)<br>   &#123;<br>   \t cout&lt;&lt;b[i]&lt;&lt;<span class=\"hljs-string\">&quot; &quot;</span>;<br>   &#125;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">2</span>.<span class=\"hljs-number\">3</span> <span class=\"hljs-number\">4</span>.<span class=\"hljs-number\">1</span> <span class=\"hljs-number\">6</span>.<span class=\"hljs-number\">2</span> <span class=\"hljs-number\">8</span>.<span class=\"hljs-number\">4</span><br><span class=\"hljs-attribute\">8</span>.<span class=\"hljs-number\">4</span> <span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">3</span> <span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">3</span> <span class=\"hljs-number\">2</span>.<span class=\"hljs-number\">3</span><br></code></pre></div></td></tr></table></figure>\n\n<p><strong>Figure 4: Operation of the Permute Intrinsic Function</strong></p>\n<p>å¦‚å›¾æ‰€ç¤ºï¼Œè¾“å…¥å‘é‡çš„å€¼å¯ä»¥åœ¨è¾“å‡ºä¸­é‡å¤å¤šæ¬¡ã€‚å…¶ä»–è¾“å…¥å€¼å¯èƒ½æ ¹æœ¬ä¸è¢«é€‰æ‹©ã€‚</p>\n<p>åœ¨_mm256_permute_pdä¸­ï¼Œæ§åˆ¶å€¼çš„ä½å››ä½åœ¨ç›¸é‚»çš„åŒç²¾åº¦æ•°å¯¹ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚_mm256_permute4x4_pdç±»ä¼¼ï¼Œä½†ä½¿ç”¨æ‰€æœ‰æ§åˆ¶ä½æ¥é€‰æ‹©å°†å“ªä¸ª64ä½å…ƒç´ æ”¾åœ¨è¾“å‡ºä¸­ã€‚åœ¨_permute2f128_ intrinsicä¸­ï¼Œæ§åˆ¶å€¼ä»ä¸¤ä¸ªè¾“å…¥å‘é‡ä¸­é€‰æ‹©128ä½å—ï¼Œè€Œä¸æ˜¯ä»ä¸€ä¸ªè¾“å…¥å‘é‡ä¸­é€‰æ‹©å…ƒç´ ã€‚</p>\n<p>_permutevar_ intrinsicæ‰§è¡Œä¸_permute_ intrinsicç›¸åŒçš„æ“ä½œã€‚ä½†æ˜¯å®ƒä»¬ä¸æ˜¯ä½¿ç”¨8ä½æ§åˆ¶å€¼æ¥é€‰æ‹©å…ƒç´ ï¼Œè€Œæ˜¯ä¾èµ–äºä¸è¾“å…¥å‘é‡å¤§å°ç›¸åŒçš„æ•´æ•°å‘é‡ã€‚ä¾‹å¦‚ï¼Œ_mm256_permute_psçš„è¾“å…¥å‘é‡æ˜¯_mm256ï¼Œå› æ­¤æ•´æ•°å‘é‡æ˜¯_mm256iã€‚æ•´æ•°å‘é‡çš„é«˜ä½æ‰§è¡Œé€‰æ‹©çš„æ–¹å¼ä¸_permute_ intrinsicçš„8ä½æ§åˆ¶å€¼çš„ä½ç›¸åŒã€‚</p>\n<h3 id=\"7-2Shuffling\"><a href=\"#7-2Shuffling\" class=\"headerlink\" title=\"7.2Shuffling\"></a>7.2Shuffling</h3><p>åƒ_permute_ intrinsicä¸€æ ·ï¼Œ_shuffle_ intrinsicä»ä¸€ä¸ªæˆ–ä¸¤ä¸ªè¾“å…¥å‘é‡ä¸­é€‰æ‹©å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬æ”¾åœ¨è¾“å‡ºå‘é‡ä¸­ã€‚è¡¨8åˆ—å‡ºäº†è¿™äº›åŠŸèƒ½ï¼Œå¹¶æä¾›äº†æ¯ä¸ªåŠŸèƒ½çš„æè¿°ã€‚</p>\n<p><strong>Table 8: Shuffle Intrinsics</strong></p>\n<table>\n<thead>\n<tr>\n<th>Data Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>_mm256_shuffle_ps/pd</code></td>\n<td>Select floating-point elements according to an 8-bit value</td>\n</tr>\n<tr>\n<td><code>_mm256_shuffle_epi8/</code> <code>_mm256_shuffle_epi32</code></td>\n<td>Select integer elements according to an 8-bit value</td>\n</tr>\n<tr>\n<td><code>(2)_mm256_shufflelo_epi16/ </code> <code>(2)_mm256_shufflehi_epi16</code></td>\n<td>Select 128-bit chunks from two input vectors based on an 8-bit control value</td>\n</tr>\n</tbody></table>\n<p>æ‰€æœ‰çš„shuffle_ intrinsicè¿ç®—äº256ä½å‘é‡ã€‚åœ¨æ¯ç§æƒ…å†µä¸‹ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª8ä½çš„å€¼ï¼Œå®ƒå†³å®šå“ªäº›è¾“å…¥å…ƒç´ åº”è¯¥æ”¾åœ¨è¾“å‡ºå‘é‡ä¸­ã€‚</p>\n<p>å¯¹äº_mm256_shuffle_psï¼Œåªä½¿ç”¨æ§ä»¶å€¼çš„é«˜å››ä½ã€‚å¦‚æœè¾“å…¥å‘é‡åŒ…å«æ•´å‹æˆ–æµ®ç‚¹æ•°ï¼Œåˆ™ä½¿ç”¨æ‰€æœ‰æ§åˆ¶ä½ã€‚å¯¹äº_mm256_shuffle_psï¼Œå‰ä¸¤å¯¹ä½é€‰æ‹©ç¬¬ä¸€ä¸ªå‘é‡ä¸­çš„å…ƒç´ ï¼Œåä¸¤å¯¹ä½é€‰æ‹©ç¬¬äºŒä¸ªå‘é‡ä¸­çš„å…ƒç´ ã€‚</p>\n<p><strong>Synopsis</strong></p>\n<p><strong>m256 _mm256_shuffle_ps (m256 a, __m256 b, const int imm8)</strong><br>#include &lt;immintrin.h&gt;<br>Instruction: vshufps ymm, ymm, ymm, imm8<br>CPUID Flags: AVX</p>\n<p><strong>Description</strong></p>\n<p>Shuffle single-precision (32-bit) floating-point elements in a within 128-bit lanes using the control in imm8, and store the results in dst.</p>\n<p><strong>Operation</strong></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs stylus\">DEFINE SELECT4(<span class=\"hljs-attribute\">src</span>, control) &#123; <br>\t\tCASE(control<span class=\"hljs-selector-attr\">[1:0]</span>) OF <br>\t\t<span class=\"hljs-number\">0</span>:\ttmp<span class=\"hljs-selector-attr\">[31:0]</span> := <span class=\"hljs-attribute\">src</span>[<span class=\"hljs-number\">31</span>:<span class=\"hljs-number\">0</span>] <br>\t\t<span class=\"hljs-number\">1</span>:\ttmp<span class=\"hljs-selector-attr\">[31:0]</span> := <span class=\"hljs-attribute\">src</span>[<span class=\"hljs-number\">63</span>:<span class=\"hljs-number\">32</span>] <br>\t\t<span class=\"hljs-number\">2</span>:\ttmp<span class=\"hljs-selector-attr\">[31:0]</span> := <span class=\"hljs-attribute\">src</span>[<span class=\"hljs-number\">95</span>:<span class=\"hljs-number\">64</span>] <br>\t\t<span class=\"hljs-number\">3</span>:\ttmp<span class=\"hljs-selector-attr\">[31:0]</span> := <span class=\"hljs-attribute\">src</span>[<span class=\"hljs-number\">127</span>:<span class=\"hljs-number\">96</span>] <br>\t\tESAC <br>\t\tRETURN tmp<span class=\"hljs-selector-attr\">[31:0]</span> <br>\t\t&#125; <br>dst<span class=\"hljs-selector-attr\">[31:0]</span> := SELECT4(<span class=\"hljs-selector-tag\">a</span><span class=\"hljs-selector-attr\">[127:0]</span>, imm8<span class=\"hljs-selector-attr\">[1:0]</span>) <br>dst<span class=\"hljs-selector-attr\">[63:32]</span> := SELECT4(<span class=\"hljs-selector-tag\">a</span><span class=\"hljs-selector-attr\">[127:0]</span>, imm8<span class=\"hljs-selector-attr\">[3:2]</span>) <br>dst<span class=\"hljs-selector-attr\">[95:64]</span> := SELECT4(<span class=\"hljs-selector-tag\">b</span><span class=\"hljs-selector-attr\">[127:0]</span>, imm8<span class=\"hljs-selector-attr\">[5:4]</span>) <br>dst<span class=\"hljs-selector-attr\">[127:96]</span> := SELECT4(<span class=\"hljs-selector-tag\">b</span><span class=\"hljs-selector-attr\">[127:0]</span>, imm8<span class=\"hljs-selector-attr\">[7:6]</span>) <br>dst<span class=\"hljs-selector-attr\">[159:128]</span> := SELECT4(<span class=\"hljs-selector-tag\">a</span><span class=\"hljs-selector-attr\">[255:128]</span>, imm8<span class=\"hljs-selector-attr\">[1:0]</span>) <br>dst<span class=\"hljs-selector-attr\">[191:160]</span> := SELECT4(<span class=\"hljs-selector-tag\">a</span><span class=\"hljs-selector-attr\">[255:128]</span>, imm8<span class=\"hljs-selector-attr\">[3:2]</span>) <br>dst<span class=\"hljs-selector-attr\">[223:192]</span> := SELECT4(<span class=\"hljs-selector-tag\">b</span><span class=\"hljs-selector-attr\">[255:128]</span>, imm8<span class=\"hljs-selector-attr\">[5:4]</span>) <br>dst<span class=\"hljs-selector-attr\">[255:224]</span> := SELECT4(<span class=\"hljs-selector-tag\">b</span><span class=\"hljs-selector-attr\">[255:128]</span>, imm8<span class=\"hljs-selector-attr\">[7:6]</span>) <br>dst<span class=\"hljs-selector-attr\">[MAX:256]</span> := <span class=\"hljs-number\">0</span><br></code></pre></div></td></tr></table></figure>\n\n<p>ä¸ºäº†shuffle16ä½å€¼ï¼ŒAVX2æä¾›äº†_mm256_shufflelo_epi16å’Œ_mm256_shufflehi_epi16ã€‚ä¸_mm256_shuffle_psä¸€æ ·ï¼Œæ§åˆ¶å€¼è¢«åˆ†æˆå››å¯¹ä»å…«ä¸ªå…ƒç´ ä¸­é€‰æ‹©çš„ä½ã€‚ä½†æ˜¯å¯¹äº_mm256_shufflelo_epi16, 8ä¸ªå…ƒç´ æ˜¯ä»8ä¸ªä½çš„16ä½å€¼ä¸­å–å‡ºçš„ã€‚å¯¹äº_mm256_shufflehi_epi16, 8ä¸ªå…ƒç´ å–è‡ª8ä¸ªé«˜çš„16ä½å€¼ã€‚</p>\n<h2 id=\"8-Complex-Multiplication\"><a href=\"#8-Complex-Multiplication\" class=\"headerlink\" title=\"8.Complex Multiplication\"></a>8.Complex Multiplication</h2><p>åœ¨ä¿¡å·å¤„ç†åº”ç”¨ä¸­ï¼Œå¤æ•°ä¹˜æ³•æ˜¯ä¸€é¡¹å¿…é¡»åå¤æ‰§è¡Œçš„è€—æ—¶æ“ä½œã€‚æˆ‘ä¸ä¼šæ·±å…¥è®¨è®ºè¿™ä¸ªç†è®ºï¼Œä½†æ¯ä¸ªå¤æ•°éƒ½å¯ä»¥è¡¨ç¤ºä¸ºa + biï¼Œå…¶ä¸­aå’Œbæ˜¯æµ®ç‚¹å€¼ï¼Œiæ˜¯-1çš„å¹³æ–¹æ ¹ã€‚Aæ˜¯å®éƒ¨ï¼Œbæ˜¯è™šéƒ¨ã€‚å¦‚æœ(a + bi)å’Œ(c + di)ç›¸ä¹˜ï¼Œä¹˜ç§¯ç­‰äº(ac - bd) + (ad + bc)iã€‚</p>\n<p>å¤æ•°å¯ä»¥ä»¥äº¤é”™çš„æ–¹å¼å­˜å‚¨ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªå®æ•°éƒ¨åˆ†åé¢è·Ÿç€è™šæ•°éƒ¨åˆ†ã€‚å‡è®¾vec1æ˜¯ä¸€ä¸ª__m256dï¼Œå­˜å‚¨ä¸¤ä¸ªå¤æ•°(a + bi)å’Œ(x + yi)ï¼Œ vec2æ˜¯ä¸€ä¸ª__m256dï¼Œå­˜å‚¨(c + di)å’Œ(z + wi)ã€‚å›¾6è¯´æ˜äº†å¦‚ä½•å­˜å‚¨è¿™äº›å€¼ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œprodå‘é‡å­˜å‚¨äº†ä¸¤ä¸ªäº§ç‰©:(ac - bd) + (ad + bc)iå’Œ(xz - yw) + (xw + yz)iã€‚</p>\n<p>ã€å›¾ç‰‡ä¸¢å¤±ã€‘</p>\n<p><strong>Figure 6: Complex Multiplication Using Vectors</strong></p>\n<p>æˆ‘ä¸çŸ¥é“ç”¨AVX&#x2F;AVX2è®¡ç®—å¤æ‚ä¹˜ç§¯çš„æœ€å¿«æ–¹æ³•ã€‚ä½†æˆ‘æƒ³å‡ºäº†ä¸€ä¸ªæ–¹æ³•ï¼Œæ•ˆæœå¾ˆå¥½ã€‚å®ƒåŒ…æ‹¬äº”ä¸ªæ­¥éª¤:</p>\n<ol>\n<li>å°†vec1å’Œvec2ç›¸ä¹˜ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨vec3ä¸­ã€‚</li>\n<li>åˆ‡æ¢vec2çš„å®&#x2F;è™šå€¼ã€‚</li>\n<li>æ±‚vec2çš„è™šæ•°çš„è´Ÿæ•°ã€‚</li>\n<li>å°†vec1å’Œvec2ç›¸ä¹˜ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨vec4ä¸­ã€‚</li>\n<li>å¯¹vec3å’Œvec4è¿›è¡Œæ°´å¹³ç›¸å‡ï¼Œå¾—åˆ°vec1ä¸­çš„ç­”æ¡ˆã€‚</li>\n</ol>\n<p>complex_multi .cä¸­çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨AVX intrinsicæ‰§è¡Œæ­¤æ“ä½œ:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;immintrin.h&gt;</span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;stdio.h&gt;</span></span><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span> </span>&#123;<br><br>  __m256d vec1 = _mm256_setr_pd(<span class=\"hljs-number\">4.0</span>, <span class=\"hljs-number\">5.0</span>, <span class=\"hljs-number\">13.0</span>, <span class=\"hljs-number\">6.0</span>);<br>  __m256d vec2 = _mm256_setr_pd(<span class=\"hljs-number\">9.0</span>, <span class=\"hljs-number\">3.0</span>, <span class=\"hljs-number\">6.0</span>, <span class=\"hljs-number\">7.0</span>);<br>  __m256d neg = _mm256_setr_pd(<span class=\"hljs-number\">1.0</span>, <span class=\"hljs-number\">-1.0</span>, <span class=\"hljs-number\">1.0</span>, <span class=\"hljs-number\">-1.0</span>);<br>  <br>  <span class=\"hljs-comment\">/* Step 1: Multiply vec1 and vec2 */</span><br>  __m256d vec3 = _mm256_mul_pd(vec1, vec2);<br><br>  <span class=\"hljs-comment\">/* Step 2: Switch the real and imaginary elements of vec2 */</span><br>  vec2 = _mm256_permute_pd(vec2, <span class=\"hljs-number\">0x5</span>);<br>  <br>  <span class=\"hljs-comment\">/* Step 3: Negate the imaginary elements of vec2 */</span><br>  vec2 = _mm256_mul_pd(vec2, neg);  <br>  <br>  <span class=\"hljs-comment\">/* Step 4: Multiply vec1 and the modified vec2 */</span><br>  __m256d vec4 = _mm256_mul_pd(vec1, vec2);<br><br>  <span class=\"hljs-comment\">/* Horizontally subtract the elements in vec3 and vec4 */</span><br>  vec1 = _mm256_hsub_pd(vec3, vec4);<br>  <br>  <span class=\"hljs-comment\">/* Display the elements of the result vector */</span><br>  <span class=\"hljs-keyword\">double</span>* res = (<span class=\"hljs-keyword\">double</span>*)&amp;vec1;<br>  <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;%lf %lf %lf %lf\\n&quot;</span>, res[<span class=\"hljs-number\">0</span>], res[<span class=\"hljs-number\">1</span>], res[<span class=\"hljs-number\">2</span>], res[<span class=\"hljs-number\">3</span>]);<br>  <br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">21</span>.<span class=\"hljs-number\">000000</span> <span class=\"hljs-number\">57</span>.<span class=\"hljs-number\">000000</span> <span class=\"hljs-number\">36</span>.<span class=\"hljs-number\">000000</span> <span class=\"hljs-number\">127</span>.<span class=\"hljs-number\">000000</span><br></code></pre></div></td></tr></table></figure>\n\n<p>è¿™æ®µä»£ç ä½œç”¨äºåŒå‘é‡ï¼Œä½†æ˜¯å¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰©å±•è¯¥æ–¹æ³•ä»¥æ”¯æŒæµ®ç‚¹å‘é‡ã€‚</p>\n<h2 id=\"9-Points-of-Interest\"><a href=\"#9-Points-of-Interest\" class=\"headerlink\" title=\"9.Points of Interest\"></a>9.Points of Interest</h2><p>è®¸å¤šå¼€å‘äººå‘˜å¯èƒ½ä¼šé¿å…å­¦ä¹ AVX&#x2F;AVX2ï¼Œå¸Œæœ›ç¼–è¯‘å™¨èƒ½å¤Ÿæ‰§è¡Œè‡ªåŠ¨å‘é‡åŒ–ã€‚è‡ªåŠ¨å‘é‡åŒ–æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ï¼Œä½†æ˜¯å¦‚æœæ‚¨äº†è§£æœ¬è´¨ï¼Œå°±å¯ä»¥é‡æ–°å®‰æ’ç®—æ³•ä»¥æ›´å¥½åœ°åˆ©ç”¨SIMDå¤„ç†ã€‚é€šè¿‡æ’å…¥AVX&#x2F;AVX2 intrinsicï¼Œæˆ‘æå¤§åœ°æé«˜äº†ä¿¡å·å¤„ç†åº”ç”¨ç¨‹åºçš„å¤„ç†é€Ÿåº¦ã€‚</p>\n<h2 id=\"10-History\"><a href=\"#10-History\" class=\"headerlink\" title=\"10.History\"></a>10.History</h2><p>2&#x2F;20 - Fixed formatting and image links</p>\n<p>4&#x2F;2 - Fixed a couple typographical errors</p>\n<h2 id=\"11-License\"><a href=\"#11-License\" class=\"headerlink\" title=\"11.License\"></a>11.License</h2><p>This article, along with any associated source code and files, is licensed under <a href=\"http://www.codeproject.com/info/cpol10.aspx\">The Code Project Open License (CPOL)</a></p>\n<p>Written By</p>\n<p><strong><a href=\"https://www.codeproject.com/Members/mattscar\">Matt Scarpino</a></strong></p>\n<p><img src=\"/2023/03/10/avx006/US.gif\" alt=\"United States\"> United States</p>\n<p>Iâ€™ve been a programmer and engineer for over 20 years. Iâ€™m a certified Azure Developer Associate and an Azure IoT Developer Specialist.</p>\n",
            "tags": [
                "AVX",
                "AVX2"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/09/cuda015/",
            "url": "https://xingyuanjie.top/2023/03/09/cuda015/",
            "title": "CUDAä½¿ç”¨äºŒç»´ç½‘æ ¼å’ŒäºŒä½å—å¯¹çŸ©é˜µæ±‚å’Œ",
            "date_published": "2023-03-09T04:34:51.000Z",
            "content_html": "<h2 id=\"CUDAä½¿ç”¨äºŒç»´ç½‘æ ¼å’ŒäºŒä½å—å¯¹çŸ©é˜µæ±‚å’Œ\"><a href=\"#CUDAä½¿ç”¨äºŒç»´ç½‘æ ¼å’ŒäºŒä½å—å¯¹çŸ©é˜µæ±‚å’Œ\" class=\"headerlink\" title=\"CUDAä½¿ç”¨äºŒç»´ç½‘æ ¼å’ŒäºŒä½å—å¯¹çŸ©é˜µæ±‚å’Œ\"></a>CUDAä½¿ç”¨äºŒç»´ç½‘æ ¼å’ŒäºŒä½å—å¯¹çŸ©é˜µæ±‚å’Œ</h2><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªäºŒç»´ç½‘æ ¼å’ŒäºŒä½å—æ¥ç¼–å†™ä¸€ä¸ªçŸ©é˜µåŠ æ³•æ ¸å‡½æ•°ã€‚é¦–å…ˆï¼Œåº”è¯¥ç¼–å†™ä¸€ä¸ªæ ¡éªŒä¸»å‡½æ•°ä»¥éªŒè¯çŸ©é˜µåŠ æ³•æ ¸å‡½æ•°æ˜¯å¦èƒ½å¾—å‡ºæ­£ç¡®çš„ç»“æœï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">sumMatrixOnhost</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> *A, <span class=\"hljs-keyword\">float</span> *B, <span class=\"hljs-keyword\">float</span> *C, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">int</span> nx, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">int</span> ny)</span></span>&#123;<br>    <span class=\"hljs-keyword\">float</span> *ia = A;<br>    <span class=\"hljs-keyword\">float</span> *ib = B;<br>    <span class=\"hljs-keyword\">float</span> *ic = C;<br>    <br>    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> iy=<span class=\"hljs-number\">0</span>;iy&lt;ny;iy++)&#123;<br>        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> ix=<span class=\"hljs-number\">0</span>;ix&lt;nx;ix++)&#123;<br>            ic[ix]=ia[ix]+ib[ix];<br>        &#125;<br>        ia += nx;<br>        ib += nx;<br>        ic += nx;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ ¸å‡½æ•°ï¼Œç›®çš„æ˜¯é‡‡ç”¨ä¸€ä¸ªäºŒç»´çº¿ç¨‹å—æ¥è¿›è¡ŒçŸ©é˜µæ±‚å’Œï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\">__global__ <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">sumMatrixOnGPU2D</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> *MatA, <span class=\"hljs-keyword\">float</span> *MatB, <span class=\"hljs-keyword\">float</span> *MatC, <span class=\"hljs-keyword\">int</span> nx, <span class=\"hljs-keyword\">int</span> ny)</span></span>&#123;<br>    <span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> ix = threadIdx.x + blockIdx.x * blockDim.x;<br>    <span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> iy = threadIdx.y + blockIdx.y * blockDim.y;<br>    ubsigned <span class=\"hljs-keyword\">int</span> idx = iy*nx + ix;<br>    <br>    <span class=\"hljs-keyword\">if</span>(ix &lt; nx &amp;&amp; iy &lt;ny)<br>        MatC[idx] = MatA[idx] + MatB[idx];<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>è¿™ä¸ªæ ¸å‡½æ•°çš„å…³é”®æ­¥éª¤æ˜¯å°†æ¯ä¸ªçº¿ç¨‹ä»å®ƒçš„çº¿ç¨‹ç´¢å¼•æ˜ å°„åˆ°å…¨å±€çº¿æ€§å†…å­˜ç´¢å¼•ä¸­ï¼Œå¦‚å›¾2-12æ‰€ç¤ºã€‚</p>\n<p>æ¥ä¸‹æ¥ï¼Œæ¯ä¸ªç»´åº¦ä¸‹çš„çŸ©é˜µå¤§å°å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹æ³•è®¾ç½®ä¸º16384ä¸ªå…ƒç´ ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-keyword\">int</span> nx = <span class=\"hljs-number\">1</span>&lt;&lt;<span class=\"hljs-number\">14</span>;<br><span class=\"hljs-keyword\">int</span> ny = <span class=\"hljs-number\">1</span>&lt;&lt;<span class=\"hljs-number\">14</span>;<br></code></pre></div></td></tr></table></figure>\n\n<p>ç„¶åï¼Œä½¿ç”¨ä¸€ä¸ªäºŒç»´ç½‘æ ¼å’ŒäºŒç»´å—æŒ‰å¦‚ä¸‹æ–¹æ³•è®¾ç½®æ ¸å‡½æ•°çš„æ‰§è¡Œé…ç½®ï¼š</p>\n<p><img src=\"/2023/03/09/cuda015/image-20230309125059653.png\" alt=\"image-20230309125059653\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-keyword\">int</span> dimx = <span class=\"hljs-number\">32</span>;<br><span class=\"hljs-keyword\">int</span> dimy = <span class=\"hljs-number\">32</span>;<br><span class=\"hljs-function\">dim3 <span class=\"hljs-title\">block</span><span class=\"hljs-params\">(dimx, dimy)</span></span>;<br><span class=\"hljs-function\">dim3 <span class=\"hljs-title\">grid</span><span class=\"hljs-params\">((nx + block.x - <span class=\"hljs-number\">1</span>)/block.x, (ny + block.y - <span class=\"hljs-number\">1</span>)/block.y)</span></span>;<br></code></pre></div></td></tr></table></figure>\n\n<p>æŠŠæ‰€æœ‰çš„ä»£ç æ•´åˆåˆ°åä¸ºsumMatrixOnGPU-2D-grid-2D-block.cuçš„æ–‡ä»¶ä¸­ã€‚ä¸»å‡½æ•°ä»£ç å¦‚ä»£ç æ¸…å•2-7æ‰€ç¤ºã€‚</p>\n<p>ä»£ç æ¸…å•2-7 ä½¿ç”¨ä¸€ä¸ªäºŒç»´ç½‘æ ¼å’ŒäºŒç»´å—çš„çŸ©é˜µåŠ æ³•(sumMatrixOnGPU-2D-grid-2D-block.cu)</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> argc, <span class=\"hljs-keyword\">char</span> **argv)</span></span>&#123;<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;%s Starting...\\n&quot;</span>,zrgv[<span class=\"hljs-number\">0</span>]);<br>    <br>    <span class=\"hljs-comment\">//set up device</span><br>    <span class=\"hljs-keyword\">int</span> dev = <span class=\"hljs-number\">0</span>;<br>    cudaDeviceProp deviceProp;<br>    <span class=\"hljs-built_in\">CHECK</span>(<span class=\"hljs-built_in\">cudaGetDeviceProperties</span>(&amp;deviceProp, dev));<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;Using Device %d: %s\\n&quot;</span>,dev, deviceProp.name);<br>    <span class=\"hljs-built_in\">CHECK</span>(<span class=\"hljs-built_in\">cudaSetDevice</span>(dev));<br>    <br>    <span class=\"hljs-comment\">//set up data size of matrix</span><br>    <span class=\"hljs-keyword\">int</span> nx = <span class=\"hljs-number\">1</span>&lt;&lt;<span class=\"hljs-number\">14</span>;<br>    <span class=\"hljs-keyword\">int</span> ny = <span class=\"hljs-number\">1</span>&lt;&lt;<span class=\"hljs-number\">14</span>;<br>    <br>    <span class=\"hljs-keyword\">int</span> nxy = nx*ny;<br>    <span class=\"hljs-keyword\">int</span> nBytes = nxy *<span class=\"hljs-built_in\"><span class=\"hljs-keyword\">sizeof</span></span>(<span class=\"hljs-keyword\">float</span>);<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;Matrix size: nx %d ny %d\\n&quot;</span>,nx,ny);<br>    <br>    <span class=\"hljs-comment\">//malloc host memory</span><br>    <span class=\"hljs-keyword\">float</span> *h_A, *h_B, *hostRef, *gpuRef;<br>    h_A = (<span class=\"hljs-keyword\">float</span> *)<span class=\"hljs-built_in\">malloc</span>(nBytes);<br>    h_B = (<span class=\"hljs-keyword\">float</span> *)<span class=\"hljs-built_in\">malloc</span>(nBytes);<br>    hostRef = (<span class=\"hljs-keyword\">float</span> *)<span class=\"hljs-built_in\">malloc</span>(nBytes);<br>    gpuRef = (<span class=\"hljs-keyword\">float</span> *)<span class=\"hljs-built_in\">malloc</span>(nBytes);<br>    <br>    <span class=\"hljs-comment\">//initialize data at host side</span><br>    <span class=\"hljs-keyword\">double</span> iStart = <span class=\"hljs-built_in\">cpuSecond</span>();<br>    <span class=\"hljs-built_in\">initialData</span> (h_A, nxy);<br>    <span class=\"hljs-built_in\">initialData</span> (h_B, nxy);<br>    <span class=\"hljs-keyword\">double</span> iElaps = <span class=\"hljs-built_in\">cpuSecond</span>() - iStart;<br>    <br>    <span class=\"hljs-built_in\">memset</span>(hostRef, <span class=\"hljs-number\">0</span>, nBytes);<br>    <span class=\"hljs-built_in\">memset</span>(gpuRef, <span class=\"hljs-number\">0</span>, nBytes);<br>    <br>    <span class=\"hljs-comment\">//add matrix at host side for result checks</span><br>    iStart = <span class=\"hljs-built_in\">cpuSecond</span>();<br>    <span class=\"hljs-built_in\">sumMatrixOnHost</span> (h_A, h_B, hostRef, nx,ny);<br>    iElaps = <span class=\"hljs-built_in\">cpuSecond</span>() - iStart;<br>    <br>    <span class=\"hljs-comment\">//malloc device global memory</span><br>    <span class=\"hljs-keyword\">float</span> *d_MatA, *d_MatB, *d_MatC;<br>    <span class=\"hljs-built_in\">cudaMalloc</span>((<span class=\"hljs-keyword\">void</span> **)&amp;d_MatA,nBytes);<br>    <span class=\"hljs-built_in\">cudaMalloc</span>((<span class=\"hljs-keyword\">void</span> **)&amp;d_MatB,nBytes);<br>    <span class=\"hljs-built_in\">cudaMalloc</span>((<span class=\"hljs-keyword\">void</span> **)&amp;d_MatC,nBytes);<br>    <br>    <span class=\"hljs-comment\">//transfer data from host to device</span><br>    <span class=\"hljs-built_in\">cudaMemcpy</span>(d_MatA, h_A, nBytes, cudaMemcpyHostToDevice);<br>    <span class=\"hljs-built_in\">cudaMemcpy</span>(d_MatB, h_B, nBytes, cudaMemcpyHostToDevice);<br>    <br>    <span class=\"hljs-comment\">//invoke kernel at host side</span><br>    <span class=\"hljs-keyword\">int</span> dimx = <span class=\"hljs-number\">32</span>;<br>    <span class=\"hljs-keyword\">int</span> dimy = <span class=\"hljs-number\">32</span>;<br>    <span class=\"hljs-function\">dim3 <span class=\"hljs-title\">block</span><span class=\"hljs-params\">(dimx,dimy)</span></span>;<br>    <span class=\"hljs-function\">dim3 <span class=\"hljs-title\">grid</span><span class=\"hljs-params\">((nx+block.x<span class=\"hljs-number\">-1</span>)/block.x,(ny+block.y<span class=\"hljs-number\">-1</span>)/block.y)</span></span>;<br>    <br>    iStart = <span class=\"hljs-built_in\">cpuSecond</span>();<br>    sumMatrixOnGPU2D&lt;&lt;&lt;grid,block&gt;&gt;&gt;(d_MatA, d_MatB, d_MatC, nx,ny);<br>    <span class=\"hljs-built_in\">cudaDeviceSynchronize</span>();<br>    iElaps = <span class=\"hljs-built_in\">cpuSecond</span>() - iStart;<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;sumMatrixOnGPU2D&lt;&lt;&lt;(%d,%d),(%d,%d)&gt;&gt;&gt; elapsed %f sec\\n&quot;</span>,grid.x, grid.y, block.x,block.y,iElaps);<br>    <br>    <span class=\"hljs-comment\">//copy kernel result back to host side</span><br>    <span class=\"hljs-built_in\">cudaMemcpy</span>(gpuRef, d_MatC, nBytes, cudaMemcpyDeviceToHost);<br>    <br>    <span class=\"hljs-comment\">//check device results</span><br>    <span class=\"hljs-built_in\">checkResult</span>(hostRef, gpuRef,nxy);<br>    <br>    <span class=\"hljs-comment\">//free device global memory</span><br>    <span class=\"hljs-built_in\">cudaFree</span>(d_MatA);<br>    <span class=\"hljs-built_in\">cudaFree</span>(d_MatB);<br>    <span class=\"hljs-built_in\">cudaFree</span>(d_MatC);<br>    <br>    <span class=\"hljs-comment\">//free host memory</span><br>    <span class=\"hljs-built_in\">free</span>(h_A);<br>    <span class=\"hljs-built_in\">free</span>(h_B);<br>    <span class=\"hljs-built_in\">free</span>(hostRef);<br>    <span class=\"hljs-built_in\">free</span>(gpuRef);<br>    <br>    <span class=\"hljs-comment\">//reset device</span><br>    <span class=\"hljs-built_in\">cudaDeviceReset</span>();<br>    <br>    <span class=\"hljs-keyword\">return</span> (<span class=\"hljs-number\">0</span>);<br>&#125; <br></code></pre></div></td></tr></table></figure>\n\n<p>ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘å¹¶è¿è¡Œè¯¥ä»£ç ï¼š</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">nvcc -arch=sm_20 sumMatrixOnGPU-2D-grid-2D-block.cu -o matrix2D<br>./matrix2D<br></code></pre></div></td></tr></table></figure>\n\n<p>åœ¨Tesla M2070ä¸Šè¿è¡Œçš„ç»“æœï¼š</p>\n<p><img src=\"/2023/03/09/cuda015/image-20230309224513603.png\" alt=\"image-20230309224513603\"></p>\n<p>æ¥ä¸‹æ¥ï¼Œè°ƒæ•´å—çš„å°ºå¯¸ä¸º32Ã—16å¹¶é‡æ–°ç¼–è¯‘å’Œè¿è¡Œè¯¥ä»£ç ã€‚æ ¸å‡½æ•°çš„æ‰§è¡Œé€Ÿåº¦å‡ ä¹å¿«äº†ä¸¤å€ï¼š</p>\n<p><img src=\"/2023/03/09/cuda015/image-20230309224626772.png\" alt=\"image-20230309224626772\"></p>\n<p>ä½ å¯èƒ½å¥½å¥‡ä¸ºä»€ä¹ˆåªæ˜¯æ”¹å˜äº†æ‰§è¡Œé…ç½®ï¼Œå†…æ ¸æ€§èƒ½å°±å‡ ä¹ç¿»äº†ä¸€å€ã€‚ç›´è§‚åœ°è¯´ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—è¿™æ˜¯å› ä¸ºç¬¬äºŒæ¬¡é…ç½®çš„çº¿ç¨‹å—æ•°æ˜¯ç¬¬ä¸€æ¬¡é…ç½®å—æ•°çš„ä¸¤å€ï¼Œæ‰€ä»¥å¹¶è¡Œæ€§ä¹Ÿæ˜¯ä¸¤å€ã€‚ä½ çš„ç›´è§‰æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯ï¼Œå¦‚æœè¿›ä¸€æ­¥å‡å°å—çš„å¤§å°å˜ä¸º16Ã—16ï¼Œç›¸æ¯”ç¬¬ä¸€æ¬¡é…ç½®ä½ å·²ç»å°†å—çš„æ•°é‡ç¿»äº†å››å€ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™ç§é…ç½®æ¯”ç¬¬ä¸€ä¸ªç»“æœå¥½ä½†æ˜¯ä¸å¦‚ç¬¬äºŒä¸ªã€‚</p>\n<p><img src=\"/2023/03/09/cuda015/image-20230309224912499.png\" alt=\"image-20230309224912499\"></p>\n<p>è¡¨2-3æ€»ç»“äº†ä¸åŒæ‰§è¡Œé…ç½®çš„æ€§èƒ½ã€‚ç»“æœæ˜¾ç¤ºï¼Œå¢åŠ å—çš„æ•°é‡ä¸ä¸€å®šèƒ½æå‡å†…æ ¸æ€§èƒ½ã€‚</p>\n<p><img src=\"/2023/03/09/cuda015/image-20230309225004531.png\" alt=\"image-20230309225004531\"></p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p>CUDA Cç¼–ç¨‹æƒå¨æŒ‡å— ç¨‹æ¶¦ä¼Ÿï¼ŒMax Grossman(ç¾)ï¼ŒTy Mckercher </p>\n",
            "tags": [
                "CUDA"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/09/cuda014/",
            "url": "https://xingyuanjie.top/2023/03/09/cuda014/",
            "title": "CUDAä½¿ç”¨å—å’Œçº¿ç¨‹å»ºç«‹çŸ©é˜µç´¢å¼•",
            "date_published": "2023-03-09T03:32:36.000Z",
            "content_html": "<h2 id=\"CUDAä½¿ç”¨å—å’Œçº¿ç¨‹å»ºç«‹çŸ©é˜µç´¢å¼•\"><a href=\"#CUDAä½¿ç”¨å—å’Œçº¿ç¨‹å»ºç«‹çŸ©é˜µç´¢å¼•\" class=\"headerlink\" title=\"CUDAä½¿ç”¨å—å’Œçº¿ç¨‹å»ºç«‹çŸ©é˜µç´¢å¼•\"></a>CUDAä½¿ç”¨å—å’Œçº¿ç¨‹å»ºç«‹çŸ©é˜µç´¢å¼•</h2><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªçŸ©é˜µç”¨è¡Œä¼˜å…ˆçš„æ–¹æ³•åœ¨å…¨å±€å†…å­˜ä¸­è¿›è¡Œçº¿æ€§å­˜å‚¨ã€‚å›¾2-9æ‰€ç¤ºçš„æ˜¯ä¸€ä¸ª8Ã—6çŸ©é˜µçš„å°ä¾‹å­ã€‚</p>\n<p>åœ¨ä¸€ä¸ªçŸ©é˜µåŠ æ³•æ ¸å‡½æ•°ä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹é€šå¸¸è¢«åˆ†é…ä¸€ä¸ªæ•°æ®å…ƒç´ æ¥å¤„ç†ã€‚é¦–å…ˆè¦å®Œæˆçš„ä»»åŠ¡æ˜¯ä½¿ç”¨å—å’Œçº¿ç¨‹ç´¢å¼•ä»å…¨å±€å†…å­˜ä¸­è®¿é—®æŒ‡å®šçš„æ•°æ®ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹ä¸€ä¸ªäºŒç»´ç¤ºä¾‹æ¥è¯´ï¼Œéœ€è¦ç®¡ç†3ç§ç´¢å¼•ã€‚</p>\n<p><img src=\"/2023/03/09/cuda014/image-20230309113733674.png\" alt=\"image-20230309113733674\"></p>\n<ul>\n<li>çº¿ç¨‹å’Œå—ç´¢å¼•</li>\n<li>çŸ©é˜µä¸­ç»™å®šç‚¹çš„åæ ‡</li>\n<li>å…¨å±€çº¿æ€§å†…å­˜ä¸­çš„åç§»é‡</li>\n</ul>\n<p>å¯¹äºä¸€ä¸ªç»™å®šçš„çº¿ç¨‹ï¼Œé¦–å…ˆå¯ä»¥é€šè¿‡æŠŠçº¿ç¨‹å’Œå—ç´¢å¼•æ˜ å°„åˆ°çŸ©é˜µåæ ‡ä¸Šæ¥è·å–çº¿ç¨‹å—å’Œçº¿ç¨‹ç´¢å¼•çš„å…¨å±€å†…å­˜åç§»é‡ï¼Œç„¶åå°†è¿™äº›çŸ©é˜µåæ ‡æ˜ å°„åˆ°å…¨å±€å†…å­˜çš„å­˜å‚¨å•å…ƒä¸­ã€‚</p>\n<p>ç¬¬ä¸€æ­¥ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å…¬å¼æŠŠçº¿ç¨‹å’Œå—ç´¢å¼•æ˜ å°„åˆ°çŸ©é˜µåæ ‡ä¸Šï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">ix = threadIdx.x + blockIdx.x * blockDim.x;<br>iy = threadIdx.y + blockIdx.y * blockDim.y;<br></code></pre></div></td></tr></table></figure>\n\n<p>ç¬¬äºŒæ­¥ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å…¬å¼æŠŠçŸ©é˜µåæ ‡æ˜ å°„åˆ°å…¨å±€å†…å­˜ä¸­çš„ç´¢å¼•&#x2F;å­˜å‚¨å•å…ƒä¸Š:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">idx = iy * nx + ix<br></code></pre></div></td></tr></table></figure>\n\n<p>å›¾2-10è¯´æ˜äº†å—å’Œçº¿ç¨‹ç´¢å¼•ï¼ŒçŸ©é˜µåæ ‡ä»¥åŠçº¿æ€§å…¨å±€å†…å­˜ç´¢å¼•ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚</p>\n<p><img src=\"/2023/03/09/cuda014/image-20230309114815497.png\" alt=\"image-20230309114815497\"></p>\n<p>printThreadInfoå‡½æ•°è¢«ç”¨äºè¾“å‡ºå…³äºæ¯ä¸ªçº¿ç¨‹çš„ä»¥ä¸‹ä¿¡æ¯ï¼š</p>\n<ul>\n<li>çº¿ç¨‹ç´¢å¼•</li>\n<li>å—ç´¢å¼•</li>\n<li>çŸ©é˜µåæ ‡</li>\n<li>çº¿æ€§å…¨å±€å†…å­˜åç§»é‡</li>\n<li>ç›¸åº”å…ƒç´ çš„å€¼</li>\n</ul>\n<p>ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘å¹¶è¿è¡Œè¯¥ç¨‹åºï¼š</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">nvcc -arch=sm_20 checkThreadIndex.cu -o checkIndex<br>./checkIndex<br></code></pre></div></td></tr></table></figure>\n\n<p>å¯¹äºæ¯ä¸ªçº¿ç¨‹ï¼Œä½ å¯ä»¥è·å–ä»¥ä¸‹ä¿¡æ¯ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-built_in\">thread_id</span>(<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">1</span>)\t<span class=\"hljs-built_in\">block_id</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">0</span>)\t<span class=\"hljs-built_in\">coordinate</span>(<span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">1</span>)\tglobal index <span class=\"hljs-number\">14</span> ival <span class=\"hljs-number\">14</span><br></code></pre></div></td></tr></table></figure>\n\n<p>å›¾2-11è¯´æ˜äº†è¿™ä¸‰é¡¹ç´¢å¼•ä¹‹é—´çš„å…³ç³»ã€‚</p>\n<p><img src=\"/2023/03/09/cuda014/image-20230309115229368.png\" alt=\"image-20230309115229368\"></p>\n<p>ä»£ç æ¸…å•2-6 æ£€æŸ¥å—å’Œçº¿ç¨‹ç´¢å¼•ï¼ˆcheckTå’ŒreadIndex.cuï¼‰</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;cuda_runtime.h&gt;</span></span><br><span class=\"hljs-meta\">#inclde <span class=\"hljs-meta-string\">&lt;stdio.h&gt;</span></span><br><br><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">define</span> CHECK(call)</span><br>&#123;<br>    <span class=\"hljs-keyword\">const</span> cudaError_t error = call;<br>    <span class=\"hljs-keyword\">if</span>(error != cudaSuccess)<br>    &#123;<br>        <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;Error: %s:%d, &quot;</span>,__FILE__, __LINE__);<br>        <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;code:%d, reason: %s\\n&quot;</span>,error, <span class=\"hljs-built_in\">cudaGetErrorString</span>(error));<br>        <span class=\"hljs-built_in\">exit</span>(<span class=\"hljs-number\">-10</span>*error);<br>    &#125;<br>&#125;<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">initialInt</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> *p, <span class=\"hljs-keyword\">int</span> size)</span></span>&#123;<br>    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i=<span class=\"hljs-number\">0</span>;i&lt;size;i++)&#123;<br>        ip[i] = i;<br>    &#125;<br>&#125;<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">printMateix</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> *C,<span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">int</span> nx, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">int</span> ny)</span></span>&#123;<br>    <span class=\"hljs-keyword\">int</span> *ic = C;<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;\\nMatrix:\t(%d.%d)\\n&quot;</span>.nx,ny);<br>    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> iy=<span class=\"hljs-number\">0</span>;iy&lt;ny;iy++)&#123;<br>        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> ix=<span class=\"hljs-number\">0</span>; ix&lt;nx;ix++)&#123;<br>            <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;%3d&quot;</span>,ic[ix]);<br>        &#125;<br>        ic += nx;<br>        <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;\\n&quot;</span>);<br>    &#125;<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;\\n&quot;</span>);<br>&#125;<br><br><span class=\"hljs-function\">__global__ <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">printThreadIndex</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> *A, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">int</span> nx, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">int</span> ny)</span></span>&#123;<br>    <span class=\"hljs-keyword\">int</span> ix = threadIdx.x + blockIdx.x * blockDim.x;<br>    <span class=\"hljs-keyword\">int</span> iy = threadIdx.y + blockIdx.y * blockDim.y;<br>    <span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> idx = iy*nx + ix;<br>    <br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;thread_id (%d,%d) block_id (%d,%d) coordinate (%d,%d) global index %2d ival %2d\\n&quot;</span>, threadIdx.x, threadIdx.y, blockIdx.x,blockIdx.y,ix,iy,idx,A[idx]);<br>&#125;<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> argc,<span class=\"hljs-keyword\">char</span> **argv)</span></span>&#123;<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;%s Starting...\\n&quot;</span>,argv[<span class=\"hljs-number\">0</span>]);<br>    <br>    <span class=\"hljs-comment\">//get device information</span><br>    <span class=\"hljs-keyword\">int</span> dev = <span class=\"hljs-number\">0</span>;<br>    cudaDeviceProp deviceProp;<br>    <span class=\"hljs-built_in\">CHECK</span>(<span class=\"hljs-built_in\">cudaGetDeviceProperties</span>(&amp;deviceProp, dev));<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;Using Device %d: %s\\n&quot;</span>, dev, deviceProp.name);<br>    <br>    <span class=\"hljs-comment\">//set matrix dimension</span><br>    <span class=\"hljs-keyword\">int</span> nx = <span class=\"hljs-number\">8</span>;<br>    <span class=\"hljs-keyword\">int</span> ny = <span class=\"hljs-number\">6</span>;<br>    <span class=\"hljs-keyword\">int</span> nxy = nx*ny;<br>    <span class=\"hljs-keyword\">int</span> nBytes = nxy * <span class=\"hljs-built_in\"><span class=\"hljs-keyword\">sizeof</span></span>(<span class=\"hljs-keyword\">float</span>);<br>    <br>    <span class=\"hljs-comment\">//malloc host memory</span><br>    <span class=\"hljs-keyword\">int</span> *h_A;<br>    h_A = (<span class=\"hljs-keyword\">int</span> *)<span class=\"hljs-built_in\">malloc</span>(nBytes);<br>    <br>    <span class=\"hljs-comment\">//initialize host matrix with interger</span><br>    <span class=\"hljs-built_in\">initialInt</span>(h_A, nxy);<br>    <span class=\"hljs-built_in\">printMatrix</span>(h_A, nx, ny);<br>    <br>    <span class=\"hljs-comment\">//malloc device memory</span><br>    <span class=\"hljs-keyword\">int</span> *d_MatA;<br>    <span class=\"hljs-built_in\">cudaMalloc</span>((<span class=\"hljs-keyword\">void</span>**)&amp;d_MatA, nBytes);<br>    <br>    <span class=\"hljs-comment\">//transfer data from host to device</span><br>    <span class=\"hljs-built_in\">cudaMemcpy</span>(d_MatA, h_A, nBytes, cudaMemcpyHostToDevice);<br>    <br>    <span class=\"hljs-comment\">//set up execution configuration</span><br>    <span class=\"hljs-function\">dim3 <span class=\"hljs-title\">block</span><span class=\"hljs-params\">(<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">2</span>)</span></span>;<br>    <span class=\"hljs-function\">dim3 <span class=\"hljs-title\">grid</span><span class=\"hljs-params\">((nx+block.x<span class=\"hljs-number\">-1</span>)/block.x,(ny+block.y<span class=\"hljs-number\">-1</span>)/block.y)</span></span>;<br>    <br>    <span class=\"hljs-comment\">//invoke the kernel</span><br>    printThreadIndex&lt;&lt;&lt;grid,block&gt;&gt;&gt;(d_MatA,nx,ny);<br>    <span class=\"hljs-built_in\">cudaDeviceSynchronize</span>();<br>    <br>    <span class=\"hljs-comment\">//free host and device memory</span><br>    <span class=\"hljs-built_in\">cudaFree</span>(d_MatA);<br>    <span class=\"hljs-built_in\">free</span>(h_A);<br>    <br>    <span class=\"hljs-comment\">//reset device</span><br>    <span class=\"hljs-built_in\">cudaDeviceReset</span>();<br>    <br>    <span class=\"hljs-keyword\">return</span>(<span class=\"hljs-number\">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p>CUDA Cç¼–ç¨‹æƒå¨æŒ‡å— ç¨‹æ¶¦ä¼Ÿï¼ŒMax Grossman(ç¾)ï¼ŒTy Mckercher </p>\n",
            "tags": [
                "CUDA"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/08/cuda013/",
            "url": "https://xingyuanjie.top/2023/03/08/cuda013/",
            "title": "CUDAç»„ç»‡å¹¶è¡Œç¼–ç¨‹",
            "date_published": "2023-03-08T14:13:01.000Z",
            "content_html": "<h2 id=\"ç»„ç»‡å¹¶è¡Œç¼–ç¨‹\"><a href=\"#ç»„ç»‡å¹¶è¡Œç¼–ç¨‹\" class=\"headerlink\" title=\"ç»„ç»‡å¹¶è¡Œç¼–ç¨‹\"></a>ç»„ç»‡å¹¶è¡Œç¼–ç¨‹</h2><p>ä»å‰é¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä½¿ç”¨äº†åˆé€‚çš„ç½‘æ ¼å’Œå—å¤§å°æ¥æ­£ç¡®åœ°ç»„ç»‡çº¿ç¨‹ï¼Œé‚£ä¹ˆå¯ä»¥å¯¹å†…æ ¸æ€§èƒ½äº§ç”Ÿå¾ˆå¤§çš„å½±å“ã€‚åœ¨å‘é‡åŠ æ³•çš„ä¾‹å­ä¸­ï¼Œä¸ºäº†å®ç°æœ€ä½³æ€§èƒ½æˆ‘ä»¬è°ƒæ•´äº†å—çš„å¤§å°ï¼Œå¹¶åŸºäºå—å¤§å°å’Œå‘é‡æ•°æ®å¤§å°è®¡ç®—å‡ºäº†ç½‘æ ¼å¤§å°ã€‚</p>\n<p>ç°åœ¨é€šè¿‡ä¸€ä¸ªçŸ©é˜µåŠ æ³•çš„ä¾‹å­è¯´æ˜è¿™ä¸€ç‚¹ã€‚å¯¹äºçŸ©é˜µè¿ç®—ï¼Œä¼ ç»Ÿçš„æ–¹æ³•æ˜¯åœ¨å†…æ ¸ä¸­ä½¿ç”¨ä¸€ä¸ªåŒ…å«äºŒç»´ç½‘æ ¼ä¸äºŒä½å—çš„å¸ƒå±€æ¥ç»„ç»‡çº¿ç¨‹ã€‚ä½†æ˜¯ï¼Œè¿™ç§ä¼ ç»Ÿçš„æ–¹æ³•æ— æ³•è·å¾—æœ€ä½³æ€§èƒ½ã€‚åœ¨çŸ©é˜µåŠ æ³•ä¸­ä½¿ç”¨ä»¥ä¸‹å¸ƒå±€å°†æœ‰åŠ©äºäº†è§£æ›´å¤šå…³äºç½‘æ ¼å’Œå—çš„å¯å‘æ€§çš„ç”¨æ³•ï¼š</p>\n<ol>\n<li>æœ‰äºŒç»´çº¿ç¨‹å—æ„æˆçš„äºŒç»´ç½‘æ ¼</li>\n<li>ç”±ä¸€ç»´çº¿ç¨‹å—æ„æˆçš„ä¸€ç»´ç½‘æ ¼</li>\n<li>ç”±ä¸€ç»´çº¿ç¨‹å—æ„æˆçš„äºŒç»´ç½‘æ ¼</li>\n</ol>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p>CUDA Cç¼–ç¨‹æƒå¨æŒ‡å— ç¨‹æ¶¦ä¼Ÿï¼ŒMax Grossman(ç¾)ï¼ŒTy Mckercher </p>\n",
            "tags": [
                "CUDA"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/07/CUDA012/",
            "url": "https://xingyuanjie.top/2023/03/07/CUDA012/",
            "title": "CUDAç»™æ ¸å‡½æ•°è®¡æ—¶",
            "date_published": "2023-03-07T01:53:34.000Z",
            "content_html": "<h2 id=\"CUDAç»™æ ¸å‡½æ•°è®¡æ—¶\"><a href=\"#CUDAç»™æ ¸å‡½æ•°è®¡æ—¶\" class=\"headerlink\" title=\"CUDAç»™æ ¸å‡½æ•°è®¡æ—¶\"></a>CUDAç»™æ ¸å‡½æ•°è®¡æ—¶</h2><p>åœ¨å†…æ ¸çš„æ€§èƒ½è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œäº†è§£æ ¸å‡½æ•°çš„æ‰§è¡Œéœ€è¦å¤šé•¿æ—¶é—´æ˜¯å¾ˆæœ‰å¸®åŠ©å¹¶ä¸”ååˆ†å…³é”®çš„ã€‚è¡¡é‡æ ¸å‡½æ•°æ€§èƒ½çš„æ–¹æ³•æœ‰å¾ˆå¤šã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯åœ¨ä¸»æœºç«¯ä½¿ç”¨ä¸€ä¸ªCPUæˆ–GPUè®¡æ—¶å™¨æ¥è®¡ç®—å†…æ ¸çš„æ‰§è¡Œæ—¶é—´ã€‚åœ¨æœ¬èŠ‚ï¼Œä½ éœ€è¦è®¾ç½®ä¸€ä¸ªCPUè®¡æ—¶å™¨ï¼Œå¹¶ä½¿ç”¨NVIDIAåˆ†æå·¥å…·æ¥è®¡ç®—æ‰§è¡Œæ—¶é—´ã€‚</p>\n<h3 id=\"ç”¨CPUè®¡æ—¶å™¨è®¡æ—¶\"><a href=\"#ç”¨CPUè®¡æ—¶å™¨è®¡æ—¶\" class=\"headerlink\" title=\"ç”¨CPUè®¡æ—¶å™¨è®¡æ—¶\"></a>ç”¨CPUè®¡æ—¶å™¨è®¡æ—¶</h3><p>å¯ä»¥ä½¿ç”¨gettimeofdayç³»ç»Ÿè°ƒç”¨æ¥åˆ›å»ºä¸€ä¸ªCPUè®¡æ—¶å™¨ï¼Œä»¥è·å–ç³»ç»Ÿçš„æ—¶é’Ÿæ—¶é—´ï¼Œå®ƒå°†è¿”å›è‡ª1970å¹´1æœˆ1æ—¥é›¶ç‚¹ä»¥æ¥ï¼Œåˆ°ç°åœ¨çš„ç§’æ•°ã€‚ç¨‹åºä¸­éœ€è¦æ·»åŠ sys&#x2F;time.hå¤´æ–‡ä»¶ï¼Œå¦‚ä»£ç æ¸…å•2-5æ‰€ç¤ºã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">double</span> <span class=\"hljs-title\">cpuSecond</span><span class=\"hljs-params\">()</span></span><br><span class=\"hljs-function\"></span>&#123;<br>    <span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">timeval</span> <span class=\"hljs-title\">tp</span>;</span><br>    <span class=\"hljs-built_in\">gettimeofday</span>(&amp;tp,<span class=\"hljs-literal\">NULL</span>);<br>    <br>    <span class=\"hljs-keyword\">return</span> ((<span class=\"hljs-keyword\">double</span>)tp.tv_sec + (<span class=\"hljs-keyword\">double</span>)tp.tv_usec*<span class=\"hljs-number\">1.e-6</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>ä½ å¯ä»¥ç”¨cpuSecondå‡½æ•°æ¥æµ‹è¯•ä½ çš„æ ¸å‡½æ•°ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-keyword\">double</span> iStart = <span class=\"hljs-built_in\">cpuSecond</span>();<br>kernel_name&lt;&lt;&lt;grid,block&gt;&gt;&gt;(argument list);<br><span class=\"hljs-built_in\">cudaDeviceSynchronize</span>();<br><span class=\"hljs-keyword\">double</span> iElaps = <span class=\"hljs-built_in\">cpuSecond</span>() - iStart;<br></code></pre></div></td></tr></table></figure>\n\n<p>ç”±äºæ ¸å‡½æ•°è°ƒç”¨ä¸ä¸»æœºç«¯ç¨‹åºæ˜¯å¼‚æ­¥çš„ï¼Œä½ éœ€è¦ç”¨cudaDeviceSynchronizeå‡½æ•°æ¥ç­‰å¾…æ‰€æœ‰çš„GPUçº¿ç¨‹è¿è¡Œç»“æŸã€‚å˜é‡iElapsè¡¨ç¤ºç¨‹åºè¿è¡Œçš„æ—¶é—´ï¼Œå°±åƒä½ ç”¨æ‰‹è¡¨è®°å½•çš„æ ¸å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼ˆç”¨ç§’è®¡ç®—ï¼‰ã€‚</p>\n<p>ç°åœ¨ï¼Œé€šè¿‡è®¾ç½®æ•°æ®é›†å¤§å°æ¥å¯¹ä¸€ä¸ªæœ‰16Mä¸ªå…ƒç´ çš„å¤§å‘é‡è¿›è¡Œæµ‹è¯•ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-keyword\">int</span> nElem = <span class=\"hljs-number\">1</span>&lt;&lt;<span class=\"hljs-number\">24</span>;<br></code></pre></div></td></tr></table></figure>\n\n<p>ç”±äºGPUçš„å¯æ‰©å±•æ€§ï¼Œä½ éœ€è¦å€ŸåŠ©å—å’Œçº¿ç¨‹çš„ç´¢å¼•æ¥è®¡ç®—ä¸€ä¸ªæŒ‰è¡Œä¼˜å…ˆçš„æ•°ç»„ç´¢å¼• i ï¼Œå¹¶å¯¹æ ¸å‡½æ•°è¿›è¡Œä¿®æ”¹ï¼Œæ·»åŠ é™å®šæ¡ä»¶ï¼ˆi &lt; Nï¼‰æ¥æ£€éªŒç´¢å¼•å€¼æ˜¯å¦è¶Šç•Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\">__global__ <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">sumArraysOnGPU</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> *A, <span class=\"hljs-keyword\">float</span> *B, <span class=\"hljs-keyword\">float</span> *C, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">int</span> N)</span></span>&#123;<br>    <span class=\"hljs-keyword\">int</span> i = blockIdx.x * blockDim.x + threadIdx.x;<br>    <span class=\"hljs-keyword\">if</span>( n &lt; N) C[i] = A[i] + B[i];<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>æœ‰äº†è¿™äº›æ›´æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ‰§è¡Œé…ç½®æ¥è¡¡é‡æ ¸å‡½æ•°ã€‚ä¸ºäº†è§£å†³åˆ›å»ºçš„çº¿ç¨‹æ€»æ•°å¤§äºå‘é‡å…ƒç´ æ€»æ•°çš„æƒ…å†µï¼Œä½ éœ€è¦é™åˆ¶å†…æ ¸ä¸èƒ½éæ³•è®¿é—®å…¨å±€å†…å­˜ï¼Œå¦‚å›¾2-7æ‰€ç¤ºã€‚</p>\n<p><img src=\"/2023/03/07/CUDA012/image-20230307120643741.png\" alt=\"image-20230307120643741\"></p>\n<p>ä»£ç æ¸…å•2-5å±•ç¤ºäº†å¦‚ä½•åœ¨ä¸»å‡½æ•°ä¸­ç”¨CPUè®¡æ—¶å™¨æµ‹è¯•å‘é‡åŠ æ³•çš„æ ¸å‡½æ•°ã€‚</p>\n<p>ä»£ç æ¸…å•2-5\tæµ‹è¯•å‘é‡åŠ æ³•çš„æ ¸å‡½æ•°ï¼ˆsumArraysOnGPU-timer.cuï¼‰</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;cuda_runtime.h&gt;</span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;stdio.h&gt;</span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;sys/time.h&gt;</span></span><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> argc,<span class=\"hljs-keyword\">char</span> **argv)</span></span>&#123;<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;%s Starting...\\n&quot;</span>,argv[<span class=\"hljs-number\">0</span>]);<br>    <br>    <span class=\"hljs-comment\">//set up device</span><br>    <span class=\"hljs-keyword\">int</span> dev = <span class=\"hljs-number\">0</span>;<br>    cudaDeviceProp deviceProp;<br>    <span class=\"hljs-built_in\">CHECK</span>(<span class=\"hljs-built_in\">cudaGetDeviceProperties</span>(&amp;deviceProp, dev));<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;Using Device %d: %s\\n&quot;</span>, dev, deviceProp.name);<br>    <span class=\"hljs-built_in\">CHECK</span>(<span class=\"hljs-built_in\">cudaSetDevice</span>(dev));<br>    <br>    <span class=\"hljs-comment\">//set up data size of vectors</span><br>    <span class=\"hljs-keyword\">int</span> nElem = <span class=\"hljs-number\">1</span>&lt;&lt;<span class=\"hljs-number\">24</span>;<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;Vector size %d\\n&quot;</span>,nElem);<br>    <br>    <span class=\"hljs-comment\">//malloc host memory</span><br>    <span class=\"hljs-keyword\">size_t</span> nBytes = nElem * <span class=\"hljs-built_in\"><span class=\"hljs-keyword\">sizeof</span></span>(<span class=\"hljs-keyword\">float</span>);<br>    <br>    <span class=\"hljs-keyword\">float</span> *h_A, *h_B, *hostRef, *gpuRef;<br>    h_A = (<span class=\"hljs-keyword\">float</span>*)<span class=\"hljs-built_in\">malloc</span>(nBytes);<br>    h_B = (<span class=\"hljs-keyword\">float</span>*)<span class=\"hljs-built_in\">malloc</span>(nBytes);<br>    hostRef = (<span class=\"hljs-keyword\">float</span>*)<span class=\"hljs-built_in\">malloc</span>(nBytes);<br>    gpuRef = (<span class=\"hljs-keyword\">float</span>*)<span class=\"hljs-built_in\">malloc</span>(nBytes);<br>    <br>    <span class=\"hljs-keyword\">double</span> iStart,iElaps;<br>    <br>    <span class=\"hljs-comment\">//initialize data at host side</span><br>    iStart = <span class=\"hljs-built_in\">cpuSecond</span>();<br>    <span class=\"hljs-built_in\">initialData</span>(h_A, nElem);<br>    <span class=\"hljs-built_in\">initialData</span>(h_B, nElem);<br>    iElaps = <span class=\"hljs-built_in\">cpuSecond</span>() - iStart;<br>    <br>    <span class=\"hljs-built_in\">memset</span>(hostRef, <span class=\"hljs-number\">0</span> ,nBytes);<br>    <span class=\"hljs-built_in\">memset</span>(gpuRef, <span class=\"hljs-number\">0</span> ,nBytes);<br>    <br>    <span class=\"hljs-comment\">//add vector at host side for result checks</span><br>    iStart = <span class=\"hljs-built_in\">cpuSecond</span>();<br>    <span class=\"hljs-built_in\">sumArraysOnHost</span>(h_A, h_B, hostRef, nElem);<br>    iElaps = <span class=\"hljs-built_in\">cpuSecond</span>() - iStart;<br>    <br>    <span class=\"hljs-comment\">//malloc device global memory</span><br>    <span class=\"hljs-keyword\">float</span> *d_A, *d_B, *d_C;<br>    <span class=\"hljs-built_in\">cudaMalloc</span>((<span class=\"hljs-keyword\">float</span>**)&amp;d_A, nBytes);<br>    <span class=\"hljs-built_in\">cudaMalloc</span>((<span class=\"hljs-keyword\">float</span>**)&amp;d_B, nBytes);<br>    <span class=\"hljs-built_in\">cudaMalloc</span>((<span class=\"hljs-keyword\">float</span>**)&amp;d_C, nBytes);<br>    <br>    <span class=\"hljs-comment\">//transfer data from host to device</span><br>    <span class=\"hljs-built_in\">cudaMemcpy</span>(d_A, h_A, nBytes, cudaMemcpyHostTodevice);<br>    <span class=\"hljs-built_in\">cudaMemcpy</span>(d_B, h_B, nBytes, cudaMemcpyHostTodevice);<br>    <br>    <span class=\"hljs-comment\">//invoke kernel at host side</span><br>    <span class=\"hljs-keyword\">int</span> iLen = <span class=\"hljs-number\">1024</span>;<br>    <span class=\"hljs-function\">dim3 <span class=\"hljs-title\">block</span><span class=\"hljs-params\">(iLen)</span></span>;<br>    <span class=\"hljs-function\">dim3 <span class=\"hljs-title\">grid</span><span class=\"hljs-params\">((nElem+block.x<span class=\"hljs-number\">-1</span>))</span>/block.x)</span>;<br>    <br>    iStart = <span class=\"hljs-built_in\">cpuSecond</span>();<br>    sumArraysOnGPU&lt;&lt;&lt;grid,block&gt;&gt;&gt;(d_A, d_B, d_C,nElem);<br>    <span class=\"hljs-built_in\">cudaDeviceSynchronize</span>();<br>    iElaps = <span class=\"hljs-built_in\">cpuSecond</span>() - iStart;<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;sumArraysOnGPU&lt;&lt;&lt;%d,%d&gt;&gt;&gt; Time elapsed %f sec\\n&quot;</span>,grid.x, block.x, iElaps);<br>    <br>    <span class=\"hljs-comment\">//copy kernel result back to host side</span><br>    <span class=\"hljs-built_in\">cudaMemcpy</span>(gpuRef, d_C, nBytes, cudaMemcpyDeviceToHost);<br>    <br>    <span class=\"hljs-comment\">//check device results</span><br>    <span class=\"hljs-built_in\">checkResult</span>(hostRef, gpuRef, nElem);<br>    <br>    <span class=\"hljs-comment\">//free device global memory</span><br>    <span class=\"hljs-built_in\">cudaFree</span>(d_A);<br>    <span class=\"hljs-built_in\">cudaFree</span>(d_B);<br>    <span class=\"hljs-built_in\">cudaFree</span>(d_C);<br>    <br>    <span class=\"hljs-comment\">//free host memory</span><br>    <span class=\"hljs-built_in\">free</span>(h_A);<br>    <span class=\"hljs-built_in\">free</span>(h_B);<br>    <span class=\"hljs-built_in\">free</span>(hostRef);<br>    <span class=\"hljs-built_in\">free</span>(gpuRef);<br>    <br>    <span class=\"hljs-keyword\">return</span>(<span class=\"hljs-number\">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>é»˜è®¤çš„æ‰§è¡Œé…ç½®è¢«è®¾ç½®ä¸ºä¸€ä¸ªåŒ…å«16384ä¸ªå—çš„ä¸€ç»´ç½‘æ ¼ï¼Œæ¯ä¸ªå—åŒ…å«1024ä¸ªçº¿ç¨‹ã€‚ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘å¹¶è¿è¡Œç¨‹åºï¼š</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">nvcc sumArraysOnGPU-timer.cu -o sumArraysOnGPU-timer<br>./sumArraysOnGPU-timer<br></code></pre></div></td></tr></table></figure>\n\n<p>åœ¨åŸºäºè‹±ç‰¹å°”Sandy Bridgeæ¶æ„çš„ç³»ç»Ÿä¸Šè¿›è¡Œæµ‹è¯•ï¼Œä»ä»£ç æ¸…å•2-5çš„ç¤ºä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨GPUä¸Šè¿›è¡Œçš„å‘é‡åŠ æ³•çš„è¿ç®—é€Ÿåº¦æ˜¯åœ¨CPUä¸Šè¿è¡Œå‘é‡åŠ æ³•çš„3.86å€ã€‚</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">./sumArraysOnGPU-timer Starting...<br>Using Device 0:Tesia M2070<br>Vector size 16777216<br>sumArraysOnGPU&lt;&lt;&lt;16384, 1024&gt;&gt;&gt;\t\tTime elapsed 0.002456 sec<br>Arrays match.<br></code></pre></div></td></tr></table></figure>\n\n<p>æŠŠå—çš„ç»´åº¦å‡å°‘åˆ°512å¯ä»¥åˆ›å»º32768ä¸ªå—ã€‚åœ¨è¿™ä¸ªæ–°çš„é…ç½®ä¸‹ï¼Œå†…æ ¸çš„æ€§èƒ½æå‡äº†1.19å€ã€‚</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">sumArraysOnGPU&lt;&lt;&lt;32768, 512&gt;&gt;&gt;\tTime elapsed 0.002058 sec<br></code></pre></div></td></tr></table></figure>\n\n<p>å¦‚æœè¿›ä¸€æ­¥å°†å—çš„ç»´åº¦é™ä½åˆ°256ï¼Œç³»ç»Ÿå°†æç¤ºä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼Œä¿¡æ¯è¡¨ç¤ºå—çš„æ€»æ•°è¶…è¿‡ä¸€ç»´ç½‘æ ¼çš„é™åˆ¶ã€‚</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">./sumArraysOnGPU-timer Starting...<br>Using Device 0:\tTesla M2070<br>Vector size 16777216<br>sumArraysOnGPU&lt;&lt;&lt;65536, 256&gt;&gt;&gt;  Time elapsed 0.000183 sec<br>Error: sumArraysOnGPU-timer.cu:153, code:9, reason: invalid configuration argument<br></code></pre></div></td></tr></table></figure>\n\n<h3 id=\"äº†è§£è‡ªèº«å±€é™æ€§\"><a href=\"#äº†è§£è‡ªèº«å±€é™æ€§\" class=\"headerlink\" title=\"äº†è§£è‡ªèº«å±€é™æ€§\"></a>äº†è§£è‡ªèº«å±€é™æ€§</h3><p>åœ¨è°ƒæ•´æ‰§è¡Œé…ç½®æ—¶éœ€è¦äº†è§£çš„ä¸€ä¸ªå…³é”®ç‚¹æ˜¯å¯¹ç½‘æ ¼å’Œå—ç»´åº¦çš„é™åˆ¶ã€‚çº¿ç¨‹å±‚æ¬¡ç»“æ„ä¸­æ¯ä¸ªå±‚æ¬¡çš„æœ€å¤§å°ºå¯¸å–å†³äºè®¾å¤‡ã€‚</p>\n<p>CUDAæä¾›äº†é€šè¿‡æŸ¥è¯¢GPUæ¥äº†è§£è¿™äº›é™åˆ¶çš„èƒ½åŠ›ã€‚</p>\n<p>å¯¹äºFermiè®¾å¤‡ï¼Œæ¯ä¸ªå—çš„æœ€å¤§çº¿ç¨‹æ•°æ˜¯1024ï¼Œä¸”ç½‘æ ¼çš„x,y,zä¸‰ä¸ªæ–¹å‘ä¸Šçš„ç»´åº¦æœ€å¤§å€¼æ˜¯65535</p>\n<h3 id=\"ç”¨nvprofå·¥å…·è®¡æ—¶\"><a href=\"#ç”¨nvprofå·¥å…·è®¡æ—¶\" class=\"headerlink\" title=\"ç”¨nvprofå·¥å…·è®¡æ—¶\"></a>ç”¨nvprofå·¥å…·è®¡æ—¶</h3><p>è‡ªCUDA 5.0ä»¥æ¥ï¼ŒNVIDIAæä¾›äº†ä¸€ä¸ªåä¸ºnvprofçš„å‘½ä»¤è¡Œåˆ†æå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä»åº”ç”¨ç¨‹åºçš„CPUå’ŒGPUæ´»åŠ¨æƒ…å†µä¸­è·å–æ—¶é—´çº¿ä¿¡æ¯ï¼Œå…¶åŒ…æ‹¬å†…æ ¸æ‰§è¡Œï¼Œå†…å­˜ä¼ è¾“ä»¥åŠCUDA APIçš„è°ƒç”¨ã€‚å…¶ç”¨æ³•å¦‚ä¸‹ã€‚</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">nvprof [nvprof_args] &lt;application&gt;  [application_args]<br></code></pre></div></td></tr></table></figure>\n\n<p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–æ›´å¤šå…³äºnvprofçš„å¸®åŠ©ä¿¡æ¯ï¼š</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">nvprof --help<br></code></pre></div></td></tr></table></figure>\n\n<p>ä½ å¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤å»æµ‹è¯•å†…æ ¸ï¼š</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">nvprof  ./sumArraysOnGPU-timer<br></code></pre></div></td></tr></table></figure>\n\n<p>nvprofçš„è¾“å‡ºç»“æœä¼šå› ä¸ºä½ ä½¿ç”¨çš„GPUç±»å‹ä¸åŒè€Œæœ‰æ‰€å·®å¼‚ã€‚ä»¥ä¸‹ç»“æœæ˜¯ä»Tesla GPUä¸­å¾—åˆ°çš„ï¼š</p>\n<p><img src=\"/2023/03/07/CUDA012/image-20230307142027522.png\" alt=\"image-20230307142027522\"></p>\n<p>ä»¥ä¸Šç»“æœçš„å‰åŠéƒ¨åˆ†æ¥è‡ªäºç¨‹åºçš„è¾“å‡ºï¼ŒååŠéƒ¨åˆ†æ¥è‡ªäºnvprofçš„è¾“å‡ºã€‚å¯ä»¥æ³¨æ„åˆ°ï¼ŒCPUè®¡æ—¶å™¨æ˜¾ç¤ºæ¶ˆè€—çš„å†…æ ¸æ—¶é—´ä¸º3.26msï¼Œè€Œnvprofæ˜¾ç¤ºæ¶ˆè€—çš„å†…æ ¸æ—¶é—´ä¸º2.90msã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œnvprofçš„ç»“æœæ›´ä¸ºç²¾ç¡®ï¼Œå› ä¸ºCPUè®¡æ—¶å™¨æµ‹é‡çš„æ—¶é—´ä¸­åŒ…å«äº†æ¥è‡ªnvprofé™„åŠ çš„æ—¶é—´ã€‚</p>\n<p>nvprofæ˜¯ä¸€ä¸ªèƒ½å¸®åŠ©ä½ ç†è§£åœ¨æ‰§è¡Œåº”ç”¨ç¨‹åºæ—¶æ‰€èŠ±è´¹çš„æ—¶é—´ä¸»è¦ç”¨åœ¨ä½•å¤„çš„å¼ºå¤§å·¥å…·ã€‚å¯ä»¥æ³¨æ„åˆ°ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸»æœºå’Œè®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“éœ€è¦çš„æ—¶é—´æ¯”å†…æ ¸æ‰§è¡Œçš„æ—¶é—´è¦å¤šã€‚å›¾2-8æ‰€æç»˜çš„æ—¶é—´çº¿ï¼ˆæœªæŒ‰æ¯”ä¾‹ç»˜åˆ¶ï¼‰ï¼Œæ˜¾ç¤ºäº†åœ¨CPUä¸Šæ¶ˆè€—çš„æ—¶é—´ï¼Œæ•°æ®ä¼ è¾“æ‰€ç”¨çš„æ—¶é—´ä»¥åŠåœ¨GPUä¸Šè®¡ç®—æ‰€ç”¨çš„æ—¶é—´ã€‚</p>\n<p><img src=\"/2023/03/07/CUDA012/image-20230307145539161.png\" alt=\"image-20230307145539161\"></p>\n<p>å¯¹äºHPCå·¥ä½œè´Ÿè½½ï¼Œç†è§£ç¨‹åºä¸­é€šä¿¡æ¯”çš„è®¡ç®—æ˜¯éå¸¸é‡è¦çš„ã€‚å¦‚æœä½ çš„åº”ç”¨ç¨‹åºç”¨äºè®¡ç®—çš„æ—¶é—´å¤§äºæ•°æ®ä¼ è¾“æ‰€ç”¨çš„æ—¶é—´ï¼Œé‚£ä¹ˆæˆ–è®¸å¯ä»¥å‹ç¼©è¿™äº›æ“ä½œï¼Œå¹¶å®Œå…¨éšè—ä¸ä¼ è¾“æ•°æ®æœ‰å…³çš„å»¶è¿Ÿã€‚å¦‚æœä½ çš„åº”ç”¨ç¨‹åºç”¨äºè®¡ç®—çš„æ—¶é—´å°‘äºæ•°æ®ä¼ è¾“æ‰€ç”¨çš„æ—¶é—´ï¼Œé‚£ä¹ˆéœ€è¦å°½é‡å‡å°‘ä¸»æœºå’Œè®¾å¤‡ä¹‹é—´çš„ä¼ è¾“ã€‚</p>\n<h3 id=\"æ¯”è¾ƒåº”ç”¨ç¨‹åºçš„æ€§èƒ½å°†ç†è®ºç•Œé™æœ€å¤§åŒ–\"><a href=\"#æ¯”è¾ƒåº”ç”¨ç¨‹åºçš„æ€§èƒ½å°†ç†è®ºç•Œé™æœ€å¤§åŒ–\" class=\"headerlink\" title=\"æ¯”è¾ƒåº”ç”¨ç¨‹åºçš„æ€§èƒ½å°†ç†è®ºç•Œé™æœ€å¤§åŒ–\"></a>æ¯”è¾ƒåº”ç”¨ç¨‹åºçš„æ€§èƒ½å°†ç†è®ºç•Œé™æœ€å¤§åŒ–</h3><p>åœ¨è¿›è¡Œç¨‹åºä¼˜åŒ–æ—¶ï¼Œå¦‚ä½•å°†åº”ç”¨ç¨‹åºå’Œç†è®ºç•Œé™è¿›è¡Œæ¯”è¾ƒæ˜¯å¾ˆé‡è¦çš„ã€‚ç”±nvprofå¾—åˆ°çš„è®¡æ•°å™¨å¯ä»¥å¸®åŠ©ä½ è·å–åº”ç”¨ç¨‹åºçš„æŒ‡ä»¤å’Œå†…å­˜ååé‡ã€‚å¦‚æœå°†åº”ç”¨ç¨‹åºçš„æµ‹é‡å€¼ä¸ç†è®ºå³°å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¯ä»¥åˆ¤å®šä½ çš„åº”ç”¨ç¨‹åºçš„æ€§èƒ½æ˜¯å—é™äºç®—æ³•è¿˜æ˜¯å—é™äºå†…å­˜å¸¦å®½çš„ã€‚ä»¥Tesla K10ä¸ºä¾‹ï¼Œå¯ä»¥å¾—åˆ°ç†è®ºä¸Šçš„æ¯”ç‡ï¼š</p>\n<p>Tesla K10å•ç²¾åº¦å³°å€¼æµ®ç‚¹è¿ç®—æ¬¡æ•°</p>\n<p>745 MHzæ ¸å¿ƒé¢‘ç‡*2 GPU&#x2F;èŠ¯ç‰‡*  ï¼ˆ8ä¸ªå¤šå¤„ç†å™¨<em>192ä¸ªæµ®ç‚¹å•å…ƒ</em>32æ ¸å¿ƒ&#x2F;å¤šå¤„ç†å™¨ï¼‰*2OPS&#x2F;å‘¨æœŸ &#x3D; 4.58 TFLOPS ï¼ˆFLOPSè¡¨ç¤ºæ¯ç§’æµ®ç‚¹è¿ç®—æ¬¡æ•°ï¼‰</p>\n<p>Tesla K10å†…å­˜å¸¦å®½å³°å€¼</p>\n<p>2 GPU&#x2F;èŠ¯ç‰‡<em>256ä½</em>2500 MHzå†…å­˜æ—¶é’Ÿ*2 DDR&#x2F;8ä½&#x2F;å­—èŠ‚ &#x3D; 320 GB&#x2F;s</p>\n<p>æŒ‡ä»¤æ¯”ï¼šå­—èŠ‚</p>\n<p>4.58 TFLOPS&#x2F;320 GB&#x2F;s,\tä¹Ÿå°±æ˜¯13.6ä¸ªæŒ‡ä»¤ï¼š1ä¸ªå­—èŠ‚</p>\n<p>å¯¹äºTesla K10è€Œè¨€ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºæ¯è®¿é—®ä¸€ä¸ªå­—èŠ‚æ‰€äº§ç”Ÿçš„æŒ‡ä»¤æ•°å¤šäº13.6ï¼Œé‚£ä¹ˆä½ çš„åº”ç”¨ç¨‹åºå—ç®—æ³•æ€§èƒ½é™åˆ¶ã€‚å¤§å¤šæ•°HPCå·¥ä½œè´Ÿè½½å—å†…å­˜å¸¦å®½çš„é™åˆ¶ã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p>CUDA Cç¼–ç¨‹æƒå¨æŒ‡å— ç¨‹æ¶¦ä¼Ÿï¼ŒMax Grossman(ç¾)ï¼ŒTy Mckercher </p>\n",
            "tags": [
                "CUDA"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/06/ML001/",
            "url": "https://xingyuanjie.top/2023/03/06/ML001/",
            "title": "çº¿æ€§å›å½’æ¨¡å‹",
            "date_published": "2023-03-06T11:00:34.000Z",
            "content_html": "<h2 id=\"çº¿æ€§å›å½’æ¨¡å‹\"><a href=\"#çº¿æ€§å›å½’æ¨¡å‹\" class=\"headerlink\" title=\"çº¿æ€§å›å½’æ¨¡å‹\"></a>çº¿æ€§å›å½’æ¨¡å‹</h2><h3 id=\"MOdel-Representation\"><a href=\"#MOdel-Representation\" class=\"headerlink\" title=\"MOdel Representation\"></a>MOdel Representation</h3><p><img src=\"/2023/03/06/ML001/image-20230306195956356.png\" alt=\"image-20230306195956356\"></p>\n<h3 id=\"Goals\"><a href=\"#Goals\" class=\"headerlink\" title=\"Goals\"></a>Goals</h3><p>In this lab you will:</p>\n<ul>\n<li>learn to implement the model f_{w,b} for linear regression with one variable</li>\n</ul>\n<h3 id=\"Notation\"><a href=\"#Notation\" class=\"headerlink\" title=\"Notation\"></a>Notation</h3><p>Here is a summary of some of the notation you will encounter.</p>\n<p><img src=\"/2023/03/06/ML001/image-20230306200250050.png\" alt=\"image-20230306200250050\"></p>\n<h3 id=\"Tools\"><a href=\"#Tools\" class=\"headerlink\" title=\"Tools\"></a>Tools</h3><p>In this lab you will make use of:</p>\n<ul>\n<li><p>NumPy,a popular library for scientific computing</p>\n</li>\n<li><p>Matplotlib,a popular library for plotting data</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np<br><span class=\"hljs-keyword\">import</span> matplotlib.pyplot <span class=\"hljs-keyword\">as</span> plt<br>plt.style.use(<span class=\"hljs-string\">&#x27;./deeplearning.mpstyle&#x27;</span>)<br></code></pre></div></td></tr></table></figure></li>\n</ul>\n<h3 id=\"Problem-Statement\"><a href=\"#Problem-Statement\" class=\"headerlink\" title=\"Problem Statement\"></a>Problem Statement</h3><p><img src=\"/2023/03/06/ML001/image-20230306200642937.png\" alt=\"image-20230306200642937\"></p>\n<p>As in the lecture,you will use the motivating example of housing price prediction. This lab will use a simple data set with only two data points - a house with 1000 square feet(sqft) sold for $300,000 and a house with 2000 square feet sold for $500,000.These two points will constitute our data or training set. In this lab, the units of size are 1000 sqft and the units of price are 1000s of dollars.</p>\n<table>\n<thead>\n<tr>\n<th>Size (1000 sqft)</th>\n<th>Price (1000s of dollars)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1.0</td>\n<td>300</td>\n</tr>\n<tr>\n<td>2.0</td>\n<td>500</td>\n</tr>\n</tbody></table>\n<p>You would like to fit a linear regression model(shown above as the blue straight line)through these two points, so you can then predict price for other houses - say, a house with 1200 sqft.</p>\n<p>Please run the following code cell to create your x_train and y_train variables. The data is stored in one-dimensional NumPy arrays.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#x_train is the input variable (size in 1000 square feet)</span><br><span class=\"hljs-comment\">#y_train is the target (price in 1000s of dollars)</span><br>x_train = np.array([<span class=\"hljs-number\">1.0</span>,<span class=\"hljs-number\">2.0</span>])<br>y_train = np.array([<span class=\"hljs-number\">300.0</span>,<span class=\"hljs-number\">500.0</span>])<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;x_train = <span class=\"hljs-subst\">&#123;x_train&#125;</span>&quot;</span>)<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;y_train = <span class=\"hljs-subst\">&#123;y_train&#125;</span>&quot;</span>)<br></code></pre></div></td></tr></table></figure>\n\n<h3 id=\"Number-of-training-examples-m\"><a href=\"#Number-of-training-examples-m\" class=\"headerlink\" title=\"Number of training examples m\"></a>Number of training examples m</h3><p>you will use m to denote the number of training examples. Numpy arrays have a .shape parameter. x_train.shape return a python tuple with an entry for each dimension. x_train.shape[0] is the length of the array and number of examples as shown below.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># m is the number of training examples</span><br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;x_train.shape: <span class=\"hljs-subst\">&#123;x_train.shape&#125;</span>&quot;</span>)<br>m = x_train.shape[<span class=\"hljs-number\">0</span>]<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;Number of training example is: <span class=\"hljs-subst\">&#123;m&#125;</span>&quot;</span>)<br></code></pre></div></td></tr></table></figure>\n\n<p>x.train.shape: (2,)</p>\n<p>Number of training examples is: 2</p>\n<p><strong>One can also use the Python len() function as shown below.</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\"># m is the number of training examples</span><br>m = <span class=\"hljs-built_in\">len</span>(x_train)<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;Number of training example is: <span class=\"hljs-subst\">&#123;m&#125;</span>&quot;</span>)<br></code></pre></div></td></tr></table></figure>\n\n<p>Number of training examples  is:\t2</p>\n<h3 id=\"Training-example-x-i-y-i\"><a href=\"#Training-example-x-i-y-i\" class=\"headerlink\" title=\"Training example x_i, y_i\"></a>Training example x_i, y_i</h3><p>You will use (x(ğ‘–), y(ğ‘–)) to denote the ğ‘–(th) training example. Since Python is zero indexed, (x(0), y(0) is (1.0, 300.0) and (x(1), y(1) is (2.0, 500.0).</p>\n<p>To access a value in a Numpy array, one indexes the array with the desired offset. For example the syntax to access location zero of x_train is x_train[0]. Run the next code block below to get the i(th) training example.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">i = <span class=\"hljs-number\">0</span> <span class=\"hljs-comment\">#Change this to 1 to see (x^1,y^1)</span><br><br>x_i = x_train[i]<br>y_i = y_train[i]<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;(x^(<span class=\"hljs-subst\">&#123;i&#125;</span>), y^(<span class=\"hljs-subst\">&#123;i&#125;</span>)) = (<span class=\"hljs-subst\">&#123;x_i&#125;</span>, <span class=\"hljs-subst\">&#123;y_i&#125;</span>)&quot;</span>)<br></code></pre></div></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">(x^(<span class=\"hljs-number\">0</span>), y^(<span class=\"hljs-number\">0</span>)) = (<span class=\"hljs-number\">1.0</span>, <span class=\"hljs-number\">300.0</span>)<br></code></pre></div></td></tr></table></figure>\n\n<h3 id=\"Plotting-the-data\"><a href=\"#Plotting-the-data\" class=\"headerlink\" title=\"Plotting the data\"></a>Plotting the data</h3><p>You can plot these two points using the scatter() function is the matplotlib library,as shown in the cell below.</p>\n<ul>\n<li>The function arguments marker and c show the points as red crosses(the default is blue dots.)</li>\n</ul>\n<p>You can use other functions in the matplotlib library to set title and labels to display.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-comment\">#Plot the data points</span><br>plt.scatter(x_train, y_train, marker=<span class=\"hljs-string\">&#x27;x&#x27;</span> c=<span class=\"hljs-string\">&#x27;r&#x27;</span>)<br><span class=\"hljs-comment\">#Set the title</span><br>plt.title(<span class=\"hljs-string\">&quot;Housing Prices&quot;</span>)<br><span class=\"hljs-comment\">#Set the y-axis label</span><br>plt.ylabel(<span class=\"hljs-string\">&#x27;Price (in 1000s of dollars)&#x27;</span>)<br><span class=\"hljs-comment\">#Set the x-axis lbel</span><br>plt.xlabel(<span class=\"hljs-string\">&#x27;Size (1000 sqft)&#x27;</span>)<br>plt.show()<br></code></pre></div></td></tr></table></figure>\n\n<p><img src=\"/2023/03/06/ML001/image-20230306204822102.png\" alt=\"image-20230306204822102\"></p>\n<h3 id=\"Model-function\"><a href=\"#Model-function\" class=\"headerlink\" title=\"Model function\"></a>Model function</h3><p><img src=\"/2023/03/06/ML001/image-20230306204918585.png\" alt=\"image-20230306204918585\"></p>\n<p>As described in lecture, the model function for linear regression (which is a function that maps from x to y)is represented as</p>\n<p><img src=\"/2023/03/06/ML001/image-20230306205107527.png\" alt=\"image-20230306205107527\"></p>\n<p>The formula above is how you can represent straight lines - different values of w and b give you different straight lines on the plot.</p>\n<p>Letâ€™s try to get a better intuition for this through the code blocks below. Letâ€™s start with w &#x3D; 100 and b &#x3D;100.</p>\n<p>Note: You can come back to this cell to adjust the modelâ€™s w and b parameters.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">w = <span class=\"hljs-number\">100</span><br>b = <span class=\"hljs-number\">100</span><br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;w: <span class=\"hljs-subst\">&#123;w&#125;</span>&quot;</span>)<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;b: <span class=\"hljs-subst\">&#123;b&#125;</span>&quot;</span>)<br></code></pre></div></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">w:\t<span class=\"hljs-number\">100</span><br>b:\t<span class=\"hljs-number\">100</span><br></code></pre></div></td></tr></table></figure>\n\n<p>Now,letâ€™s compute the value of f_{w,b}(x^i) for your two data points. You can explicitly write this out for each data poins as -</p>\n<p>for x(0),f_wb &#x3D; w * x[0] + b</p>\n<p>for x(1),f_wb &#x3D; w * x[1] + b</p>\n<p>For a large number of data points, this can get unwieldy and repetitive. So instead, you can calculate the function output in a for loop as shown in the compute_model_output function below.</p>\n<p>Note:The argument description (ndarray (m,)) describes a Numpy n-dimensional array of shape (m,). (scalar) describes an argument without dimensions, just a magnitude.</p>\n<p>Note: np.zero(n) will return a one-dimensional numpy array with n entries</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">compute_model_output</span>(<span class=\"hljs-params\">x, w, b</span>):</span><br>    <span class=\"hljs-string\">&quot;&quot;&quot;</span><br><span class=\"hljs-string\">    Computes the prediction of a linear model</span><br><span class=\"hljs-string\">    Args:</span><br><span class=\"hljs-string\">    \tx (ndarray (m,)):Data, m examples</span><br><span class=\"hljs-string\">    \tw,b (scalar)\t:model parameters</span><br><span class=\"hljs-string\">    Returns</span><br><span class=\"hljs-string\">    \ty (ndarray (m,)):target values</span><br><span class=\"hljs-string\">    &quot;&quot;&quot;</span><br>    <br>    m = x.shape[<span class=\"hljs-number\">0</span>]<br>    f_wb = np.zeros(m)<br>    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(m)<br>    \tf_wb[i] = w * x[i] + b<br>    <br>    <span class=\"hljs-keyword\">return</span> f_wb<br></code></pre></div></td></tr></table></figure>\n\n<p>Now letâ€™s call the compute_model_output function and plot the output.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">tmp_f_wb = compute_model_output(x_train, w, b,)<br><br><span class=\"hljs-comment\">#Plot our model prediction</span><br>plt.plot(x_train, tmp_f_wb, c=<span class=\"hljs-string\">&#x27;b&#x27;</span>,label=<span class=\"hljs-string\">&#x27;Our Prediction&#x27;</span>)<br><br><span class=\"hljs-comment\">#Plot the data points</span><br>plt.scatter(x_train, y_train, marker=<span class=\"hljs-string\">&#x27;x&#x27;</span>, c=<span class=\"hljs-string\">&#x27;r&#x27;</span>,label=<span class=\"hljs-string\">&#x27;Actual Values&#x27;</span>)<br><br><span class=\"hljs-comment\">#Set the title</span><br>plt.title(<span class=\"hljs-string\">&quot;Housing Prices&quot;</span>)<br><span class=\"hljs-comment\">#Set the y-axis label</span><br>plt.ylabel(<span class=\"hljs-string\">&#x27;Price (in 1000s of dollars)&#x27;</span>)<br><span class=\"hljs-comment\">#Set the x-axis label</span><br>plt.xlabel(<span class=\"hljs-string\">&#x27;Size (1000 sqft)&#x27;</span>)<br>plt.legend()<br>plt.show()<br></code></pre></div></td></tr></table></figure>\n\n<p><img src=\"/2023/03/06/ML001/image-20230306211337338.png\" alt=\"image-20230306211337338\"></p>\n<p>As you can see, setting w &#x3D; 100 and b &#x3D; 100 does not result in a line that fits our data.</p>\n<h3 id=\"Challenge\"><a href=\"#Challenge\" class=\"headerlink\" title=\"Challenge\"></a>Challenge</h3><p>Try experimenting with different values of w and b. What should the values be for a line that fits our data?</p>\n<p><strong>Tips:</strong></p>\n<p>You can use  your mouse to click on the triangle to the left of the green â€œHintsâ€ below to reveal some hints for choosing b and w.</p>\n<p><strong>Hints</strong></p>\n<h3 id=\"Prediction\"><a href=\"#Prediction\" class=\"headerlink\" title=\"Prediction\"></a>Prediction</h3><p>Now that we have a model, we can use it to make our original prediction. Letâ€™s predict the price of a house with 1200 sqft. Since the units of x are in 1000â€™s of sqft, x is 1.2.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">w = <span class=\"hljs-number\">200</span><br>b = <span class=\"hljs-number\">100</span><br>x_i = <span class=\"hljs-number\">1.2</span><br>cost_1200sqft = w * x_i + b<br><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">f&quot;$<span class=\"hljs-subst\">&#123;cost_1200sqft:<span class=\"hljs-number\">.0</span>f&#125;</span> thousand dollars&quot;</span> )<br></code></pre></div></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs python\">$<span class=\"hljs-number\">340</span> thousand dollars<br></code></pre></div></td></tr></table></figure>\n\n<h3 id=\"Congratulations\"><a href=\"#Congratulations\" class=\"headerlink\" title=\"Congratulations!\"></a>Congratulations!</h3><p>In this lab you have learned:</p>\n<ul>\n<li>Linear regression bulids a model which establishes a relationship between features and targets</li>\n<li>In the example above, the feature was house size and the target was house price</li>\n<li>for simple linear regression, the model has two parameters w and b whose calue are â€˜fitâ€™ using training data.</li>\n<li>once a modelâ€™s parameters have been determined, the model can be used to make predictions on novel data.</li>\n</ul>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p><a href=\"https://www.bilibili.com/video/BV1Pa411X76s?p=5&amp;vd_source=3ae32e36058f58c5b85935fca9b77797\">https://www.bilibili.com/video/BV1Pa411X76s?p=5&amp;vd_source=3ae32e36058f58c5b85935fca9b77797</a></p>\n<p><a href=\"https://github.com/kaieye/2022-Machine-Learning-Specialization\">kaieye&#x2F;2022-Machine-Learning-Specialization (github.com)</a></p>\n",
            "tags": [
                "Tensorflow",
                "Machine Learning"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/06/cuda011/",
            "url": "https://xingyuanjie.top/2023/03/06/cuda011/",
            "title": "CUDAç¼–è¯‘ä¸æ‰§è¡Œ",
            "date_published": "2023-03-06T08:18:09.000Z",
            "content_html": "<h2 id=\"CUDAç¼–è¯‘ä¸æ‰§è¡Œ\"><a href=\"#CUDAç¼–è¯‘ä¸æ‰§è¡Œ\" class=\"headerlink\" title=\"CUDAç¼–è¯‘ä¸æ‰§è¡Œ\"></a>CUDAç¼–è¯‘ä¸æ‰§è¡Œ</h2><p>ç°åœ¨æŠŠæ‰€æœ‰çš„ä»£ç æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶åä¸ºsumArraysOnGPU-small-case.cuçš„æ–‡ä»¶ä¸­ï¼Œå¦‚ä»£ç æ¸…å•2-4æ‰€ç¤ºã€‚</p>\n<p><strong>ä»£ç æ¸…å•2-4\t\tåŸºäºGPUçš„å‘é‡åŠ æ³•ï¼ˆsumArraysOnGPU-small-case.cuï¼‰</strong></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;cuda_runtime.h&gt;</span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;stdio.h&gt;</span></span><br><span class=\"hljs-comment\">/*</span><br><span class=\"hljs-comment\">#define CHECK(call)</span><br><span class=\"hljs-comment\">&#123;</span><br><span class=\"hljs-comment\">    const cudaError_t error = call;</span><br><span class=\"hljs-comment\">    if(error != cudaSuccess)</span><br><span class=\"hljs-comment\">    &#123;</span><br><span class=\"hljs-comment\">        printf(&quot;Error:%s:%d, &quot;, __FILE__, __LINE__);</span><br><span class=\"hljs-comment\">        printf(&quot;code:%d, reason: %s\\n&quot;, error, cudaGetErrorString(error));</span><br><span class=\"hljs-comment\">    &#125;</span><br><span class=\"hljs-comment\">&#125;</span><br><span class=\"hljs-comment\">*/</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">checkResult</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> *hostRef, <span class=\"hljs-keyword\">float</span> *gpuRef, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">int</span> N)</span></span>&#123;<br>    <span class=\"hljs-keyword\">double</span> epsilon = <span class=\"hljs-number\">1.0E-8</span>;<br>    <span class=\"hljs-keyword\">int</span> match = <span class=\"hljs-number\">1</span>;<br>    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span> ;i &lt; N; i++)&#123;<br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">abs</span>(hostRef[i] - gpuRef[i]) &gt; epsilon)&#123;<br>            match = <span class=\"hljs-number\">0</span>;<br>            <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;Arrays do not match!\\n&quot;</span>);<br>            <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;host %5.2f gpu %5.2f at current %d\\n&quot;</span>,hostRef[i],gpuRef[i],i);<br>            <span class=\"hljs-keyword\">break</span>;<br>        &#125;<br>    &#125;<br>    <span class=\"hljs-keyword\">if</span>(match) <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;Arrays match.\\n\\n&quot;</span>);<br>    <span class=\"hljs-keyword\">return</span>;<br>&#125;<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">initialData</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> *ip,<span class=\"hljs-keyword\">int</span> size)</span></span>&#123;<br>    <span class=\"hljs-comment\">//generate different seed for random number</span><br>    <span class=\"hljs-keyword\">time_t</span> t;<br>    <span class=\"hljs-built_in\">srand</span>((<span class=\"hljs-keyword\">unsigned</span>) <span class=\"hljs-built_in\">time</span>(&amp;t));<br>    <br>    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i&lt;size;i++)&#123;<br>        ip[i] = (<span class=\"hljs-keyword\">float</span>)(<span class=\"hljs-built_in\">rand</span>() &amp; <span class=\"hljs-number\">0xFF</span>) /<span class=\"hljs-number\">10.0f</span>;<br>    &#125;<br>&#125;<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">sumArraysOnHost</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> *A,<span class=\"hljs-keyword\">float</span> *B, <span class=\"hljs-keyword\">float</span> *C)</span></span>&#123;<br>    <span class=\"hljs-keyword\">int</span> i = threadIdx.x;<br>    C[i] = A[i] + B[i];<br>&#125;<br><br><span class=\"hljs-function\">__gloal__ <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">sumArraysOnGPU</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> *A, <span class=\"hljs-keyword\">float</span> *B, <span class=\"hljs-keyword\">float</span> *C)</span></span>&#123;<br>    <span class=\"hljs-keyword\">int</span> i = threadIdx.x;<br>    C[i] = A[i] + B[i];<br>&#125;<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> argc,<span class=\"hljs-keyword\">char</span> **argv)</span></span>&#123;<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;%s Starting...\\n&quot;</span>,argv[<span class=\"hljs-number\">0</span>]);<br>    <br>    <span class=\"hljs-comment\">//set up device</span><br>    <span class=\"hljs-keyword\">int</span> dev = <span class=\"hljs-number\">0</span>;<br>    <span class=\"hljs-built_in\">cudaSetDevice</span>(dev);<br>    <br>    <span class=\"hljs-comment\">//set up data size of vectors</span><br>    <span class=\"hljs-keyword\">int</span> nElem = <span class=\"hljs-number\">32</span>;<br>    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;Vector size %d\\n&quot;</span>,nElem);<br>    <br>    <span class=\"hljs-comment\">//malloc host memory</span><br>    <span class=\"hljs-keyword\">size_t</span> nBytes = nElem * <span class=\"hljs-built_in\"><span class=\"hljs-keyword\">sizeof</span></span>(<span class=\"hljs-keyword\">float</span>);<br>    <br>    <span class=\"hljs-keyword\">float</span> *h_A, *h_B, *hostRef, *gpuRef;<br>    h_A = (<span class=\"hljs-keyword\">float</span>*)<span class=\"hljs-built_in\">malloc</span>(nBytes);<br>    h_B = (<span class=\"hljs-keyword\">float</span>*)<span class=\"hljs-built_in\">malloc</span>(nBytes);<br>    hostRef = (<span class=\"hljs-keyword\">float</span>*)<span class=\"hljs-built_in\">malloc</span>(nBytes);<br>    gpuRef = (<span class=\"hljs-keyword\">float</span>*)<span class=\"hljs-built_in\">malloc</span>(nBytes);<br>    <br>    <span class=\"hljs-comment\">//initialize data at host side</span><br>    <span class=\"hljs-built_in\">initialData</span>(h_A, nElem);<br>    <span class=\"hljs-built_in\">initialData</span>(h_B, nElem);<br>    <br>    <span class=\"hljs-built_in\">memset</span>(hostRef, <span class=\"hljs-number\">0</span> ,nBytes);<br>    <span class=\"hljs-built_in\">memset</span>(gpuRef, <span class=\"hljs-number\">0</span> ,nBytes);<br>    <br>    <span class=\"hljs-comment\">//malloc device global memory</span><br>    <span class=\"hljs-keyword\">float</span> *d_A, *d_B, *d_C;<br>    <span class=\"hljs-built_in\">cudaMalloc</span>((<span class=\"hljs-keyword\">float</span>**)&amp;d_A, nBytes);<br>    <span class=\"hljs-built_in\">cudaMalloc</span>((<span class=\"hljs-keyword\">float</span>**)&amp;d_B, nBytes);<br>    <span class=\"hljs-built_in\">cudaMalloc</span>((<span class=\"hljs-keyword\">float</span>**)&amp;d_C, nBytes);<br>    <br>    <span class=\"hljs-comment\">//transfer data from host to device</span><br>    <span class=\"hljs-built_in\">cudaMemcpy</span>(d_A, h_A, nBytes, cudaMemcpyHostTodevice);<br>    <span class=\"hljs-built_in\">cudaMemcpy</span>(d_B, h_B, nBytes, cudaMemcpyHostTodevice);<br>    <br>    <span class=\"hljs-comment\">//invoke kernel at host side</span><br>    <span class=\"hljs-function\">dim3 <span class=\"hljs-title\">block</span><span class=\"hljs-params\">(nElem)</span></span>;<br>    <span class=\"hljs-function\">dim3 <span class=\"hljs-title\">grid</span><span class=\"hljs-params\">(nElem/block.x)</span></span>;<br>    <br>    sumArraysOnGPU&lt;&lt;&lt;grid,block&gt;&gt;&gt;(d_A, d_B, d_C);<br>    <span class=\"hljs-built_in\">pritnf</span>(<span class=\"hljs-string\">&quot;Execution configuration &lt;&lt;&lt;%d, %d&gt;&gt;&gt;\\n&quot;</span>,grid.x,block.x);<br>    <br>    <span class=\"hljs-comment\">//copy kernel result back to host side</span><br>    <span class=\"hljs-built_in\">cudaMemcpy</span>(gpuRef, d_C, nBytes, cudaMemcpyDeviceToHost);<br>    <br>    <span class=\"hljs-comment\">//add vector at host side for result checks</span><br>    <span class=\"hljs-built_in\">sumArraysOnHost</span>(h_A, h_B, hostRef, nElem);<br>    <br>    <span class=\"hljs-comment\">//check device results</span><br>    <span class=\"hljs-built_in\">checkResult</span>(hostRef, gpuRef, nElem);<br>    <br>    <span class=\"hljs-comment\">//free device global memory</span><br>    <span class=\"hljs-built_in\">cudaFree</span>(d_A);<br>    <span class=\"hljs-built_in\">cudaFree</span>(d_B);<br>    <span class=\"hljs-built_in\">cudaFree</span>(d_C);<br>    <br>    <span class=\"hljs-comment\">//free host memory</span><br>    <span class=\"hljs-built_in\">free</span>(h_A);<br>    <span class=\"hljs-built_in\">free</span>(h_B);<br>    <span class=\"hljs-built_in\">free</span>(hostRef);<br>    <span class=\"hljs-built_in\">free</span>(gpuRef);<br>    <br>    <span class=\"hljs-keyword\">return</span>(<span class=\"hljs-number\">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå‘é‡å¤§å°è¢«è®¾ç½®ä¸º32ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-keyword\">int</span> nElem = <span class=\"hljs-number\">32</span>;<br></code></pre></div></td></tr></table></figure>\n\n<p>æ‰§è¡Œé…ç½®è¢«æ”¾å…¥ä¸€ä¸ªå—å†…ï¼Œå…¶ä¸­åŒ…å«32ä¸ªå…ƒç´ ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\">dim3 <span class=\"hljs-title\">block</span><span class=\"hljs-params\">(nElem)</span></span>;<br><span class=\"hljs-function\">dim3 <span class=\"hljs-title\">grid</span><span class=\"hljs-params\">(nElem/block.x)</span></span>;<br></code></pre></div></td></tr></table></figure>\n\n<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘å’Œæ‰§è¡Œè¯¥å¸¦å•Šå—ï¼š</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">nvcc sumArraysOnGPU-small-case.cu -o addvector<br>./addvector<br></code></pre></div></td></tr></table></figure>\n\n<p>ç³»ç»ŸæŠ¥å‘Šå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs shell\">./addvector Starting...<br>Vector size 32<br>Execution configuration &lt;&lt;&lt;1,32&gt;&gt;&gt;<br>Arrays match.<br></code></pre></div></td></tr></table></figure>\n\n<p>å¦‚æœä½ å°†æ‰§è¡Œé…ç½®é‡æ–°å®šä¹‰ä¸º32ä¸ªå—ï¼Œæ¯ä¸ªå—åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼›</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\">dim3 <span class=\"hljs-title\">block</span><span class=\"hljs-params\">(<span class=\"hljs-number\">1</span>)</span></span>;<br><span class=\"hljs-function\">dim3 <span class=\"hljs-title\">grid</span><span class=\"hljs-params\">(nElem)</span></span>;<br></code></pre></div></td></tr></table></figure>\n\n<p>é‚£ä¹ˆå°±éœ€è¦åœ¨ä»£ç æ¸…å•2-4ä¸­å¯¹æ ¸å‡½æ•°sumArraysOnGPUè¿›è¡Œä¿®æ”¹ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">ç”¨<span class=\"hljs-keyword\">int</span> i = threadIdx.x;    æ›¿æ¢<span class=\"hljs-keyword\">int</span> i = blockIdx.x;<br></code></pre></div></td></tr></table></figure>\n\n<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯ä»¥åŸºäºç»™å®šçš„ä¸€ç»´ç½‘æ ¼å’Œå—çš„ä¿¡æ¯æ¥è®¡ç®—å…¨å±€æ•°æ®è®¿é—®çš„å”¯ä¸€ç´¢å¼•ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\">__gloal__ <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">sumArraysOnGPU</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> *A, <span class=\"hljs-keyword\">float</span> *B, <span class=\"hljs-keyword\">float</span> *C)</span></span>&#123;<br>    <span class=\"hljs-keyword\">int</span> i = blockIdx.x * blockDim.x * threadIdx.x;<br>    C[i] = A[i] + B[i];<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>ä½ éœ€è¦ç¡®ä¿ä¸€èˆ¬æƒ…å†µä¸‹è¿›è¡Œæ›´æ”¹æ‰€äº§ç”Ÿç»“æœçš„æ­£ç¡®æ€§ã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p>CUDA Cç¼–ç¨‹æƒå¨æŒ‡å— ç¨‹æ¶¦ä¼Ÿï¼ŒMax Grossman(ç¾)ï¼ŒTy Mckercher </p>\n",
            "tags": [
                "CUDA"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/06/cuda010/",
            "url": "https://xingyuanjie.top/2023/03/06/cuda010/",
            "title": "CUDAå¤„ç†é”™è¯¯",
            "date_published": "2023-03-06T08:17:59.000Z",
            "content_html": "<h2 id=\"CUDAå¤„ç†é”™è¯¯\"><a href=\"#CUDAå¤„ç†é”™è¯¯\" class=\"headerlink\" title=\"CUDAå¤„ç†é”™è¯¯\"></a>CUDAå¤„ç†é”™è¯¯</h2><p>ç”±äºè®¸å¤šCUDAè°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æœ‰æ—¶å¯èƒ½å¾ˆéš¾ç¡®å®šæŸä¸ªé”™è¯¯æ˜¯ç”±å“ªä¸€æ­¥ç¨‹åºå¼•èµ·çš„ã€‚å®šä¹‰ä¸€ä¸ªé”™è¯¯å¤„ç†å®å°è£…æ‰€æœ‰çš„CUDA APIè°ƒç”¨ï¼Œè¿™ç®€åŒ–äº†é”™è¯¯æ£€æŸ¥è¿‡ç¨‹ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">define</span> CHECK(call)</span><br>&#123;<br>    <span class=\"hljs-keyword\">const</span> cudaError_t error = call;<br>    <span class=\"hljs-keyword\">if</span>(error != cudaSuccess)<br>    &#123;<br>        <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;Error:%s:%d, &quot;</span>, __FILE__, __LINE__);<br>        <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;code:%d, reason: %s\\n&quot;</span>, error, <span class=\"hljs-built_in\">cudaGetErrorString</span>(error));<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>ä¾‹å¦‚ï¼Œä½ å¯ä»¥åœ¨ä»¥ä¸‹ä»£ç ä¸­ä½¿ç”¨å®ï¼š</p>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs reasonml\"><span class=\"hljs-constructor\">CHECK(<span class=\"hljs-params\">cudaMemcpy</span>(<span class=\"hljs-params\">d_C</span>, <span class=\"hljs-params\">gpuRef</span>, <span class=\"hljs-params\">nBytes</span>, <span class=\"hljs-params\">cudaMemcpyHostToDevice</span>)</span>);<br></code></pre></div></td></tr></table></figure>\n\n<p>å¦‚æœå†…å­˜æ‹·è´æˆ–ä¹‹å‰çš„å¼‚æ­¥æ“ä½œäº§ç”Ÿäº†é”™è¯¯ï¼Œè¿™ä¸ªå®ä¼šæŠ¥å‘Šé”™è¯¯ä»£ç ï¼Œå¹¶è¾“å‡ºä¸€ä¸ªå¯è¯»ä¿¡æ¯ï¼Œç„¶ååœæ­¢ç¨‹åºã€‚ä¹Ÿå¯ä»¥ç”¨ä¸‹è¿°æ–¹æ³•ï¼Œåœ¨æ ¸å‡½æ•°è°ƒç”¨åæ£€æŸ¥æ ¸å‡½æ•°é”™è¯¯ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">kernel_function&lt;&lt;&lt;grid,block&gt;&gt;&gt;(argument list);<br><span class=\"hljs-built_in\">CHECK</span>(<span class=\"hljs-built_in\">cudaDeviceSynchronize</span>());<br></code></pre></div></td></tr></table></figure>\n\n<p>CHECK(cudaDeviceSynchronize())ä¼šé˜»å¡ä¸»æœºç«¯çº¿ç¨‹çš„è¿è¡Œç›´åˆ°è®¾å¤‡ç«¯æ‰€æœ‰çš„è¯·æ±‚ä»»åŠ¡éƒ½ç»“æŸï¼Œå¹¶ç¡®ä¿æœ€åçš„æ ¸å‡½æ•°å¯åŠ¨éƒ¨åˆ†ä¸ä¼šå‡ºé”™ã€‚ä»¥ä¸Šä»…æ˜¯ä»¥è°ƒè¯•ä¸ºç›®çš„çš„ï¼Œå› ä¸ºåœ¨æ ¸å‡½æ•°å¯åŠ¨åæ·»åŠ è¿™ä¸ªæ£€æŸ¥ç‚¹ä¼šé˜»å¡ä¸»æœºç«¯çº¿ç¨‹ï¼Œä½¿è¯¥æ£€æŸ¥ç‚¹æˆä¸ºå…¨å±€å±éšœã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p>CUDA Cç¼–ç¨‹æƒå¨æŒ‡å— ç¨‹æ¶¦ä¼Ÿï¼ŒMax Grossman(ç¾)ï¼ŒTy Mckercher </p>\n",
            "tags": [
                "CUDA"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/06/cuda009/",
            "url": "https://xingyuanjie.top/2023/03/06/cuda009/",
            "title": "CUDAéªŒè¯æ ¸å‡½æ•°",
            "date_published": "2023-03-06T08:06:35.000Z",
            "content_html": "<h2 id=\"CUDAéªŒè¯æ ¸å‡½æ•°\"><a href=\"#CUDAéªŒè¯æ ¸å‡½æ•°\" class=\"headerlink\" title=\"CUDAéªŒè¯æ ¸å‡½æ•°\"></a>CUDAéªŒè¯æ ¸å‡½æ•°</h2><p>æ—¢ç„¶ä½ å·²ç»ç¼–å†™äº†æ ¸å‡½æ•°ï¼Œä½ å¦‚ä½•èƒ½çŸ¥é“å®ƒæ˜¯å¦æ­£ç¡®è¿è¡Œï¼Ÿä½ éœ€è¦ä¸€ä¸ªä¸»æœºå‡½æ•°æ¥éªŒè¯æ ¸å‡½æ•°çš„ç»“æœã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">checkResult</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> *hostRef, <span class=\"hljs-keyword\">float</span> *gpuRef, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">int</span> N)</span></span>&#123;<br>    <span class=\"hljs-keyword\">double</span> epsilon = <span class=\"hljs-number\">1.0E-8</span>;<br>    <span class=\"hljs-keyword\">int</span> match = <span class=\"hljs-number\">1</span>;<br>    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span> ;i &lt; N; i++)&#123;<br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">abs</span>(hostRef[i] - gpuRef[i]) &gt; epsilon)&#123;<br>            match = <span class=\"hljs-number\">0</span>;<br>            <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;Arrays do not match!\\n&quot;</span>);<br>            <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;host %5.2f gpu %5.2f at current %d\\n&quot;</span>,hostRef[i],gpuRef[i],i);<br>            <span class=\"hljs-keyword\">break</span>;<br>        &#125;<br>    &#125;<br>    <span class=\"hljs-keyword\">if</span>(match) <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;Arrays match.\\n\\n&quot;</span>);<br>    <span class=\"hljs-keyword\">return</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<h3 id=\"éªŒè¯æ ¸å‡½æ•°ä»£ç \"><a href=\"#éªŒè¯æ ¸å‡½æ•°ä»£ç \" class=\"headerlink\" title=\"éªŒè¯æ ¸å‡½æ•°ä»£ç \"></a>éªŒè¯æ ¸å‡½æ•°ä»£ç </h3><p>é™¤äº†è®¸å¤šå¯ç”¨çš„è°ƒè¯•å·¥å…·å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªéå¸¸ç®€å•å®ç”¨çš„æ–¹æ³•å¯ä»¥éªŒè¯æ ¸å‡½æ•°ã€‚</p>\n<p>é¦–å…ˆï¼Œä½ å¯ä»¥åœ¨FermiåŠæ›´é«˜ç‰ˆæœ¬çš„è®¾å¤‡ç«¯çš„æ ¸å‡½æ•°ä¸­ä½¿ç”¨printfå‡½æ•°ã€‚</p>\n<p>å…¶æ¬¡ï¼Œå¯ä»¥å°†æ‰§è¡Œå‚æ•°è®¾ç½®ä¸º&lt;&lt;&lt;1,1&gt;&gt;&gt;ï¼Œå› æ­¤å¼ºåˆ¶ç”¨ä¸€ä¸ªå—å’Œä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ ¸å‡½æ•°ï¼Œè¿™æ¨¡æ‹Ÿäº†ä¸²è¡Œæ‰§è¡Œç¨‹åºã€‚è¿™å¯¹äºè°ƒè¯•å’ŒéªŒè¯ç»“æœæ˜¯å¦æ­£ç¡®æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œè€Œä¸”ï¼Œå¦‚æœä½ é‡åˆ°äº†è¿ç®—æ¬¡åºçš„é—®é¢˜ï¼Œè¿™æœ‰åŠ©äºä½ å¯¹æ¯”éªŒè¯æ•°å€¼ç»“æœæ˜¯å¦æ˜¯æŒ‰ä½ç²¾ç¡®çš„ã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p>CUDA Cç¼–ç¨‹æƒå¨æŒ‡å— ç¨‹æ¶¦ä¼Ÿï¼ŒMax Grossman(ç¾)ï¼ŒTy Mckercher </p>\n",
            "tags": [
                "CUDA"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/06/cuda008/",
            "url": "https://xingyuanjie.top/2023/03/06/cuda008/",
            "title": "CUDAç¼–å†™æ ¸å‡½æ•°",
            "date_published": "2023-03-06T07:46:00.000Z",
            "content_html": "<h2 id=\"ç¼–å†™æ ¸å‡½æ•°\"><a href=\"#ç¼–å†™æ ¸å‡½æ•°\" class=\"headerlink\" title=\"ç¼–å†™æ ¸å‡½æ•°\"></a>ç¼–å†™æ ¸å‡½æ•°</h2><p>æ ¸å‡½æ•°æ˜¯åœ¨è®¾å¤‡ç«¯æ‰§è¡Œçš„ä»£ç ã€‚åœ¨æ ¸å‡½æ•°ä¸­ï¼Œéœ€è¦ä¸ºä¸€ä¸ªçº¿ç¨‹è§„å®šè¦è¿›è¡Œçš„è®¡ç®—ä»¥åŠè¦è¿›è¡Œçš„æ•°æ®è®¿é—®ã€‚å½“æ ¸å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œè®¸å¤šä¸åŒçš„CUDAçº¿ç¨‹å¹¶è¡Œæ‰§è¡ŒåŒä¸€ä¸ªè®¡ç®—ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯ç”¨_<em>global</em>_</p>\n<p>å£°æ˜å®šä¹‰æ ¸å‡½æ•°ï¼š</p>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs reasonml\">__global__  void kernel<span class=\"hljs-constructor\">_name(<span class=\"hljs-params\">argument</span> <span class=\"hljs-params\">list</span>)</span>;<br></code></pre></div></td></tr></table></figure>\n\n<p>æ ¸å‡½æ•°å¿…é¡»æœ‰ä¸€ä¸ªvoidè¿”å›ç±»å‹ã€‚</p>\n<p>è¡¨2-2æ€»ç»“äº†CUDA Cç¨‹åºä¸­çš„å‡½æ•°ç±»å‹é™å®šç¬¦ã€‚å‡½æ•°ç±»å‹é™å®šç¬¦æŒ‡å®šä¸€ä¸ªå‡½æ•°åœ¨ä¸»æœºä¸Šæ‰§è¡Œè¿˜æ˜¯åœ¨è®¾å¤‡ä¸Šæ‰§è¡Œï¼Œä»¥åŠå¯è¢«ä¸»æœºè°ƒç”¨è¿˜æ˜¯è¢«è®¾å¤‡è°ƒç”¨ã€‚</p>\n<p><img src=\"/2023/03/06/cuda008/image-20230306155126122.png\" alt=\"image-20230306155126122\"></p>\n<p>_<em>device</em>_   å’Œ __host__é™å®šç¬¦å¯ä»¥ä¸€é½ä½¿ç”¨ï¼Œè¿™æ ·å‡½æ•°å¯ä»¥åŒæ—¶åœ¨ä¸»æœºå’Œè®¾å¤‡ç«¯è¿›è¡Œç¼–è¯‘ã€‚</p>\n<h3 id=\"CUDAæ ¸å‡½æ•°çš„é™åˆ¶\"><a href=\"#CUDAæ ¸å‡½æ•°çš„é™åˆ¶\" class=\"headerlink\" title=\"CUDAæ ¸å‡½æ•°çš„é™åˆ¶\"></a>CUDAæ ¸å‡½æ•°çš„é™åˆ¶</h3><p>ä»¥ä¸‹é™åˆ¶é€‚ç”¨äºæ‰€æœ‰æ ¸å‡½æ•°ï¼š</p>\n<ul>\n<li>åªèƒ½è®¿é—®è®¾å¤‡å†…å­˜</li>\n<li>å¿…é¡»å…·æœ‰voidè¿”å›ç±»å‹</li>\n<li>ä¸æ”¯æŒå¯å˜æ•°é‡çš„å‚æ•°</li>\n<li>ä¸æ”¯æŒé™æ€å˜é‡</li>\n<li>æ˜¾ç¤ºå¼‚æ­¥è¡Œä¸º</li>\n</ul>\n<p>è€ƒè™‘ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šå°†ä¸¤ä¸ªå¤§å°ä¸ºNçš„å‘é‡Aå’ŒBç›¸åŠ ï¼Œä¸»æœºç«¯çš„å‘é‡åŠ æ³•Cä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">sumArrayOnHost</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> *A, <span class=\"hljs-keyword\">float</span> *B, <span class=\"hljs-keyword\">float</span> *C, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">int</span> N)</span></span>&#123;<br>    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>;i &lt; N; i++)<br>        C[i] = A[i] + B[i];<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>è¿™æ˜¯ä¸€ä¸ªè¿­ä»£Næ¬¡çš„ä¸²è¡Œç¨‹åºï¼Œå¾ªç¯ç»“æŸåå°†äº§ç”Ÿä»¥ä¸‹æ ¸å‡½æ•°ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\">__global__ <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">sumArrayOnHost</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">float</span> *A, <span class=\"hljs-keyword\">float</span> *B, <span class=\"hljs-keyword\">float</span> *C)</span></span>&#123;<br>    \t<span class=\"hljs-keyword\">int</span> i = threadIdx.x;<br>        C[i] = A[i] + B[i];<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>Cå‡½æ•°å’Œæ ¸å‡½æ•°ä¹‹é—´æœ‰ä»€ä¹ˆä¸åŒï¼Ÿä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°å¾ªç¯ä½“æ¶ˆå¤±äº†ï¼Œå†…ç½®çš„çº¿ç¨‹åæ ‡å˜é‡æ›¿æ¢äº†æ•°ç»„ç´¢å¼•ï¼Œç”±äºNæ˜¯è¢«éšå¼å®šä¹‰ç”¨æ¥å¯åŠ¨Nä¸ªçº¿ç¨‹çš„ï¼Œæ‰€ä»¥Næ²¡æœ‰ä»€ä¹ˆå‚è€ƒä»·å€¼ã€‚</p>\n<p>å‡è®¾æœ‰ä¸€ä¸ªé•¿åº¦ä¸º32ä¸ªå…ƒç´ çš„å‘é‡ï¼Œä½ å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹æ³•ç”¨32ä¸ªçº¿ç¨‹æ¥è°ƒç”¨æ ¸å‡½æ•°ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">sumArraysOnGPU&lt;&lt;&lt;<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">32</span>&gt;&gt;&gt;(<span class=\"hljs-keyword\">float</span> *A, <span class=\"hljs-keyword\">float</span> *B, <span class=\"hljs-keyword\">float</span> *C);<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p>CUDA Cç¼–ç¨‹æƒå¨æŒ‡å— ç¨‹æ¶¦ä¼Ÿï¼ŒMax Grossman(ç¾)ï¼ŒTy Mckercher </p>\n",
            "tags": [
                "CUDA"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/06/cuda007/",
            "url": "https://xingyuanjie.top/2023/03/06/cuda007/",
            "title": "å¯åŠ¨ä¸€ä¸ªCUDAæ ¸å‡½æ•°",
            "date_published": "2023-03-06T05:59:18.000Z",
            "content_html": "<h2 id=\"å¯åŠ¨ä¸€ä¸ªCUDAæ ¸å‡½æ•°\"><a href=\"#å¯åŠ¨ä¸€ä¸ªCUDAæ ¸å‡½æ•°\" class=\"headerlink\" title=\"å¯åŠ¨ä¸€ä¸ªCUDAæ ¸å‡½æ•°\"></a>å¯åŠ¨ä¸€ä¸ªCUDAæ ¸å‡½æ•°</h2><p>ä½ åº”è¯¥å¯¹ä¸‹åˆ—Cè¯­è¨€å‡½æ•°è°ƒç”¨è¯­å¥å¾ˆç†Ÿæ‚‰ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-built_in\">function_name</span> (argument list);<br></code></pre></div></td></tr></table></figure>\n\n<p>CUDAå†…æ ¸è°ƒç”¨æ˜¯å¯¹Cè¯­è¨€å‡½æ•°è°ƒç”¨è¯­å¥çš„å»¶ç”³ï¼Œ&lt;&lt;&lt;&gt;&gt;&gt;è¿ç®—ç¬¦å†…æ˜¯æ ¸å‡½æ•°çš„æ‰§è¡Œé…ç½®ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">kerbel_name&lt;&lt;&lt;grid,block&gt;&gt;&gt;(srgument list);<br></code></pre></div></td></tr></table></figure>\n\n<p>æ­£å¦‚ä¸Šä¸€èŠ‚æ‰€è¿°ï¼ŒCUDAç¼–ç¨‹æ¨¡å‹æ­ç¤ºäº†çº¿ç¨‹å±‚æ¬¡ç»“æ„ã€‚åˆ©ç”¨æ‰§è¡Œé…ç½®å¯ä»¥æŒ‡å®šçº¿ç¨‹åœ¨GPUä¸Šè°ƒåº¦è¿è¡Œçš„æ–¹å¼ã€‚æ‰§è¡Œé…ç½®çš„ç¬¬ä¸€ä¸ªå€¼æ˜¯ç½‘æ ¼ç»´åº¦ï¼Œä¹Ÿå°±æ˜¯å¯åŠ¨å—çš„æ•°ç›®ã€‚ç¬¬äºŒä¸ªå€¼æ˜¯å—ç»´åº¦ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªå—ä¸­çº¿ç¨‹çš„æ•°ç›®ã€‚é€šè¿‡æŒ‡å®šç½‘æ ¼å’Œå—çš„ç»´åº¦ï¼Œä½ å¯ä»¥è¿›è¡Œä¸€ä¸‹é…ç½®ï¼š</p>\n<ul>\n<li>å†…æ ¸ä¸­çº¿ç¨‹çš„æ•°ç›®</li>\n<li>å†…æ ¸ä¸­ä½¿ç”¨çš„çº¿ç¨‹å¸ƒå±€</li>\n</ul>\n<p>åŒä¸€ä¸ªå—ä¸­çš„çº¿ç¨‹ä¹‹é—´å¯ä»¥ç›¸äº’åä½œï¼Œä¸åŒå—å†…çš„çº¿ç¨‹ä¸èƒ½åä½œã€‚å¯¹äºä¸€ä¸ªç»™å®šçš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ç½‘æ ¼å’Œå—å¸ƒå±€æ¥ç»„ç»‡ä½ çš„çº¿ç¨‹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰32ä¸ªæ•°æ®å…ƒç´ ç”¨äºè®¡ç®—ï¼Œæ¯8ä¸ªå…ƒç´ ä¸€ä¸ªå—ï¼Œéœ€è¦å¯åŠ¨4ä¸ªå—ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">kernel_name&lt;&lt;&lt;<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">8</span>&gt;&gt;&gt;(argument list);<br></code></pre></div></td></tr></table></figure>\n\n<p><img src=\"/2023/03/06/cuda007/image-20230306140924311.png\" alt=\"image-20230306140924311\"></p>\n<p>ç”±äºæ•°æ®åœ¨å…¨å±€å†…å­˜ä¸­æ˜¯çº¿æ€§å­˜å‚¨çš„ï¼Œå› æ­¤å¯ä»¥ç”¨å˜é‡blockIdx.xå’ŒthreadIdx.xæ¥è¿›è¡Œä»¥ä¸‹æ“ä½œã€‚</p>\n<ul>\n<li>åœ¨ç½‘æ ¼ä¸­æ ‡è¯†ä¸€ä¸ªå”¯ä¸€çš„çº¿ç¨‹</li>\n<li>å»ºç«‹çº¿ç¨‹å’Œæ•°æ®å…ƒç´ ä¹‹é—´çš„æ˜ å°„å…³ç³»</li>\n</ul>\n<p>å¦‚æœæŠŠ32ä¸ªå…ƒç´ æ”¾åˆ°ä¸€ä¸ªå—é‡Œï¼Œé‚£ä¹ˆåªä¼šå¾—åˆ°ä¸€ä¸ªå—ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">kernel_name&lt;&lt;&lt;<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">32</span>&gt;&gt;&gt;(argument list);<br></code></pre></div></td></tr></table></figure>\n\n<p>å¦‚æœæ¯ä¸ªå—åªå«ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆä¼šæœ‰32ä¸ªå—ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">kernel_name&lt;&lt;&lt;<span class=\"hljs-number\">32</span>,<span class=\"hljs-number\">1</span>&gt;&gt;&gt;(argument list);<br></code></pre></div></td></tr></table></figure>\n\n<p>æ ¸å‡½æ•°çš„è°ƒç”¨ä¸ä¸»æœºçº¿ç¨‹æ˜¯å¼‚æ­¥çš„ã€‚æ ¸å‡½æ•°è°ƒç”¨ç»“æŸåï¼Œæ§åˆ¶æƒç«‹åˆ»è¿”å›ç»™ä¸»æœºç«¯ã€‚ä½ å¯ä»¥è°ƒç”¨ä»¥ä¸‹å‡½æ•°æ¥å¼ºåˆ¶ä¸»æœºç«¯ç¨‹åºç­‰å¾…æ‰€æœ‰çš„æ ¸å‡½æ•°æ‰§è¡Œç»“æŸï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\">cudaError_t <span class=\"hljs-title\">cudaDeviceSynchronize</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">void</span>)</span></span>;<br></code></pre></div></td></tr></table></figure>\n\n<p>ä¸€äº›CUDAè¿è¡Œæ—¶APIåœ¨ä¸»æœºå’Œè®¾å¤‡ä¹‹é—´æ˜¯éšå¼åŒæ­¥çš„ã€‚å½“ä½¿ç”¨cudaMemcpyå‡½æ•°åœ¨ä¸»æœºå’Œè®¾å¤‡ä¹‹é—´æ‹·è´æ•°æ®æ—¶ï¼Œä¸»æœºç«¯éšå¼åŒæ­¥ï¼Œå³ä¸»æœºç«¯ç¨‹åºå¿…é¡»ç­‰å¾…æ•°æ®æ‹·è´å®Œæˆåæ‰èƒ½ç»§ç»­æ‰§è¡Œç¨‹åºã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\">cudaError_t <span class=\"hljs-title\">cudaMemcpy</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">void</span>* dst, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">void</span>* src, <span class=\"hljs-keyword\">size_t</span> count, cudaMemcpyKind kind)</span></span>;<br></code></pre></div></td></tr></table></figure>\n\n<p>ä¹‹å‰æ‰€æœ‰çš„æ ¸å‡½æ•°è°ƒç”¨å®Œæˆåå¼€å§‹æ‹·è´æ•°æ®ã€‚å½“æ‹·è´å®Œæˆåï¼Œæ§åˆ¶æƒç«‹åˆ»è¿”å›ç»™ä¸»æœºç«¯ã€‚</p>\n<h3 id=\"å¼‚æ­¥è¡Œä¸º\"><a href=\"#å¼‚æ­¥è¡Œä¸º\" class=\"headerlink\" title=\"å¼‚æ­¥è¡Œä¸º\"></a>å¼‚æ­¥è¡Œä¸º</h3><p>ä¸åŒäºCè¯­è¨€çš„å‡½æ•°è°ƒç”¨ï¼Œæ‰€æœ‰çš„CUDAæ ¸å‡½æ•°çš„å¯åŠ¨éƒ½æ˜¯å¼‚æ­¥çš„ã€‚CUDAå†…æ ¸è°ƒç”¨å®Œæˆåï¼Œæ§åˆ¶æƒç«‹åˆ»è¿”å›ç»™CPUã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p>CUDA Cç¼–ç¨‹æƒå¨æŒ‡å— ç¨‹æ¶¦ä¼Ÿï¼ŒMax Grossman(ç¾)ï¼ŒTy Mckercher </p>\n",
            "tags": [
                "CUDA"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/02/leetcode205/",
            "url": "https://xingyuanjie.top/2023/03/02/leetcode205/",
            "title": "205.åŒæ„å­—ç¬¦ä¸²",
            "date_published": "2023-03-02T12:44:27.000Z",
            "content_html": "<h2 id=\"205-åŒæ„å­—ç¬¦ä¸²\"><a href=\"#205-åŒæ„å­—ç¬¦ä¸²\" class=\"headerlink\" title=\"205.åŒæ„å­—ç¬¦ä¸²\"></a>205.åŒæ„å­—ç¬¦ä¸²</h2><h2 id=\"é¢˜ç›®é“¾æ¥\"><a href=\"#é¢˜ç›®é“¾æ¥\" class=\"headerlink\" title=\"é¢˜ç›®é“¾æ¥\"></a>é¢˜ç›®é“¾æ¥</h2><p><a href=\"https://leetcode.cn/problems/isomorphic-strings/\">205. åŒæ„å­—ç¬¦ä¸² - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p>\n<h2 id=\"å®Œæ•´ä»£ç \"><a href=\"#å®Œæ•´ä»£ç \" class=\"headerlink\" title=\"å®Œæ•´ä»£ç \"></a>å®Œæ•´ä»£ç </h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span> &#123;</span><br><span class=\"hljs-keyword\">public</span>:<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">bool</span> <span class=\"hljs-title\">isIsomorphic</span><span class=\"hljs-params\">(string s, string t)</span> </span>&#123;<br>        string ss;<br>        string st;<br>        <span class=\"hljs-keyword\">int</span> hash[<span class=\"hljs-number\">255</span>];<br>        <span class=\"hljs-keyword\">int</span> index=<span class=\"hljs-number\">0</span>;<br>        <span class=\"hljs-built_in\">memset</span>(hash, <span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\"><span class=\"hljs-keyword\">sizeof</span></span>(hash));<br>        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i=<span class=\"hljs-number\">0</span>;i&lt;s.<span class=\"hljs-built_in\">size</span>();i++)&#123;<br>            <span class=\"hljs-keyword\">if</span>(hash[<span class=\"hljs-built_in\"><span class=\"hljs-keyword\">int</span></span>(s[i])]==<span class=\"hljs-number\">0</span>)<br>            &#123;<br>                index++;<br>                hash[<span class=\"hljs-built_in\"><span class=\"hljs-keyword\">int</span></span>(s[i])]=index;<br>                ss.<span class=\"hljs-built_in\">push_back</span>(index+<span class=\"hljs-string\">&#x27;0&#x27;</span>);<br>            &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>                ss.<span class=\"hljs-built_in\">push_back</span>(hash[<span class=\"hljs-built_in\"><span class=\"hljs-keyword\">int</span></span>(s[i])]+<span class=\"hljs-string\">&#x27;0&#x27;</span>);<br>            &#125;<br>        &#125;<br>        index=<span class=\"hljs-number\">0</span>;<br>        <span class=\"hljs-built_in\">memset</span>(hash, <span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\"><span class=\"hljs-keyword\">sizeof</span></span>(hash));<br>        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i=<span class=\"hljs-number\">0</span>;i&lt;t.<span class=\"hljs-built_in\">size</span>();i++)&#123;<br>            <span class=\"hljs-keyword\">if</span>(hash[<span class=\"hljs-built_in\"><span class=\"hljs-keyword\">int</span></span>(t[i])]==<span class=\"hljs-number\">0</span>)<br>            &#123;<br>                index++;<br>                hash[<span class=\"hljs-built_in\"><span class=\"hljs-keyword\">int</span></span>(t[i])]=index;<br>                st.<span class=\"hljs-built_in\">push_back</span>(index+<span class=\"hljs-string\">&#x27;0&#x27;</span>);<br>            &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>                st.<span class=\"hljs-built_in\">push_back</span>(hash[<span class=\"hljs-built_in\"><span class=\"hljs-keyword\">int</span></span>(t[i])]+<span class=\"hljs-string\">&#x27;0&#x27;</span>);<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">int</span> ans = ss.<span class=\"hljs-built_in\">compare</span>(st);<br>        <span class=\"hljs-keyword\">if</span>(ans==<span class=\"hljs-number\">0</span>)&#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;<br>    &#125;<br>&#125;;<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"å‚è€ƒä»£ç \"><a href=\"#å‚è€ƒä»£ç \" class=\"headerlink\" title=\"å‚è€ƒä»£ç \"></a>å‚è€ƒä»£ç </h2><p><img src=\"/2023/03/02/leetcode205/image-20230302204605581.png\" alt=\"image-20230302204605581\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span> &#123;</span><br><span class=\"hljs-keyword\">public</span>:<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">bool</span> <span class=\"hljs-title\">isIsomorphic</span><span class=\"hljs-params\">(string s, string t)</span> </span>&#123;<br>        unordered_map&lt;<span class=\"hljs-keyword\">char</span>, <span class=\"hljs-keyword\">char</span>&gt; s2t;<br>        unordered_map&lt;<span class=\"hljs-keyword\">char</span>, <span class=\"hljs-keyword\">char</span>&gt; t2s;<br>        <span class=\"hljs-keyword\">int</span> len = s.<span class=\"hljs-built_in\">length</span>();<br>        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; len; ++i) &#123;<br>            <span class=\"hljs-keyword\">char</span> x = s[i], y = t[i];<br>            <span class=\"hljs-keyword\">if</span> ((s2t.<span class=\"hljs-built_in\">count</span>(x) &amp;&amp; s2t[x] != y) || (t2s.<span class=\"hljs-built_in\">count</span>(y) &amp;&amp; t2s[y] != x)) &#123;<br>                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;<br>            &#125;<br>            s2t[x] = y;<br>            t2s[y] = x;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;<br>    &#125;<br>&#125;;<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"å‚è€ƒé“¾æ¥\"><a href=\"#å‚è€ƒé“¾æ¥\" class=\"headerlink\" title=\"å‚è€ƒé“¾æ¥\"></a>å‚è€ƒé“¾æ¥</h2><p><a href=\"https://leetcode.cn/problems/isomorphic-strings/solution/tong-gou-zi-fu-chuan-by-leetcode-solutio-s6fd/\">åŒæ„å­—ç¬¦ä¸² - åŒæ„å­—ç¬¦ä¸² - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p>\n",
            "tags": [
                "C++",
                "LeetCode",
                "å“ˆå¸Œè¡¨"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/02/leetcode189/",
            "url": "https://xingyuanjie.top/2023/03/02/leetcode189/",
            "title": "189.è½®è½¬æ•°ç»„",
            "date_published": "2023-03-02T12:03:32.000Z",
            "content_html": "<h2 id=\"189-è½®è½¬æ•°ç»„\"><a href=\"#189-è½®è½¬æ•°ç»„\" class=\"headerlink\" title=\"189.è½®è½¬æ•°ç»„\"></a>189.è½®è½¬æ•°ç»„</h2><h2 id=\"é¢˜ç›®é“¾æ¥\"><a href=\"#é¢˜ç›®é“¾æ¥\" class=\"headerlink\" title=\"é¢˜ç›®é“¾æ¥\"></a>é¢˜ç›®é“¾æ¥</h2><p><a href=\"https://leetcode.cn/problems/rotate-array/\">189. è½®è½¬æ•°ç»„ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p>\n<h2 id=\"å®Œæ•´ä»£ç \"><a href=\"#å®Œæ•´ä»£ç \" class=\"headerlink\" title=\"å®Œæ•´ä»£ç \"></a>å®Œæ•´ä»£ç </h2><p><img src=\"/2023/03/02/leetcode189/image-20230302200538871.png\" alt=\"image-20230302200538871\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span> &#123;</span><br><span class=\"hljs-keyword\">public</span>:<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">reverse</span><span class=\"hljs-params\">(vector&lt;<span class=\"hljs-keyword\">int</span>&gt;&amp; nums,<span class=\"hljs-keyword\">int</span> begin,<span class=\"hljs-keyword\">int</span> end)</span></span><br><span class=\"hljs-function\">    </span>&#123;<br>        <span class=\"hljs-keyword\">while</span>(begin&lt;end)&#123;<br>            <span class=\"hljs-built_in\">swap</span>(nums[begin], nums[end]);<br>            begin++;<br>            end--;<br>        &#125;<br>    &#125;<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">rotate</span><span class=\"hljs-params\">(vector&lt;<span class=\"hljs-keyword\">int</span>&gt;&amp; nums, <span class=\"hljs-keyword\">int</span> k)</span> </span>&#123;<br>        <span class=\"hljs-comment\">//æ•°ç»„ç¿»è½¬</span><br>        <span class=\"hljs-keyword\">int</span> p = k%nums.<span class=\"hljs-built_in\">size</span>();<br>        <span class=\"hljs-built_in\">reverse</span>(nums,<span class=\"hljs-number\">0</span>,nums.<span class=\"hljs-built_in\">size</span>()<span class=\"hljs-number\">-1</span>);<br>        <span class=\"hljs-built_in\">reverse</span>(nums,<span class=\"hljs-number\">0</span>,p<span class=\"hljs-number\">-1</span>);<br>        <span class=\"hljs-built_in\">reverse</span>(nums,p,nums.<span class=\"hljs-built_in\">size</span>()<span class=\"hljs-number\">-1</span>);<br>    &#125;<br>&#125;;<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p><a href=\"https://leetcode.cn/problems/rotate-array/solution/xuan-zhuan-shu-zu-by-leetcode-solution-nipk/\">æ—‹è½¬æ•°ç»„ - è½®è½¬æ•°ç»„ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p>\n",
            "tags": [
                "C++",
                "LeetCode",
                "æ•°ç»„ç¿»è½¬"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/03/01/leetcode724/",
            "url": "https://xingyuanjie.top/2023/03/01/leetcode724/",
            "title": "724.å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒä¸‹æ ‡",
            "date_published": "2023-03-01T09:35:03.000Z",
            "content_html": "<h1 id=\"724-å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒä¸‹æ ‡\"><a href=\"#724-å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒä¸‹æ ‡\" class=\"headerlink\" title=\"724.å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒä¸‹æ ‡\"></a>724.å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒä¸‹æ ‡</h1><h2 id=\"é¢˜ç›®é“¾æ¥\"><a href=\"#é¢˜ç›®é“¾æ¥\" class=\"headerlink\" title=\"é¢˜ç›®é“¾æ¥\"></a>é¢˜ç›®é“¾æ¥</h2><p><a href=\"https://leetcode.cn/problems/find-pivot-index/\">724. å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒä¸‹æ ‡ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p>\n<h2 id=\"å®Œæ•´ä»£ç \"><a href=\"#å®Œæ•´ä»£ç \" class=\"headerlink\" title=\"å®Œæ•´ä»£ç \"></a>å®Œæ•´ä»£ç </h2><p><img src=\"/2023/03/01/leetcode724/image-20230301173931031.png\" alt=\"image-20230301173931031\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span> &#123;</span><br><span class=\"hljs-keyword\">public</span>:<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">pivotIndex</span><span class=\"hljs-params\">(vector&lt;<span class=\"hljs-keyword\">int</span>&gt;&amp; nums)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">int</span> total=<span class=\"hljs-built_in\">accumulate</span>(nums.<span class=\"hljs-built_in\">begin</span>(), nums.<span class=\"hljs-built_in\">end</span>(),<span class=\"hljs-number\">0</span>);\t<span class=\"hljs-comment\">//ç¬¬ä¸‰ä¸ªå½¢å‚æ˜¯ç´¯åŠ çš„åˆå§‹å€¼</span><br>        <span class=\"hljs-keyword\">int</span> sum=<span class=\"hljs-number\">0</span>;<br>        <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i=<span class=\"hljs-number\">0</span>;i&lt;nums.<span class=\"hljs-built_in\">size</span>();i++)<br>        &#123;<br>            <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-number\">2</span>*sum+nums[i] == total)&#123;<br>                <span class=\"hljs-keyword\">return</span> i;<br>            &#125;<br>            sum+=nums[i];<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">-1</span>;<br>    &#125;<br>&#125;;<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p><a href=\"https://leetcode.cn/problems/find-pivot-index/solution/xun-zhao-shu-zu-de-zhong-xin-suo-yin-by-gzjle/\">å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒç´¢å¼• - å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒä¸‹æ ‡ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p>\n",
            "tags": [
                "C++",
                "LeetCode",
                "å‰ç¼€å’Œ"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/02/28/vectorbool/",
            "url": "https://xingyuanjie.top/2023/02/28/vectorbool/",
            "title": "vector<bool>ä¸vector<T>",
            "date_published": "2023-02-28T12:59:01.000Z",
            "content_html": "<h1 id=\"vector-lt-bool-gt-ä¸vector-lt-T-gt\"><a href=\"#vector-lt-bool-gt-ä¸vector-lt-T-gt\" class=\"headerlink\" title=\"vector&lt;bool&gt;ä¸vector&lt;T&gt;\"></a>vector&lt;bool&gt;ä¸vector&lt;T&gt;</h1><p>vector&lt;bool&gt; ä¸åƒå…¶ä»–å®¹å™¨ä¸€æ ·æŒ‰Byteå­˜å‚¨çš„ï¼Œå®ƒæ˜¯æŒ‰bitå­˜å‚¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ­£å¸¸çš„boolç±»å‹çš„ç©ºé—´å¯ä»¥å­˜æ”¾vector&lt;bool&gt;ä¸­çš„8ä¸ªï¼Œç©ºé—´ä¸Šç¡®å®ä¼˜åŒ–äº†å¾ˆå¤šï¼Œç„¶è€Œï¼Œc++æ˜¯ä¸èƒ½ç›´æ¥å–å¯¹bitæ“ä½œçš„ï¼ˆå› ä¸ºC++çš„æœ€å°å¯å¯»å€å€¼é€šå¸¸ä»¥byteä¸ºå•ä½ï¼‰ï¼Œå¯¹å…¶ä½¿ç”¨operator[]å…¶å®è¿”å›çš„ä¸æ˜¯boolçš„å¼•ç”¨è€Œæ˜¯ä¸€ä¸ªâ€proxy referenceâ€æ˜¯â€std::vector&lt; bool&gt;:referenceâ€ç±»å‹çš„å¯¹è±¡ã€‚</p>\n<p>æ­£å› ä¸ºå¦‚æ­¤ï¼Œvector&lt;bool&gt;é€šè¿‡ä»£ç†å¯¹è±¡è¿›è¡Œå­˜å–è®¿é—®æ—¶éœ€è¦æ‰§è¡Œé€ä½å¤„ç†ï¼Œè®¿é—®é€šå¸¸æ¯”intä¹‹ç±»çš„æ™®é€šç±»å‹æ“ä½œè¦æ…¢å¾ˆå¤šã€‚</p>\n<p>å› æ­¤ï¼Œå¯¹vecotr&lt;bool&gt;çš„ä½¿ç”¨éœ€æ…é‡è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š<br>(1)æ˜¯å¦éœ€è¦ç‰ºç‰²é€Ÿåº¦æ¥è·å–ç©ºé—´ä¸Šçš„ä¼˜åŒ–<br>(2)ç®—æ³•ä¸­ä¼šå¦æœ‰å¯¹vecotråœ°å€è¿›è¡Œè§£å¼•ç”¨æ“ä½œçš„å¯èƒ½ã€‚</p>\n<p>å¦‚æœä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œå»ºè®®ä½¿ç”¨deque&lt;bool&gt;æ¥å–ä»£vector&lt;bool&gt;ï¼ŒåŠŸèƒ½åŸºæœ¬ç›¸åŒï¼Œä½†deque&lt;bool&gt;æœªå¯¹å…¶è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚</p>\n<p>ä¸‹é¢æ˜¯vector&lt;bool&gt;ä¸vector&lt;T&gt;ç®€å•çš„å¯¹æ¯”ä¾‹å­ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span></span>&#123;<br>\tvector&lt;<span class=\"hljs-keyword\">char</span>&gt; ch;<br>\tvector&lt;<span class=\"hljs-keyword\">int</span>&gt; in;<br>\tvector&lt;<span class=\"hljs-keyword\">bool</span>&gt; bo;<br> <br>\t<span class=\"hljs-keyword\">int</span> m = <span class=\"hljs-number\">1e6</span>;<br>\t<span class=\"hljs-keyword\">clock_t</span> t1, t2, t3;<br> <br>\tt1 = <span class=\"hljs-built_in\">clock</span>();<br>\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; m; i++)&#123;<br>\t\tch.<span class=\"hljs-built_in\">push_back</span>(<span class=\"hljs-string\">&#x27;0&#x27;</span>);<br>\t&#125;<br>\tt1 = <span class=\"hljs-built_in\">clock</span>() - t1;<br> <br>\tt2 = <span class=\"hljs-built_in\">clock</span>();<br>\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; m; i++)&#123;<br>\t\tin.<span class=\"hljs-built_in\">push_back</span>(<span class=\"hljs-number\">0</span>);<br>\t&#125;<br>\tt2 = <span class=\"hljs-built_in\">clock</span>() - t2;<br> <br>\tt3 = <span class=\"hljs-built_in\">clock</span>();<br>\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; m; i++)&#123;<br>\t\tbo.<span class=\"hljs-built_in\">push_back</span>(<span class=\"hljs-literal\">true</span>);<br>\t&#125;<br>\tt3 = <span class=\"hljs-built_in\">clock</span>() - t3;<br> <br>\tcout &lt;&lt;<span class=\"hljs-string\">&quot;vector&lt;char&gt; &quot;</span>&lt;&lt; t1 &lt;&lt; <span class=\"hljs-string\">&quot;\\n vector&lt;int&gt; &quot;</span> &lt;&lt; t2 &lt;&lt; <span class=\"hljs-string\">&quot;\\nvector&lt;bool&gt; &quot;</span> &lt;&lt; t3 &lt;&lt; endl;<br>\tcout &lt;&lt; endl;<br> <br>\t<span class=\"hljs-built_in\">system</span>(<span class=\"hljs-string\">&quot;pause&quot;</span>);<br>\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>è¿è¡Œç»“æœï¼š</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs cpp\">vector&lt;<span class=\"hljs-keyword\">char</span>&gt; <span class=\"hljs-number\">216</span><br>vextor&lt;<span class=\"hljs-keyword\">int</span>&gt; <span class=\"hljs-number\">229</span><br>vector&lt;<span class=\"hljs-keyword\">bool</span>&gt; <span class=\"hljs-number\">16535</span><br></code></pre></div></td></tr></table></figure>\n\n<p>è¿™é‡Œå‘ç°vector&lt;bool&gt;ç›¸è¾ƒäºå…¶ä»–vector&lt;T&gt;é€Ÿåº¦è¦æ…¢çš„å¤šï¼</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p><a href=\"https://blog.csdn.net/qq_52134928/article/details/121066304?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-121066304-blog-86603050.pc_relevant_3mothn_strategy_and_data_recovery&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-121066304-blog-86603050.pc_relevant_3mothn_strategy_and_data_recovery&utm_relevant_index=1\">(65æ¡æ¶ˆæ¯) ã€C++ã€‘vectorï¼œboolï¼çš„ç‰¹åˆ«ä¹‹å¤„_å°é™¶åŒå­¦_çš„åšå®¢-CSDNåšå®¢</a></p>\n<p><a href=\"https://blog.csdn.net/u013249689/article/details/25297657\">(65æ¡æ¶ˆæ¯) ä¸ä½¿ç”¨vectorçš„åŸå› å’Œæ›¿ä»£æ–¹æ³•_jackycmuçš„åšå®¢-CSDNåšå®¢</a></p>\n",
            "tags": [
                "STL",
                "Vector",
                "C/C++",
                "bool"
            ]
        },
        {
            "id": "https://xingyuanjie.top/2023/02/28/Linux004/",
            "url": "https://xingyuanjie.top/2023/02/28/Linux004/",
            "title": "C/C++å…³é”®å­—ä¹‹restrict",
            "date_published": "2023-02-28T11:45:09.000Z",
            "content_html": "<h1 id=\"C-x2F-C-å…³é”®å­—ä¹‹restrict\"><a href=\"#C-x2F-C-å…³é”®å­—ä¹‹restrict\" class=\"headerlink\" title=\"C&#x2F;C++å…³é”®å­—ä¹‹restrict\"></a>C&#x2F;C++å…³é”®å­—ä¹‹restrict</h1><p>åœ¨Cè¯­è¨€ä¸­ï¼Œrestrictå…³é”®å­—ç”¨äºä¿®é¥°æŒ‡é’ˆï¼ˆC99æ ‡å‡†ï¼‰ã€‚é€šè¿‡åŠ ä¸Šrestrictå…³é”®å­—ï¼Œç¨‹åºå‘˜å¯æç¤ºç¼–è¯‘å™¨ï¼šåœ¨è¯¥æŒ‡é’ˆçš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå…¶æŒ‡å‘çš„å¯¹è±¡ä¸ä¼šè¢«åˆ«çš„æŒ‡é’ˆæ‰€å¼•ç”¨ã€‚</p>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨C++ä¸­ï¼Œå¹¶æ— æ˜ç¡®ç»Ÿä¸€çš„æ ‡å‡†æ”¯æŒrestrictå…³é”®å­—ã€‚ä½†æ˜¯å¾ˆå¤šç¼–è¯‘å™¨å®ç°äº†åŠŸèƒ½ç›¸åŒçš„å…³é”®å­—ï¼Œä¾‹å¦‚gccå’Œclangä¸­çš„__restrictå…³é”®å­—ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">add1</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span>*a, <span class=\"hljs-keyword\">int</span>* b)</span></span><br><span class=\"hljs-function\"></span>&#123;<br>    *a = <span class=\"hljs-number\">10</span>;<br>    *b = <span class=\"hljs-number\">12</span>;<br>    <span class=\"hljs-keyword\">return</span> *a + *b;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>add1å‡½æ•°çš„è¿”å›å€¼ä¼šæ°¸è¿œæ˜¯10 + 12 &#x3D; 22å—ï¼Ÿ</p>\n<p>ç­”æ¡ˆæ˜¯ä¸ä¸€å®šã€‚åœ¨æŒ‡é’ˆaå’Œbçš„åœ°å€ä¸åŒæ—¶ï¼Œè¿”å›22æ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯å½“æŒ‡é’ˆaä¸bæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªintå¯¹è±¡æ—¶ï¼Œè¯¥å¯¹è±¡å…ˆè¢«èµ‹å€¼ä¸º10ï¼Œåè¢«èµ‹å€¼ä¸º12ï¼Œå› æ­¤aå’Œbéƒ½è¿”å›12ï¼Œå› æ­¤add1å‡½æ•°æœ€ç»ˆè¿”å›24ã€‚</p>\n<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;bits/stdc++.h&gt;</span></span><br><span class=\"hljs-keyword\">using</span> <span class=\"hljs-keyword\">namespace</span> std;<br><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">add1</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span>* a, <span class=\"hljs-keyword\">int</span>* b)</span></span><br><span class=\"hljs-function\"></span>&#123;<br>    *a = <span class=\"hljs-number\">10</span>;<br>    *b = <span class=\"hljs-number\">12</span>;<br>    <span class=\"hljs-keyword\">return</span> *a + *b;<br>&#125;<br><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span></span>&#123;<br>    <span class=\"hljs-keyword\">int</span>* c;<br>    <span class=\"hljs-keyword\">int</span>* d;<br>    d=(<span class=\"hljs-keyword\">int</span>*)<span class=\"hljs-built_in\">malloc</span>(<span class=\"hljs-built_in\"><span class=\"hljs-keyword\">sizeof</span></span>(<span class=\"hljs-keyword\">int</span>)*<span class=\"hljs-number\">1</span>);<br>    c=(<span class=\"hljs-keyword\">int</span>*)<span class=\"hljs-built_in\">malloc</span>(<span class=\"hljs-built_in\"><span class=\"hljs-keyword\">sizeof</span></span>(<span class=\"hljs-keyword\">int</span>)*<span class=\"hljs-number\">1</span>);<br>    *c=<span class=\"hljs-number\">10</span>;<br>    *d=<span class=\"hljs-number\">12</span>;<br>    *d=<span class=\"hljs-number\">12</span>;<br>    cout&lt;&lt;<span class=\"hljs-string\">&quot;c:&quot;</span>&lt;&lt;*c&lt;&lt;endl;<br>    cout&lt;&lt;<span class=\"hljs-string\">&quot;d:&quot;</span>&lt;&lt;*d&lt;&lt;endl;<br>    cout&lt;&lt;<span class=\"hljs-string\">&quot;When Pointers a and b have different addresses&quot;</span>&lt;&lt;endl;<br>    cout&lt;&lt;<span class=\"hljs-built_in\">add1</span>(c,d)&lt;&lt;endl;<br>    cout&lt;&lt;<span class=\"hljs-string\">&quot;When Pointers a and b have the same address&quot;</span>&lt;&lt;endl;<br>    cout&lt;&lt;<span class=\"hljs-built_in\">add1</span>(c,c)&lt;&lt;endl;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>ç¨‹åºè¾“å‡ºï¼š</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\">c:<span class=\"hljs-number\">10</span><br>d:<span class=\"hljs-number\">12</span><br>When Pointers a <span class=\"hljs-keyword\">and</span> b have different addresses<br><span class=\"hljs-number\">22</span><br>When Pointers a <span class=\"hljs-keyword\">and</span> b have the same address<br><span class=\"hljs-number\">24</span><br></code></pre></div></td></tr></table></figure>\n\n<p>å¼€å¯-O3ä¼˜åŒ–ï¼Œadd1å¯¹åº”çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹:</p>\n<p>ä¸ºäº†å¾—åˆ°<code>*a</code>çš„å€¼è®¿é—®äº†1æ¬¡å†…å­˜ï¼Œè€Œä¸ç®¡åœ¨ä½•ç§æ¡ä»¶ä¸‹(<code>a == b</code> or <code>a != b</code>)ï¼Œ<code>*b</code>çš„å€¼éƒ½æ˜¯12ã€‚å› æ­¤ç¼–è¯‘å™¨å°†<code>*a</code>çš„å€¼è½½å…¥<code>eax</code>å¯„å­˜å™¨åï¼Œç›´æ¥åŠ ä¸Šç«‹å³æ•°12ï¼Œè€Œæ— éœ€å†è®¿é—®å†…å­˜è·å–<code>*b</code>çš„å€¼ã€‚åœ¨æ— æ³•ç¡®å®šæŒ‡é’ˆaå’Œbæ˜¯å¦ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨åªèƒ½å¸®ä½ ä¼˜åŒ–åˆ°è¿™é‡Œäº†ã€‚</p>\n<figure class=\"highlight fortran\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs fortran\"><span class=\"hljs-number\">0000000000400</span>a10 &lt;_Z4add1PiS_&gt;:<br>  <span class=\"hljs-number\">400</span>a10:   c7 <span class=\"hljs-number\">07</span> <span class=\"hljs-number\">0</span>a <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       movl   $<span class=\"hljs-number\">0</span>xa,(%rdi) ; *a = <span class=\"hljs-number\">10</span><br>  <span class=\"hljs-number\">400</span>a16:   c7 <span class=\"hljs-number\">06</span> <span class=\"hljs-number\">0</span>c <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       movl   $<span class=\"hljs-number\">0</span>xc,(%rsi) ; *b = <span class=\"hljs-number\">10</span><br>  <span class=\"hljs-number\">400</span>a1c:   <span class=\"hljs-number\">8</span>b <span class=\"hljs-number\">07</span>                   mov    (%rdi),%eax ; ç»“æœ = *a<br>  <span class=\"hljs-number\">400</span>a1e:   <span class=\"hljs-number\">83</span> c0 <span class=\"hljs-number\">0</span>c                add    $<span class=\"hljs-number\">0</span>xc,%eax   ; ç»“æœ += <span class=\"hljs-number\">12</span> <br>  <span class=\"hljs-number\">400</span>a21:   c3                      retq<br></code></pre></div></td></tr></table></figure>\n\n<p>åŠ ä¸Šäº†restrictå…³é”®å­—è¿‡åï¼ŒåŒæ ·å¼€å¯-O3ä¼˜åŒ–ï¼Œadd1å¯¹åº”çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š</p>\n<p>åŠ ä¸Šå…³é”®å­—restrictåï¼Œç¼–è¯‘å™¨èƒ½å¤Ÿç¡®è®¤æŒ‡é’ˆaå’Œbä¸å¯èƒ½æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œå› æ­¤åœ¨æ±‚*a + *bæ—¶ï¼Œæ— è™šè®¿é—®å†…å­˜ï¼Œå› ä¸º*aå¿…ç„¶ç­‰äºç«‹å³æ•°10ï¼Œ*bå¿…ç„¶ç­‰äºç«‹å³æ•°12ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs c++\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">add2</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span>* __restrict  a, <span class=\"hljs-keyword\">int</span>* __restrict b)</span> </span><br><span class=\"hljs-function\"></span>&#123;<br>    *a = <span class=\"hljs-number\">10</span>;<br>    *b = <span class=\"hljs-number\">12</span>;<br>    <span class=\"hljs-keyword\">return</span> *a + *b ;<br>&#125;<br><span class=\"hljs-number\">0000000000400</span>a30 &lt;_Z4add2PiS_&gt;:<br>  <span class=\"hljs-number\">400</span>a30:   c7 <span class=\"hljs-number\">07</span> <span class=\"hljs-number\">0</span>a <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       movl   $<span class=\"hljs-number\">0xa</span>,(%rdi) ; *a = <span class=\"hljs-number\">10</span><br>  <span class=\"hljs-number\">400</span>a36:   b8 <span class=\"hljs-number\">16</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>          mov    $<span class=\"hljs-number\">0x16</span>,%eax  ; ç»“æœ = <span class=\"hljs-number\">22</span><br>  <span class=\"hljs-number\">400</span>a3b:   c7 <span class=\"hljs-number\">06</span> <span class=\"hljs-number\">0</span>c <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       movl   $<span class=\"hljs-number\">0xc</span>,(%rsi) ; *b = <span class=\"hljs-number\">12</span><br>  <span class=\"hljs-number\">400</span>a41:   c3  <br></code></pre></div></td></tr></table></figure>\n\n<p>æœ‰æ— restrictå…³é”®å­—çš„ä¸¤ç§æƒ…å†µä¸‹çš„æ±‡ç¼–æŒ‡ä»¤å¯çœ‹åˆ°ï¼Œåè€…æ¯”å‰è€…å°‘è®¿é—®ä¸€æ¬¡å†…å­˜ï¼Œä¸”å°‘æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ã€‚å°±æ˜¯å› ä¸ºæ²¡åŠ restructå…³é”®å­—æ—¶ï¼Œç¼–è¯‘å™¨ä¸èƒ½ç¡®å®šåˆ«çš„åœ°æ–¹æ˜¯ä¸æ˜¯ä¼šä¿®æ”¹æ­¤å€¼ï¼Œæ‰€ä»¥ä¼šå»ç›¸åº”çš„åœ°å€æŸ¥çœ‹ã€‚</p>\n<p><strong>è¿™æ ·å½“æˆ‘ä»¬æ˜ç¡®çŸ¥é“ä¸¤ä¸ªæŒ‡é’ˆä¸å¯èƒ½æŒ‡å‘åŒä¸€ä¸ªåœ°å€æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä½¿ç”¨restrictå…³é”®å­—æ¥è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚</strong></p>\n<p>æ³¨æ„ä½¿ç”¨restrictçš„æ—¶å€™ï¼Œç¨‹åºå‘˜å¿…é¡»ç¡®ä¿ä¸ä¼šå‡ºç°<strong>pointer aliasing</strong>ï¼Œå³åŒä¸€å—å†…å­˜æ— æ³•é€šè¿‡ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„æŒ‡é’ˆå˜é‡åè®¿é—®ã€‚ä¸æ»¡è¶³è¿™ä¸ªæ¡ä»¶å¼ºè¡ŒæŒ‡å®šrestrictï¼Œå°†ä¼šå‡ºç°<strong>underfined behavior</strong>ã€‚</p>\n<p>é€šå¸¸ç¼–å†™ä»£ç æ—¶ä¼šå¿½ç•¥pointer aliasingçš„é—®é¢˜ã€‚æ›´å¸¸è§æ˜¯åœ¨æ€§èƒ½åˆ†ææ—¶ï¼Œé€šè¿‡åæ±‡ç¼–çœ‹åˆ°å¾ˆå¤šå†—ä½™çš„è¯»å–æŒ‡ä»¤ï¼Œæ‰ä¼šæƒ³åˆ°åŠ å…¥restrictå…³é”®å­—æ¥æå‡æ€§èƒ½ã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><p><a href=\"https://zhuanlan.zhihu.com/p/349726808\">C&#x2F;C++å…³é”®å­—ä¹‹restrict - çŸ¥ä¹ (zhihu.com)</a></p>\n<p><a href=\"https://github.com/ClickHouse/ClickHouse/pull/19946\">Improve performance of aggregate functions by alexey-milovidov Â· Pull Request #19946 Â· ClickHouse&#x2F;ClickHouse (github.com)</a></p>\n<p><a href=\"https://en.cppreference.com/w/c/language/restrict\">restrict type qualifier - cppreference.com</a></p>\n<p><a href=\"https://www.zhihu.com/question/41653775/answer/2535730128\">å¦‚ä½•ç†è§£Cè¯­è¨€å…³é”®å­—restrictï¼Ÿ - çŸ¥ä¹ (zhihu.com)</a></p>\n<p><a href=\"https://blog.csdn.net/qq_41822235/article/details/83479562\">(65æ¡æ¶ˆæ¯) å…³é”®å­—_restrict___restrict_æ¥šæ¥šå¯è–‡çš„åšå®¢-CSDNåšå®¢</a></p>\n<p><a href=\"https://blog.csdn.net/qq_41950508/article/details/126619881?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-126619881-blog-102577325.pc_relevant_3mothn_strategy_recovery&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-126619881-blog-102577325.pc_relevant_3mothn_strategy_recovery&utm_relevant_index=1\">(65æ¡æ¶ˆæ¯) ã€C++ã€‘å…³é”®å­—restrictçš„ä½œç”¨_restrictå…³é”®å­—çš„ä½œç”¨_ä¸çŸ¥æ‰€æªçš„æ¸£æ¸£è¾‰çš„åšå®¢-CSDNåšå®¢</a></p>\n",
            "tags": [
                "Linux"
            ]
        }
    ]
}